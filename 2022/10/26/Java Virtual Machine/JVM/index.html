

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Kblayt">
  <meta name="keywords" content="">
  
    <meta name="description" content="title: JVMdate: 2022-10-26 15:11:15categories:    - Java    - JVMtags:    - JVM    - JVM调优  什么是JVM  ？ 定义： Java Virtual  Machine ＿ java程序的运行环环境（java二进制字节码的运行环境） 好处： 一次编写，到处运行 自动内存管理，垃圾回收功能 数组下标越界检查 多态">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM">
<meta property="og:url" content="https://kblayt.github.io/2022/10/26/Java%20Virtual%20Machine/JVM/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="title: JVMdate: 2022-10-26 15:11:15categories:    - Java    - JVMtags:    - JVM    - JVM调优  什么是JVM  ？ 定义： Java Virtual  Machine ＿ java程序的运行环环境（java二进制字节码的运行环境） 好处： 一次编写，到处运行 自动内存管理，垃圾回收功能 数组下标越界检查 多态">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://kblayt.github.io/JVM/63923723e6a1ee131cc1e80176ef78f8.jpeg">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCE25e1cb46f11e9645a38327ed44b90a70.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCE41561026b067c83cc38dbac758f4c182.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCEcb7171c291b81048105a4fcc1b3adb03.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCE25c52f6bcc83666a2b7882eeb1aafa8b.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCE985e7c0ac9a60d961a873d7fd4404924.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCEf9f8514f9942614b9db2a4882858fe5c.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCE478700b79798874b7d2c1a67fac3a8a9.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCE66d1731efb3000fc66666d0183362074.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCE18bfa381dad22654f3ac2ccde831e642.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCEd28878fea598d5b0ce56a9d8156f1569.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCE434ca1e65faa9ec0c2881244b85f3961.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCE5803d56511d00eed793f6dc0d2218794.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCE51d16482e606b4cd95d2f4147ee89ca2.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCEa7bec0913fa275fc4bb630c57a6bdd2b.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCEc770e97a68b73a5e3152462fbef6ec97.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCEe08ac275d90a93d3eb8985ba2171024f.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCE7f704c060d981682045cbee26a35eeeb.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCE3463ee2dc6acab7dccf42a00cd82cbeb.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221026091351137.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221026095722397.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/WEBRESOURCE3463ee2dc6acab7dccf42a00cd82cbeb.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221026170923648.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221026171211997.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221027085226369.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221027092433116.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221027135600774.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221027135813905.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221027135944213.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221027135957779.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221027140013820.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221027140030356.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221027140540693.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221027141430630.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221027200556584.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221027201022728.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221027202342818.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221028090805853.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221028094245001.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221028094253567.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221028094305004.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221028094850389.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221028095006258.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221028095213153.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221028095242383.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221028095308744.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221031110544226.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221031140109206.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221031140141999.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221031140206312.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221031140257982.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221031140316845.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102103445192.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102103427032.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102103518271.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102103601651.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102103614954.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102103632461.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102103643166.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102103656297.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102103705315.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102103722807.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102103815252.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102103929219.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102103934229.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104009697.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104021847.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104029382.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104045057.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104057398.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104108668.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104115884.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104129152.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104135622.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104145763.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104153687.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104205754.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104212672.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104241504.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104325220.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104450398.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104455844.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104520641.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104530903.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104537395.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104544336.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104556881.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104603865.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104617984.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104624772.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104630356.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104636559.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102104641852.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102105020761.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102105228962.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102105408966.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102105618094.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102105803812.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102105843791.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102110127313.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102110145382.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102110235601.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102110306376.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102110319143.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102110340837.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102110353791.png">
<meta property="og:image" content="https://kblayt.github.io/JVM/image-20221102110413384.png">
<meta property="article:published_time" content="2022-10-26T07:11:15.000Z">
<meta property="article:modified_time" content="2023-06-29T15:35:50.765Z">
<meta property="article:author" content="Kblayt">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://kblayt.github.io/JVM/63923723e6a1ee131cc1e80176ef78f8.jpeg">
  
  
  
  <title>JVM - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"kblayt.github.io","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="JVM"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-10-26 15:11" pubdate>
          2022年10月26日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          28k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          234 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">JVM</h1>
            
            
              <div class="markdown-body">
                
                <hr>
<p>title: JVM<br>date: 2022-10-26 15:11:15<br>categories:<br>    - Java<br>    - JVM<br>tags:<br>    - JVM<br>    - JVM调优</p>
<hr>
<h1 id="什么是JVM-？"><a href="#什么是JVM-？" class="headerlink" title="什么是JVM  ？"></a>什么是JVM  ？</h1><p> 定义：</p>
<p>Java Virtual  Machine ＿ java程序的运行环环境（java二进制字节码的运行环境）</p>
<p>好处：</p>
<p>一次编写，到处运行</p>
<p>自动内存管理，垃圾回收功能</p>
<p>数组下标越界检查</p>
<p>多态</p>
<p>比较：</p>
<p>JVM，JRE，JDK</p>
<p><img src="/JVM/63923723e6a1ee131cc1e80176ef78f8.jpeg" srcset="/img/loading.gif" lazyload alt="63923723e6a1ee131cc1e80176ef78f8"></p>
<h1 id="学习JVM有什么用"><a href="#学习JVM有什么用" class="headerlink" title="学习JVM有什么用"></a>学习JVM有什么用</h1><p>面试</p>
<p>理解底层的实现原理</p>
<p>中高级程序员必备技能</p>
<p><img src="/JVM/WEBRESOURCE25e1cb46f11e9645a38327ed44b90a70.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCE25e1cb46f11e9645a38327ed44b90a70"></p>
<p><img src="/JVM/WEBRESOURCE41561026b067c83cc38dbac758f4c182.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCE41561026b067c83cc38dbac758f4c182"></p>
<p>1、JVM内存结构</p>
<p>2、GC垃圾回收</p>
<p>3、Java Class（类的字节码结构、编译器的优化等等）</p>
<p>4、ClassLoader类加载器</p>
<p>5、类运行时的一些优化（JIT Compiler即时编译器）</p>
<h1 id="1、内存结构"><a href="#1、内存结构" class="headerlink" title="1、内存结构"></a>1、内存结构</h1><h2 id="1-1、程序计数器"><a href="#1-1、程序计数器" class="headerlink" title="1.1、程序计数器"></a>1.1、程序计数器</h2><p><img src="/JVM/WEBRESOURCEcb7171c291b81048105a4fcc1b3adb03.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCEcb7171c291b81048105a4fcc1b3adb03"></p>
<ul>
<li><p>定义：Program Counter Register 程序计数器（寄存器）</p>
</li>
<li><p>Java中虚拟机指令执行流程：将源代码翻译成为jvm指令，再交给解释器，解释器再交给机器码，机器码再交给CPU运行</p>
</li>
<li><p>作用：实际上就是在程序运行中记住下一条jvm指令的执行地址</p>
</li>
<li><p>物理上实现程序计数器是通过寄存器(读取速度最快的一个单元)来实现的</p>
</li>
</ul>
<p><img src="/JVM/WEBRESOURCE25c52f6bcc83666a2b7882eeb1aafa8b.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCE25c52f6bcc83666a2b7882eeb1aafa8b"></p>
<ul>
<li><p>特点：</p>
</li>
<li><p>是一块较小的内存空间</p>
</li>
<li><p>是线程私有的，随着线程创建而创建，随着线程销毁而销毁</p>
</li>
<li><p>不会存在内存溢出</p>
</li>
</ul>
<h2 id="1-2、虚拟机栈"><a href="#1-2、虚拟机栈" class="headerlink" title="1.2、虚拟机栈"></a>1.2、虚拟机栈</h2><p><img src="/JVM/WEBRESOURCE985e7c0ac9a60d961a873d7fd4404924.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCE985e7c0ac9a60d961a873d7fd4404924"></p>
<h3 id="1-2-1、Java-Virtual-Machine-Stacks-Java虚拟机栈"><a href="#1-2-1、Java-Virtual-Machine-Stacks-Java虚拟机栈" class="headerlink" title="1.2.1、Java Virtual Machine Stacks(Java虚拟机栈)"></a>1.2.1、Java Virtual Machine Stacks(Java虚拟机栈)</h3><p><img src="/JVM/WEBRESOURCEf9f8514f9942614b9db2a4882858fe5c.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCEf9f8514f9942614b9db2a4882858fe5c"></p>
<ul>
<li>虚拟机栈：实际上就是线程运行需要的内存空间</li>
<li>每个栈有多个栈帧(Frame)组成，对应着每次方法调用时所占用的内存</li>
<li>栈帧：实际上就是每个方法运行时需要的内存</li>
<li>每个线程只能有一个活动栈帧，对应着当前正在执行的那个方法</li>
</ul>
<p><strong>用处：是用来存放在函数中定义的一些基本类型的变量和对象的引用变量</strong></p>
<p>问题辨析：</p>
<p>1.垃圾回收是否涉及栈内存？不涉及</p>
<p>2.栈内存分配越大越好吗？不是</p>
<p>3.方法内的局部变量是否线程安全？</p>
<p>如果方法内局部变量没有逃离方法的作用范围，那么它是线程安全的</p>
<p>如果是局部变量引用了对象，或逃离方法的作用范围，则需要考虑线程安全问题</p>
<p><img src="/JVM/WEBRESOURCE478700b79798874b7d2c1a67fac3a8a9.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCE478700b79798874b7d2c1a67fac3a8a9"></p>
<p>只有第一个方法中的sb是线程安全的，另外两个皆是线程不安全的，主要是看</p>
<h3 id="1-2-2、栈内存溢出"><a href="#1-2-2、栈内存溢出" class="headerlink" title="1.2.2、栈内存溢出"></a>1.2.2、栈内存溢出</h3><p>-Xss256k通过该参数来设置占内存大小</p>
<p>两种情况会导致占内存溢出(java.lang.StackOverflowError)：</p>
<ul>
<li><p>栈帧过多导致占内存溢出(方法递归调用没有限制，或方法循环调用)</p>
</li>
<li><p>栈帧过大导致占内存溢出(此类情况不常见)</p>
</li>
</ul>
<h3 id="1-2-3、线程运行诊断"><a href="#1-2-3、线程运行诊断" class="headerlink" title="1.2.3、线程运行诊断"></a>1.2.3、线程运行诊断</h3><p>案例1：cpu占用过多</p>
<p>解决方案：</p>
<p>①top命令查看cpu内存使用情况，有无占用cpu极高的进程</p>
<p>②使用ps H -eo pid,tid,%cpu命令，H意思是打印所有进程中所有线程信息，-eo后面带所感兴趣的内容</p>
<p>③找到进程中占用cpu过高的线程id</p>
<p>④使用ps H -eo pid,tid,%cpu | grep 线程id，来筛选出对应占用cpu过高的线程信息</p>
<p>⑤使用jstack 进程id 命令来查看到底是那个线程出现了问题</p>
<p>⑥找到对应16进制的nid就是异常线程，进一步定位到出现问题的源代码行数以此来解决问题</p>
<p><img src="/JVM/WEBRESOURCE66d1731efb3000fc66666d0183362074.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCE66d1731efb3000fc66666d0183362074"></p>
<p>案列2：程序运行很长时间没有结果</p>
<p>解决方案：</p>
<p>①使用jstack 进程id 命令来查看</p>
<p><img src="/JVM/WEBRESOURCE18bfa381dad22654f3ac2ccde831e642.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCE18bfa381dad22654f3ac2ccde831e642"></p>
<p><img src="/JVM/WEBRESOURCEd28878fea598d5b0ce56a9d8156f1569.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCEd28878fea598d5b0ce56a9d8156f1569"></p>
<h2 id="1-3、本地方法栈"><a href="#1-3、本地方法栈" class="headerlink" title="1.3、本地方法栈"></a>1.3、本地方法栈</h2><p><img src="/JVM/WEBRESOURCE434ca1e65faa9ec0c2881244b85f3961.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCE434ca1e65faa9ec0c2881244b85f3961"></p>
<p>本地方法(Native Method)：指不是由java编写的代码，java无法直接调用一些硬件结构和底层，需要通过C++或C语言的接口来间接调用硬件。</p>
<h2 id="1-4、堆（Heap）"><a href="#1-4、堆（Heap）" class="headerlink" title="1.4、堆（Heap）"></a>1.4、堆（Heap）</h2><p>定义：</p>
<ul>
<li>通过new关键字，创建对象都会使用堆内存</li>
</ul>
<p>特点</p>
<ul>
<li>它是线程共享的，堆中对象都需要考虑线程安全的问题</li>
<li>有垃圾回收机制</li>
</ul>
<p><strong>用处：是用来存放由new创建的对象和数组，即动态申请的内存都存放在堆内存</strong></p>
<h3 id="1-4-2、堆内存溢出"><a href="#1-4-2、堆内存溢出" class="headerlink" title="1.4.2、堆内存溢出"></a>1.4.2、堆内存溢出</h3><p>java.lang.OutOfMemoryError</p>
<p>-Xmx8m 设置堆大小的参数</p>
<p><img src="/JVM/WEBRESOURCE5803d56511d00eed793f6dc0d2218794.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCE5803d56511d00eed793f6dc0d2218794"></p>
<h3 id="1-4-3、堆内存诊断"><a href="#1-4-3、堆内存诊断" class="headerlink" title="1.4.3、堆内存诊断"></a>1.4.3、堆内存诊断</h3><p>1、jps工具</p>
<ul>
<li>查看当前系统中有哪些java进程</li>
</ul>
<p><img src="/JVM/WEBRESOURCE51d16482e606b4cd95d2f4147ee89ca2.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCE51d16482e606b4cd95d2f4147ee89ca2"></p>
<p>2、jmap工具</p>
<ul>
<li><p>jmap -heap 进程id</p>
</li>
<li><p>查看堆内存占用情况</p>
</li>
</ul>
<p>3、jconsole工具</p>
<ul>
<li>图形界面的，多功能的检测工具，可以连续监测</li>
</ul>
<p><img src="/JVM/WEBRESOURCEa7bec0913fa275fc4bb630c57a6bdd2b.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCEa7bec0913fa275fc4bb630c57a6bdd2b"></p>
<p>4、jvisualvm</p>
<ul>
<li>图形界面</li>
</ul>
<p><img src="/JVM/WEBRESOURCEc770e97a68b73a5e3152462fbef6ec97.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCEc770e97a68b73a5e3152462fbef6ec97"></p>
<p>案列</p>
<ul>
<li>垃圾回收后，内存占用仍然很高</li>
</ul>
<p>解决方案：</p>
<p>使用jvisualvm进行排查</p>
<h2 id="1-5、方法区"><a href="#1-5、方法区" class="headerlink" title="1.5、方法区"></a>1.5、方法区</h2><p><img src="/JVM/WEBRESOURCEe08ac275d90a93d3eb8985ba2171024f.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCEe08ac275d90a93d3eb8985ba2171024f"></p>
<h3 id="1-5-1、Java1-8中对方法中的定义"><a href="#1-5-1、Java1-8中对方法中的定义" class="headerlink" title="1.5.1、Java1.8中对方法中的定义"></a>1.5.1、Java1.8中对方法中的定义</h3><p><img src="/JVM/WEBRESOURCE7f704c060d981682045cbee26a35eeeb.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCE7f704c060d981682045cbee26a35eeeb"></p>
<h3 id="1-5-2、组成"><a href="#1-5-2、组成" class="headerlink" title="1.5.2、组成"></a>1.5.2、组成</h3><p><img src="/JVM/WEBRESOURCE3463ee2dc6acab7dccf42a00cd82cbeb.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCE3463ee2dc6acab7dccf42a00cd82cbeb"></p>
<h3 id="1-5-3、方法区内存溢出"><a href="#1-5-3、方法区内存溢出" class="headerlink" title="1.5.3、方法区内存溢出"></a>1.5.3、方法区内存溢出</h3><ul>
<li>1.8以前会导致永久代内存溢出</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">演示永久代内存溢出 java.lang.OutOfMemoryError: PermGen space<br>-XX:<span class="hljs-attribute">MaxPermSize</span>=8m<br></code></pre></td></tr></table></figure>

<ul>
<li>1.8之后会导致元空间内存溢出</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">演示元空间内存溢出 java.lang.OutOfMemoryError: Metaspace<br>-XX:<span class="hljs-attribute">MaxMetaspaceSize</span>=8M<br></code></pre></td></tr></table></figure>

<p>反编译指令：<img src="/JVM/image-20221026091351137.png" srcset="/img/loading.gif" lazyload alt="image-20221026091351137"></p>
<p><strong>javap</strong>的使用</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">javap </span>是<span class="hljs-keyword">JDK自带的反汇编器，可以查看java编译器为我们生成的字节码。通过它，我们可以对照源代码和字节码，从而了解很多编译器内部的工作。</span><br><span class="hljs-keyword"></span>语法：<br>　　 <span class="hljs-keyword">javap </span>[ 命令选项 ] class. . .<br>　　 <span class="hljs-keyword">javap </span>命令用于解析类文件。其输出取决于所用的选项。若没有使用选项， <span class="hljs-keyword">javap </span>将输出传递给它的类的 public 域及方法。 <span class="hljs-keyword">javap </span>将其输出到标准输出设备上。<br>命令选项<br>　　-help 输出 <span class="hljs-keyword">javap </span>的帮助信息。<br>　　-l 输出行及局部变量表。<br>　　-<span class="hljs-keyword">b </span>确保与 <span class="hljs-keyword">JDK </span><span class="hljs-number">1</span>.<span class="hljs-number">1</span> <span class="hljs-keyword">javap </span>的向后兼容性。<br>　　-public 只显示 public 类及成员。<br>　　-protected 只显示 protected 和 public 类及成员。<br>　　-package 只显示包、protected 和 public 类及成员。这是缺省设置。<br>　　-private 显示所有类和成员。<br>　　-<span class="hljs-keyword">J[flag] </span>直接将 flag 传给运行时系统。<br>　　-s 输出内部类型签名。<br>　　-c 输出类中各方法的未解析的代码，即构成 <span class="hljs-keyword">Java </span>字节码的指令。<br>　　-verbose 输出堆栈大小、各方法的 locals 及 args 数,以及class文件的编译版本<br>　　-classpath[路径] 指定 <span class="hljs-keyword">javap </span>用来查找类的路径。如果设置了该选项，则它将覆盖缺省值或 CLASSPATH 环境变量。目录用冒号分隔。<br> 　 -<span class="hljs-keyword">bootclasspath[路径] </span>指定加载自举类所用的路径。缺省情况下，自举类是实现核心 <span class="hljs-keyword">Java </span>平台的类，位于 <span class="hljs-keyword">jrelib下面。</span><br><span class="hljs-keyword"></span>　　-<span class="hljs-keyword">extdirs[dirs] </span>覆盖搜索安装方式扩展的位置。扩展的缺省位置是 <span class="hljs-keyword">jrelibext。</span><br></code></pre></td></tr></table></figure>

<h3 id="1-5-4、运行时常量池"><a href="#1-5-4、运行时常量池" class="headerlink" title="1.5.4、运行时常量池"></a>1.5.4、运行时常量池</h3><ul>
<li>常量池，就是一张表，虚拟机指令根据这张常量表找到要执行的类名、方法名、参数类型、字面量等信息</li>
<li>运行时常量池，常量池是*.class文件中的，当该类被加载，它的常量池信息就会放入运行时常量池，并把里面的符号地址变为真实地址</li>
</ul>
<h3 id="1-5-5、StringTable"><a href="#1-5-5、StringTable" class="headerlink" title="1.5.5、StringTable"></a>1.5.5、StringTable</h3><p><img src="/JVM/image-20221026095722397.png" srcset="/img/loading.gif" lazyload alt="image-20221026095722397"></p>
<ol>
<li>常量池中的信息，都会被加载到运行时常量池中，这时a、b、ab都是常量池中的符号，还没有变为java字符串对象</li>
<li>当程序运行到该处时ldc #7会把a符号变为“a”字符串对象此时串池StringTable[]若没有“a”对象就会把对象“a”放入串池StringTable[“a”]、ldc #9会把b符号变为“b”字符串对象此时串池StringTable[“a”]若没有“a”对象就会把对象“a”放入串池StringTable[“a”,”b”]、ldc #11会把ab符号变为“ab”字符串对象此时串池StringTable[“a”,”b”]若没有“a”对象就会把对象“a”放入串池StringTable[“a”,”b”,”ab”]</li>
</ol>
<p><strong>StringTable特性</strong></p>
<ul>
<li>常量池中的字符串仅是符号，第一次用到时才变为对象</li>
<li>利用串池的机制，来避免重复创建字符串对象</li>
<li>字符串变量拼接的原理时StringBuilder(1.8)</li>
<li>字符串常量拼接的原理时编译期优化</li>
<li>可以使用intern方法，主动将串池中还没有的字符串对象放入串池<ul>
<li>jdk1.8将这个字符串对象尝试放入串池，<strong>如果有则并不会放入，如果没有则把元对象放入串池，会把串池中的对象返回</strong></li>
<li>jdk1.6将这个字符串对象尝试放入串池，<strong>如果有则并不会放入，如果没有会把此对象复制一份（副本跟原对象不同），将副本放入串池，会把串池中的副本对象返回</strong></li>
</ul>
</li>
</ul>
<h3 id="1-5-6、StringTable位置"><a href="#1-5-6、StringTable位置" class="headerlink" title="1.5.6、StringTable位置"></a>1.5.6、StringTable位置</h3><p><img src="/JVM/WEBRESOURCE3463ee2dc6acab7dccf42a00cd82cbeb.png" srcset="/img/loading.gif" lazyload alt="WEBRESOURCE3463ee2dc6acab7dccf42a00cd82cbeb"></p>
<h3 id="1-5-7、StringTable垃圾回收"><a href="#1-5-7、StringTable垃圾回收" class="headerlink" title="1.5.7、StringTable垃圾回收"></a>1.5.7、StringTable垃圾回收</h3><h3 id="1-5-8、性能调优"><a href="#1-5-8、性能调优" class="headerlink" title="1.5.8、性能调优"></a>1.5.8、性能调优</h3><ul>
<li>调整 -XX:StringTableSize&#x3D;桶个数</li>
<li>考虑将字符串对象是否入池</li>
</ul>
<h2 id="1-6、直接内存（操作系统的内存）"><a href="#1-6、直接内存（操作系统的内存）" class="headerlink" title="1.6、直接内存（操作系统的内存）"></a>1.6、直接内存（操作系统的内存）</h2><h3 id="1-6-1、Direct-Memory"><a href="#1-6-1、Direct-Memory" class="headerlink" title="1.6.1、Direct Memory"></a>1.6.1、Direct Memory</h3><ul>
<li>常见于NIO操作时，用于数据缓冲区</li>
<li>分配回收成本较高，但读写性能高</li>
<li>不受JVM内存回收管理</li>
</ul>
<p>传统IO流文件读写过程：</p>
<p><img src="/JVM/image-20221026170923648.png" srcset="/img/loading.gif" lazyload alt="image-20221026170923648"></p>
<p>NIO文件读写过程</p>
<p><img src="/JVM/image-20221026171211997.png" srcset="/img/loading.gif" lazyload alt="image-20221026171211997"></p>
<h2 id="1-6-2、分配和回收原理"><a href="#1-6-2、分配和回收原理" class="headerlink" title="1.6.2、分配和回收原理"></a>1.6.2、分配和回收原理</h2><ul>
<li>使用了Unsafe对象 完成直接内存的分配回收，并且回收需要主动调用freeMemory方法</li>
<li>ByteBuffer的实现类内部，使用了Cleaner（虚引用）来检测ByteBuffer对象，一旦ByteBuffer对象被垃圾回收，那么就会由ReferenceHandler线程通过Cleaner的clean方法调用freeMemory来释放直接内存</li>
</ul>
<p>-XX:+DisableExplicitGC （禁用显示的垃圾回收）也就是代码中的System.gc()</p>
<h1 id="2、垃圾回收"><a href="#2、垃圾回收" class="headerlink" title="2、垃圾回收"></a>2、垃圾回收</h1><h2 id="2-1、如何判断对象可以回收？"><a href="#2-1、如何判断对象可以回收？" class="headerlink" title="2.1、如何判断对象可以回收？"></a>2.1、如何判断对象可以回收？</h2><h3 id="2-1-1、引用计数法"><a href="#2-1-1、引用计数法" class="headerlink" title="2.1.1、引用计数法"></a>2.1.1、引用计数法</h3><p><strong>概念：</strong>只要一个对象被其他变量所引用，那我就让这个对象的计数加一，如果它被引用了两次那就让它的计数变成二，如果某个变量不再引用它了那么就让它的计数减一，当这个对象的引用计数变为零的时候那就意味着没有人引用它了，那么它就会被垃圾回收。</p>
<p><strong>问题：</strong>循环引用</p>
<p><img src="/JVM/image-20221027085226369.png" srcset="/img/loading.gif" lazyload alt="image-20221027085226369"></p>
<p>此时A、B的引用计数都为1，但没有对象使用他们了，又由于他们的引用计数都不唯一导致它们不能被垃圾回收。（早期python在垃圾回收时就采用了引用技术的算法。）</p>
<h3 id="2-1-2、可达性分析法"><a href="#2-1-2、可达性分析法" class="headerlink" title="2.1.2、可达性分析法"></a>2.1.2、可达性分析法</h3><p><strong>概念：</strong>首先会确定一系列根对象，根对象就是那些肯定不能当成垃圾被回收的对象。在垃圾回收之前首先会对堆中的所有对象进行一边扫描，看看哪些对象会被根对象直接或间接的引用，如果是这个对象就不能被回收，反之可以被回收。</p>
<ul>
<li>Java虚拟机中的垃圾回收器采用可达性分析算法来探索所有存活的对象</li>
<li>扫描堆中的对象，看是否能够沿着GC Root对象为起点的引用链找到该对象，找不到，表示可以回收</li>
<li>哪些对象可以作为GC Root？（System Class、Native Stack、Thread、Busy Monitor）</li>
</ul>
<p>使用过eclipse提供的Memory Analyzer(MAT)来帮助分析。</p>
<p>为了配合MAT的使用先运行起来再通过jmap快照抓取下来再用MAT进行分析。</p>
<h3 id="2-1-3、四种引用"><a href="#2-1-3、四种引用" class="headerlink" title="2.1.3、四种引用"></a>2.1.3、四种引用</h3><p><img src="/JVM/image-20221027092433116.png" srcset="/img/loading.gif" lazyload alt="image-20221027092433116"></p>
<h4 id="2-1-3-1、强引用"><a href="#2-1-3-1、强引用" class="headerlink" title="2.1.3.1、强引用"></a>2.1.3.1、强引用</h4><ul>
<li><p>定义：沿着某个GC Root的引用链能够找到的对象就属于强引用。</p>
</li>
<li><p>回收条件：只有当所有强引用都断开时该对象才能被垃圾回收。</p>
</li>
</ul>
<h4 id="2-1-3-2、软引用-SoftReference"><a href="#2-1-3-2、软引用-SoftReference" class="headerlink" title="2.1.3.2、软引用(SoftReference)"></a>2.1.3.2、软引用(SoftReference)</h4><ul>
<li><p>仅有软引用引用过该对象时，在垃圾回收后，内存仍不足时会再次触发垃圾回收，回收引用对象</p>
</li>
<li><p>可以配合引用队列来释放软引用自身</p>
</li>
</ul>
<h4 id="2-1-3-3、弱引用-WeakReference"><a href="#2-1-3-3、弱引用-WeakReference" class="headerlink" title="2.1.3.3、弱引用(WeakReference)"></a>2.1.3.3、弱引用(WeakReference)</h4><ul>
<li>仅有弱引用引用该对象时，在垃圾回收时，无论内存是否充足，都会回收弱引用对象</li>
<li>可以配合引用队列来释放弱引用自身</li>
</ul>
<h4 id="2-1-3-4、虚引用-PhantomReference"><a href="#2-1-3-4、虚引用-PhantomReference" class="headerlink" title="2.1.3.4、虚引用(PhantomReference)"></a>2.1.3.4、虚引用(PhantomReference)</h4><ul>
<li>必须配合引用该队列使用，主要配合ByteBuffer使用，被引用对象回收时，会将虚引用入队，由Reference Handler线程调用虚拟引用相关方法释放直接内存</li>
</ul>
<h4 id="2-1-3-5、终结器引用-FinalReference"><a href="#2-1-3-5、终结器引用-FinalReference" class="headerlink" title="2.1.3.5、终结器引用(FinalReference)"></a>2.1.3.5、终结器引用(FinalReference)</h4><ul>
<li>必须配合引用该队列使用，无需手动编码，但其内部配合引用队列使用，在垃圾回收时，终结器引用入队(被引用对象暂时没看被回收)，再由Finalizer线程通过终结器引用找到被引用对象并调用它的finalize方法，第二次GC时才能回收被引用对象。</li>
</ul>
<p><strong>软引用实例：</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 演示软引用, 配合引用队列</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Demo2_4</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-built_in">int</span> _4MB = <span class="hljs-number">4</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> &#123;<br>        List&lt;SoftReference&lt;<span class="hljs-built_in">byte</span>[]&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br><br>        <span class="hljs-comment">// 引用队列</span><br>        ReferenceQueue&lt;<span class="hljs-built_in">byte</span>[]&gt; queue = <span class="hljs-keyword">new</span> ReferenceQueue&lt;&gt;();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>            <span class="hljs-comment">// 关联了引用队列， 当软引用所关联的 byte[]被回收时，软引用自己会加入到 queue 中去</span><br>            SoftReference&lt;<span class="hljs-built_in">byte</span>[]&gt; <span class="hljs-keyword">ref</span> = <span class="hljs-keyword">new</span> SoftReference&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-built_in">byte</span>[_4MB], queue);<br>            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">ref</span>.<span class="hljs-keyword">get</span>());<br>            list.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">ref</span>);<br>            System.<span class="hljs-keyword">out</span>.println(list.size());<br>        &#125;<br><br>        <span class="hljs-comment">// 从队列中获取无用的 软引用对象，并移除</span><br>        Reference&lt;? extends <span class="hljs-built_in">byte</span>[]&gt; poll = queue.poll();<br>        <span class="hljs-keyword">while</span>( poll != <span class="hljs-literal">null</span>) &#123;<br>            list.<span class="hljs-keyword">remove</span>(poll);<br>            poll = queue.poll();<br>        &#125;<br><br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;===========================&quot;</span>);<br>        <span class="hljs-keyword">for</span> (SoftReference&lt;<span class="hljs-built_in">byte</span>[]&gt; reference : list) &#123;<br>            System.<span class="hljs-keyword">out</span>.println(reference.<span class="hljs-keyword">get</span>());<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>弱引用实例</strong>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 演示弱引用</span><br><span class="hljs-comment"> * -Xmx20m -XX:+PrintGCDetails -verbose:gc</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Demo2_5</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-built_in">int</span> _4MB = <span class="hljs-number">4</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> &#123;<br>        <span class="hljs-comment">//  list --&gt; WeakReference --&gt; byte[]</span><br>        List&lt;WeakReference&lt;<span class="hljs-built_in">byte</span>[]&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            WeakReference&lt;<span class="hljs-built_in">byte</span>[]&gt; <span class="hljs-keyword">ref</span> = <span class="hljs-keyword">new</span> WeakReference&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-built_in">byte</span>[_4MB]);<br>            list.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">ref</span>);<br>            <span class="hljs-keyword">for</span> (WeakReference&lt;<span class="hljs-built_in">byte</span>[]&gt; w : list) &#123;<br>                System.<span class="hljs-keyword">out</span>.print(w.<span class="hljs-keyword">get</span>()+<span class="hljs-string">&quot; &quot;</span>);<br>            &#125;<br>            System.<span class="hljs-keyword">out</span>.println();<br><br>        &#125;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;循环结束：&quot;</span> + list.size());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-2、垃圾回收算法"><a href="#2-2、垃圾回收算法" class="headerlink" title="2.2、垃圾回收算法"></a>2.2、垃圾回收算法</h2><h3 id="2-2-1、标记清除"><a href="#2-2-1、标记清除" class="headerlink" title="2.2.1、标记清除"></a>2.2.1、标记清除</h3><p>定义：Mark Sweep</p>
<p><img src="/JVM/image-20221027135600774.png" srcset="/img/loading.gif" lazyload alt="image-20221027135600774"></p>
<p>优点：速度快</p>
<p>缺点：容易产生内存碎片</p>
<h3 id="2-2-2、标记整理"><a href="#2-2-2、标记整理" class="headerlink" title="2.2.2、标记整理"></a>2.2.2、标记整理</h3><p>定义：Mark Compact</p>
<p><img src="/JVM/image-20221027135813905.png" srcset="/img/loading.gif" lazyload alt="image-20221027135813905"></p>
<p>优点：不会产生内存碎片</p>
<p>缺点：效率比较低</p>
<h3 id="2-2-3、复制"><a href="#2-2-3、复制" class="headerlink" title="2.2.3、复制"></a>2.2.3、复制</h3><p>定义：Copy</p>
<p><img src="/JVM/image-20221027135944213.png" srcset="/img/loading.gif" lazyload alt="image-20221027135944213"></p>
<p><img src="/JVM/image-20221027135957779.png" srcset="/img/loading.gif" lazyload alt="image-20221027135957779"></p>
<p><img src="/JVM/image-20221027140013820.png" srcset="/img/loading.gif" lazyload alt="image-20221027140013820"> </p>
<p><img src="/JVM/image-20221027140030356.png" srcset="/img/loading.gif" lazyload alt="image-20221027140030356"></p>
<p>优点：不会产生内存碎片</p>
<p>缺点：会占用双倍的内存空间</p>
<h2 id="2-3、分代垃圾回收"><a href="#2-3、分代垃圾回收" class="headerlink" title="2.3、分代垃圾回收"></a>2.3、分代垃圾回收</h2><p><strong>老年代：</strong>Java中长时间使用（长时间存活）的对象存储在老年代当中，老年代的垃圾回收很久才发生一次</p>
<p><strong>新生代</strong>：Java中用完了就可以丢弃的（朝生幕死）对象存储在新生代当中，新生代的垃圾回收(Minor GC)发生的比较频繁</p>
<p><img src="/JVM/image-20221027140540693.png" srcset="/img/loading.gif" lazyload alt="image-20221027140540693"></p>
<p><strong>分代垃圾回收的执行顺序：</strong></p>
<p><img src="/JVM/image-20221027141430630.png" srcset="/img/loading.gif" lazyload alt="image-20221027141430630"></p>
<ul>
<li><p>对象首先分配在伊甸园区域</p>
</li>
<li><p>当新生代空间不足时，触发minor GC，伊甸园和from存活的对象使用copy算法复制到to中，存活的对象年龄加一并且交换from和to</p>
</li>
<li><p>minor GC会引发stop the world，暂停其它用户的线程，等垃圾回收结束，用户线程才恢复运行</p>
</li>
<li><p>当对象寿命超过阈值时，会晋升至老年代，最大寿命是15（4bit）</p>
</li>
<li><p>当老年代空间不足，会尝试先出发minor GC，如果之后仍空间不足，那么会触发full GC(STW的时间更长)。</p>
</li>
<li><p>如果full GC之后空间仍不足，则会触发OOM(Out Of Memory)异常</p>
<p><strong>相关VM参数</strong></p>
<table>
<thead>
<tr>
<th>含义</th>
<th>参数</th>
</tr>
</thead>
<tbody><tr>
<td>堆初始大小</td>
<td>-Xms</td>
</tr>
<tr>
<td>堆最大大小</td>
<td>-Xmx或-XX:MaxHeapSize&#x3D;size</td>
</tr>
<tr>
<td>新生代大小</td>
<td>-Xmn或（-XX:NewSize&#x3D;size + -XX:MaxNewSize&#x3D;size）</td>
</tr>
<tr>
<td>幸存区比例（动态）</td>
<td>-XX:InitialSurvivorRatio&#x3D;ratio和-XX:+UseAdaptiveSizePolicy</td>
</tr>
<tr>
<td>幸存区比例</td>
<td>-XX:SurvivorRatio&#x3D;ratio</td>
</tr>
<tr>
<td>晋升阈值</td>
<td>-XX:MaxTenuringThreshold&#x3D;threshold</td>
</tr>
<tr>
<td>晋升详情</td>
<td>-XX:+PrintTenuringDistribution</td>
</tr>
<tr>
<td>GC详情</td>
<td>-XX:+PrintGCDetails -verbose:gc</td>
</tr>
<tr>
<td>Full GC 前 Minor GC</td>
<td>-XX:+ScavengeBeforeFullGC</td>
</tr>
</tbody></table>
</li>
<li><p>一个线程内部的OOM不会导致整个主线程终短</p>
</li>
</ul>
<h2 id="2-4、垃圾回收器"><a href="#2-4、垃圾回收器" class="headerlink" title="2.4、垃圾回收器"></a>2.4、垃圾回收器</h2><h3 id="2-4-1、串行"><a href="#2-4-1、串行" class="headerlink" title="2.4.1、串行"></a>2.4.1、串行</h3><ul>
<li><p>单线程</p>
</li>
<li><p>堆内存较小，适合个人电脑</p>
</li>
<li><p>开启串行回收器语句： -XX:UseSerialGC &#x3D; Serial + SerialOld</p>
<p>**ps:**此处的Serial处于新生代，采用的算法为复制(Copy)算法。Serialold处于老年代，采用的算法为标记整理算法。</p>
<p><img src="/JVM/image-20221027200556584.png" srcset="/img/loading.gif" lazyload alt="image-20221027200556584"></p>
</li>
</ul>
<h3 id="2-4-2、吞吐量优先"><a href="#2-4-2、吞吐量优先" class="headerlink" title="2.4.2、吞吐量优先"></a>2.4.2、吞吐量优先</h3><ul>
<li><p>多线程</p>
</li>
<li><p>堆内存较大，多核CPU</p>
</li>
<li><p>让单位时间内，STW的时间最短0.2 0.2 &#x3D; 0.4，垃圾回收时间占比最低，这样就称吞吐量高</p>
</li>
<li><p>开启吞吐量优先回收器语句：-XX:+UseParallelGC ~ -XX:+UseParallelOldGC</p>
<ul>
<li>控制线程数：-XX:ParallelGCThreads&#x3D;n</li>
<li>采用调整自适应大小策略(调整的是新生代的大小)：-XX:+UseAdaptiveSizePolicy</li>
<li>用来调整堆的大小来达到期望的吞吐量目标-XX:GCTimeRatio&#x3D;ratio （公式：1&#x2F;(1+ratio)）(若ratio为99，则意为允许在100分钟内有1分钟的时间来STW用来GC)</li>
<li>用来调整每次垃圾回收的期望时间(默认的为200ms)-XX:MaxGCPauseMillis&#x3D;ms</li>
</ul>
<p><img src="/JVM/image-20221027201022728.png" srcset="/img/loading.gif" lazyload alt="image-20221027201022728"></p>
</li>
</ul>
<h3 id="2-4-3、响应时间优先"><a href="#2-4-3、响应时间优先" class="headerlink" title="2.4.3、响应时间优先"></a>2.4.3、响应时间优先</h3><ul>
<li><p>多线程</p>
</li>
<li><p>堆内存较大，多核CPU</p>
</li>
<li><p>尽可能让单次STW的时间最短0.1 0.1 0.1 0.1 0.1&#x3D;0.5</p>
</li>
<li><p>开启响应时间优先的回收器语句：-XX:+UseConcMarkSweepGC ~ -XX:+UseParNewGC ~ SerialOld</p>
<ul>
<li><p>并行和并发的线程数设置：-XX:ParallelGCThreads&#x3D;n ~ -XX:ConcGCThreads&#x3D;threads</p>
</li>
<li><p>执行CMS垃圾回收的内存占比：-XX:CMSInitiatingOccupancyFraction&#x3D;percent</p>
</li>
<li><p>设置CMS垃圾回收重新标记前清除垃圾：-XX:+CMSScavengeBeforeRemark</p>
</li>
</ul>
</li>
</ul>
<p><strong>ps：</strong>此处的ConcMarkSweepGC是工作在老年代的基于标记清除法的垃圾回收器，与之配合的是UseParNewGC，它是工作在新生代的基于复制算法的垃圾回收器。有时CMSGC会发生并发失败的问题，这个时候会采用补救措施SerialOld。</p>
<p><img src="/JVM/image-20221027202342818.png" srcset="/img/loading.gif" lazyload alt="image-20221027202342818"></p>
<h3 id="2-4-4、G1"><a href="#2-4-4、G1" class="headerlink" title="2.4.4、G1"></a>2.4.4、G1</h3><p>定义：Garbage First</p>
<ul>
<li>2004 论文发布 </li>
<li>2009 JDK 6u14 体验 </li>
<li>2012 JDK 7u4 官方支持 </li>
<li>2017 JDK 9 默认</li>
</ul>
<p>适用场景</p>
<ul>
<li>同时注重吞吐量（Throughput）和低延迟（Low latency），默认的暂停目标是 200 ms</li>
<li>超大堆内存，会将堆划分为多个大小相等的 Region</li>
<li>整体上是 标记+整理 算法，两个区域之间是 复制 算法</li>
</ul>
<p>相关JVM参数</p>
<ul>
<li><p>开启G1语句：-XX:+UseG1GC </p>
<ul>
<li><p>-XX:G1HeapRegionSize&#x3D;size </p>
</li>
<li><p>-XX:MaxGCPauseMillis&#x3D;time</p>
</li>
</ul>
</li>
</ul>
<h4 id="1）G1垃圾回收阶段"><a href="#1）G1垃圾回收阶段" class="headerlink" title="1）G1垃圾回收阶段"></a>1）G1垃圾回收阶段</h4><p><img src="/JVM/image-20221028090805853.png" srcset="/img/loading.gif" lazyload alt="image-20221028090805853"></p>
<h4 id="2）Young-Collection"><a href="#2）Young-Collection" class="headerlink" title="2）Young Collection"></a>2）Young Collection</h4><ul>
<li>会STW</li>
</ul>
<p><img src="/JVM/image-20221028094245001.png" srcset="/img/loading.gif" lazyload alt="image-20221028094245001"></p>
<p><img src="/JVM/image-20221028094253567.png" srcset="/img/loading.gif" lazyload alt="image-20221028094253567"></p>
<p><img src="/JVM/image-20221028094305004.png" srcset="/img/loading.gif" lazyload alt="image-20221028094305004"></p>
<h4 id="3）Young-Collection-CM-Concurrent-Mark"><a href="#3）Young-Collection-CM-Concurrent-Mark" class="headerlink" title="3）Young Collection + CM(Concurrent Mark)"></a>3）Young Collection + CM(Concurrent Mark)</h4><ul>
<li>在Young GC时会进行GC Root的初始标记</li>
<li>老年代占用堆空间比例达到阈值时，进行并发标记(不会STW)，有下面的JVM参数决定</li>
</ul>
<p>-XX:InitiatingHeapOccupancyPercent&#x3D;percent(默认45%)</p>
<p><img src="/JVM/image-20221028094850389.png" srcset="/img/loading.gif" lazyload alt="image-20221028094850389"></p>
<h4 id="4）Mixed-Collection"><a href="#4）Mixed-Collection" class="headerlink" title="4）Mixed Collection"></a>4）Mixed Collection</h4><p>会对E、S、O进行全面垃圾回收</p>
<ul>
<li>最终标记(Remark)会STW</li>
<li>拷贝存活(Evacuation)会STW</li>
</ul>
<p>-XX:MaxGCPauseMillis&#x3D;ms</p>
<p><img src="/JVM/image-20221028095006258.png" srcset="/img/loading.gif" lazyload alt="image-20221028095006258"></p>
<h4 id="5）Full-GC"><a href="#5）Full-GC" class="headerlink" title="5）Full GC"></a>5）Full GC</h4><ul>
<li>SerialGC<ul>
<li>新生代内存不足发生的垃圾收集器 - minor GC</li>
<li>老年代内存不足发生的垃圾收集器 - ful GC</li>
</ul>
</li>
<li>ParallelGC<ul>
<li>新生代内存不足发生的垃圾收集 - minor GC</li>
<li>老年代内存不足发生的垃圾收集 - full GC</li>
</ul>
</li>
<li>CMS<ul>
<li>新生代内存不足发生的垃圾收集 - minor GC</li>
<li>老年代内存不足</li>
</ul>
</li>
<li>G1<ul>
<li>新生代内存不足发生的垃圾收集 - minor GC</li>
<li>老年代内存不足</li>
</ul>
</li>
</ul>
<h4 id="6）Young-Collection跨代引用"><a href="#6）Young-Collection跨代引用" class="headerlink" title="6）Young Collection跨代引用"></a>6）Young Collection跨代引用</h4><ul>
<li>新生代回收的跨代引用(老年代引用新生代)问题</li>
</ul>
<p><img src="/JVM/image-20221028095213153.png" srcset="/img/loading.gif" lazyload alt="image-20221028095213153"></p>
<ul>
<li>卡表与 Remembered Set</li>
<li>在引用变更时通过 post-write barrier + dirty card queue</li>
<li>concurrent refinement threads 更新 Remembered Set</li>
</ul>
<p><img src="/JVM/image-20221028095242383.png" srcset="/img/loading.gif" lazyload alt="image-20221028095242383"></p>
<h4 id="7）Remark"><a href="#7）Remark" class="headerlink" title="7）Remark"></a>7）Remark</h4><ul>
<li>pre-write barrier + satb_mark_queue</li>
</ul>
<p><img src="/JVM/image-20221028095308744.png" srcset="/img/loading.gif" lazyload alt="image-20221028095308744"></p>
<h4 id="8）JDK-8u20字符串去重"><a href="#8）JDK-8u20字符串去重" class="headerlink" title="8）JDK 8u20字符串去重"></a>8）JDK 8u20字符串去重</h4><ul>
<li>优点：节省大量内存</li>
<li>缺点：略微躲闪用了cpu时间，新生代回收时间略微增加</li>
</ul>
<p>-XX:+UseStringDeduplication</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">String</span> s1 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>(<span class="hljs-string">&quot;hello&quot;</span>); <span class="hljs-regexp">//</span> char[]&#123;<span class="hljs-string">&#x27;h&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>&#125;<br><span class="hljs-built_in">String</span> s2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>(<span class="hljs-string">&quot;hello&quot;</span>); <span class="hljs-regexp">//</span> char[]&#123;<span class="hljs-string">&#x27;h&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>将所有新分配的字符串放入一个队列</li>
<li>当新生代回收时，G1并发检查是否有字符串重复</li>
<li>如果它们值一样，让它们引用同一个 char[]</li>
<li>注意，与 String.intern() 不一样<ul>
<li>String.intern() 关注的是字符串对象</li>
<li>而字符串去重关注的是 char[]</li>
<li>在 JVM 内部，使用了不同的字符串表</li>
</ul>
</li>
</ul>
<h4 id="9）JDK-8u40并发标记类卸载"><a href="#9）JDK-8u40并发标记类卸载" class="headerlink" title="9）JDK 8u40并发标记类卸载"></a>9）JDK 8u40并发标记类卸载</h4><p>所有对象都经过并发标记后，就能知道哪些类不再被使用，当一个类加载器的所有类都不再使用，则卸 载它所加载的所有类</p>
<p>-XX:+ClassUnloadingWithConcurrentMark 默认启用</p>
<h4 id="10）JDK-8u60回收巨型对象"><a href="#10）JDK-8u60回收巨型对象" class="headerlink" title="10）JDK 8u60回收巨型对象"></a>10）JDK 8u60回收巨型对象</h4><ul>
<li>一个对象大于 region 的一半时，称之为巨型对象</li>
<li>G1 不会对巨型对象进行拷贝</li>
<li>回收时被优先考虑</li>
<li>G1 会跟踪老年代所有 incoming 引用，这样老年代 incoming 引用为0 的巨型对象就可以在新生 代垃圾回收时处理掉</li>
</ul>
<h4 id="11）JDK-9-并发标记起始时间的调整"><a href="#11）JDK-9-并发标记起始时间的调整" class="headerlink" title="11）JDK 9 并发标记起始时间的调整"></a>11）JDK 9 并发标记起始时间的调整</h4><ul>
<li>并发标记必须在堆空间占满前完成，否则退化为 FullGC</li>
<li>JDK 9 之前需要使用 -XX:InitiatingHeapOccupancyPercent</li>
<li>JDK 9 可以动态调整<ul>
<li>-XX:InitiatingHeapOccupancyPercent 用来设置初始值</li>
<li>进行数据采样并动态调整</li>
<li>总会添加一个安全的空档空间</li>
</ul>
</li>
</ul>
<h4 id="12）JDK-9-更高效的回收"><a href="#12）JDK-9-更高效的回收" class="headerlink" title="12）JDK 9 更高效的回收"></a>12）JDK 9 更高效的回收</h4><ul>
<li>250+增强 </li>
<li>180+bug修复 </li>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/12/gctuning">https://docs.oracle.com/en/java/javase/12/gctuning</a></li>
</ul>
<h2 id="2-5、垃圾回收调优"><a href="#2-5、垃圾回收调优" class="headerlink" title="2.5、垃圾回收调优"></a>2.5、垃圾回收调优</h2><p>预备知识</p>
<ul>
<li>掌握GC相关的VM参数，会基本的空间调整</li>
<li>掌握相关工具</li>
<li>明白一点：调优跟应用、环境有关，没有放之四海而皆准的法则</li>
</ul>
<p>查看当前虚拟机运行参数：</p>
<p>java -XX:+PrintFlagsFinal -version | findstr “GC”</p>
<ul>
<li>-XX:+PrintFlagsInitial 是打印所有的默认参数设置</li>
<li>-XX:+PrintFlagsFinal 是打印最终值，如果某个默认值被新值覆盖，显示新值</li>
<li>-XX:+PrintCommandLineFlags 是打印那些被新值覆盖的项</li>
</ul>
<h3 id="2-5-1、调优领域"><a href="#2-5-1、调优领域" class="headerlink" title="2.5.1、调优领域"></a>2.5.1、调优领域</h3><ul>
<li>内存</li>
<li>竞争锁</li>
<li>cpu占用</li>
<li>IO</li>
</ul>
<h3 id="2-5-2、确定目标"><a href="#2-5-2、确定目标" class="headerlink" title="2.5.2、确定目标"></a>2.5.2、确定目标</h3><ul>
<li>[低延迟]还是[高吞吐量]，选择合适的回收器，比如：如果开发的是进行科学研究一般要求高吞吐量而不是低延迟，而如果开发的是互联网项目一般要求低延迟。</li>
<li>低延迟的垃圾回收器有：CMS,G1,ZGC</li>
<li>高吞吐量的垃圾回收器有：ParallelGC</li>
<li>Zing虚拟机号称0停顿</li>
</ul>
<h3 id="2-5-3、最快的GC是不发生GC"><a href="#2-5-3、最快的GC是不发生GC" class="headerlink" title="2.5.3、最快的GC是不发生GC"></a>2.5.3、最快的GC是不发生GC</h3><ul>
<li>查看FullGC前后的内存占用，考虑下面几个问题<ul>
<li>数据是不是太多？</li>
<li>数据表示是否太臃肿？<ul>
<li>对象图</li>
<li>对象大小</li>
</ul>
</li>
<li>是否存在内存泄漏?</li>
</ul>
</li>
</ul>
<h3 id="2-5-4、新生代调优"><a href="#2-5-4、新生代调优" class="headerlink" title="2.5.4、新生代调优"></a>2.5.4、新生代调优</h3><ul>
<li>新生代的特点<ul>
<li>所有的new操作的内存分配非常廉价<ul>
<li>TLAB thread-local allocation buffer</li>
</ul>
</li>
<li>死亡对象的回收代价是零</li>
<li>大部分对象用过即死</li>
<li>Minor GC的时间远远低于Full GC</li>
</ul>
</li>
<li>新生代的内存越大越好吗？</li>
</ul>
<p>-Xmn Sets the initial and maximum size (in bytes) of the heap for the young generation (nursery). GC is performed in this region more often than in other regions. If the size for the young generation is too small, then a lot of minor garbage collections are performed. If the size is too large, then only full garbage collections are performed, which can take a long time to complete. Oracle recommends that you keep the size for the young generation greater than 25% and less than 50% of the overall heap size.</p>
<ul>
<li>调优后的理想状态（调优规则）：<ul>
<li>新生代能容纳所有【并发量 * (请求-响应)】的数据</li>
<li>幸存区大到能保留【当前活跃对象+需要晋升对象】</li>
<li>晋升阈值配置得当，让长时间存活对象尽快晋升</li>
</ul>
</li>
</ul>
<p>-XX:MaxTenuringThreshold&#x3D;threshold </p>
<p>-XX:+PrintTenuringDistribution</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs terminal">Desired survivor size 48286924 bytes, new threshold 10 (max 10)<br>- age 1: 28992024 bytes, 28992024 total<br>- age 2: 1366864 bytes, 30358888 total<br>- age 3: 1425912 bytes, 31784800 total<br>...<br></code></pre></td></tr></table></figure>

<h3 id="2-5-5、老年代调优"><a href="#2-5-5、老年代调优" class="headerlink" title="2.5.5、老年代调优"></a>2.5.5、老年代调优</h3><p>以CMS为例</p>
<ul>
<li><p>调优后的理想状态（调优规则）：</p>
<ul>
<li><p>以 CMS 为例 CMS 的老年代内存越大越好</p>
</li>
<li><p>先尝试不做调优，如果没有 Full GC 那么说明已经很不错了，否则先尝试调优新生代 </p>
</li>
<li><p>观察发生 Full GC 时老年代内存占用，将老年代内存预设调大 1&#x2F;4 ~ 1&#x2F;3</p>
<ul>
<li>-XX:CMSInitiatingOccupancyFraction&#x3D;percent</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-5-6、案例"><a href="#2-5-6、案例" class="headerlink" title="2.5.6、案例"></a>2.5.6、案例</h3><ul>
<li>案例1：Full GC 和 Minor GC频繁<ul>
<li>分析：GC特别频繁，说明我们的空间紧张，究竟是哪部分空间紧张呢？如果是新生代空间紧张，那么当我们业务高峰期来了大量对象被创建很快就把我们新生代的空间给塞满了，如果塞满了还会造成一个后果，它空间紧张了那么它对象晋升的阈值就会降低，导致很多本来生存周期很短的对象也会被晋升到老年代去，这样情况就进一步恶化了。老年代就会存在很多生存周期很短的对象，然后进一步触发Full GC的频繁发生。</li>
<li>解决方法：增大了新生代的内存，之后新生代的内存充裕了这样Minor GC就不在那么频繁了，同时增大了幸存区的空间同时也提高了晋升阈值。这样就会让很多生命周期较短的对象尽可能的留在新生代而不要晋升到老年代中，这样也就会使老年代的Full GC频率降低。</li>
</ul>
</li>
<li>案列2：请求高峰期发生Full GC，单次暂停时间特别长(CMS)<ul>
<li>分析：</li>
<li>解决方法：</li>
</ul>
</li>
<li>案例3：老年代充裕情况下，发生Full GC（1.7）<ul>
<li>分析：</li>
<li>解决方法：</li>
</ul>
</li>
</ul>
<h1 id="3、类加载与字节码技术"><a href="#3、类加载与字节码技术" class="headerlink" title="3、类加载与字节码技术"></a>3、类加载与字节码技术</h1><p><img src="/JVM/image-20221031110544226.png" srcset="/img/loading.gif" lazyload alt="image-20221031110544226"></p>
<h2 id="3-1、类文件结构"><a href="#3-1、类文件结构" class="headerlink" title="3.1、类文件结构"></a>3.1、类文件结构</h2><p>一个简单的 HelloWorld.java</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript">package cn.<span class="hljs-property">itcast</span>.<span class="hljs-property">jvm</span>.<span class="hljs-property">t5</span>;<br><br><span class="hljs-comment">// HelloWorld 示例</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloWorld</span> &#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;<br>		<span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">&quot;hello world&quot;</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>执行 javac -parameters -d . HellowWorld.java </p>
<p>编译为 HelloWorld.class 后是这个样子的：</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@localhost ~]<span class="hljs-comment"># od -t xC HelloWorld.class</span><br>0000000 ca fe ba be<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>34<span class="hljs-number"> 00 </span>23 0a<span class="hljs-number"> 00 </span>06<span class="hljs-number"> 00 </span>15 09<br>0000020<span class="hljs-number"> 00 </span>16<span class="hljs-number"> 00 </span>17<span class="hljs-number"> 08 </span>00<span class="hljs-number"> 18 </span>0a<span class="hljs-number"> 00 </span>19<span class="hljs-number"> 00 </span>1a<span class="hljs-number"> 07 </span>00 1b 07<br>0000040<span class="hljs-number"> 00 </span>1c<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 06 </span>3c<span class="hljs-number"> 69 </span>6e<span class="hljs-number"> 69 </span>74 3e<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 03 </span>28 29<br>0000060<span class="hljs-number"> 56 </span>01<span class="hljs-number"> 00 </span>04<span class="hljs-number"> 43 </span>6f<span class="hljs-number"> 64 </span>65<span class="hljs-number"> 01 </span>00 0f 4c<span class="hljs-number"> 69 </span>6e<span class="hljs-number"> 65 </span>4e<br>0000100<span class="hljs-number"> 75 </span>6d<span class="hljs-number"> 62 </span>65<span class="hljs-number"> 72 </span>54<span class="hljs-number"> 61 </span>62 6c<span class="hljs-number"> 65 </span>01<span class="hljs-number"> 00 </span>12 4c 6f 63<br>0000120<span class="hljs-number"> 61 </span>6c<span class="hljs-number"> 56 </span>61<span class="hljs-number"> 72 </span>69<span class="hljs-number"> 61 </span>62 6c<span class="hljs-number"> 65 </span>54<span class="hljs-number"> 61 </span>62 6c<span class="hljs-number"> 65 </span>01<br>0000140<span class="hljs-number"> 00 </span>04<span class="hljs-number"> 74 </span>68<span class="hljs-number"> 69 </span>73<span class="hljs-number"> 01 </span>00 1d 4c<span class="hljs-number"> 63 </span>6e 2f<span class="hljs-number"> 69 </span>74 63<br>0000160<span class="hljs-number"> 61 </span>73<span class="hljs-number"> 74 </span>2f 6a<span class="hljs-number"> 76 </span>6d 2f<span class="hljs-number"> 74 </span>35 2f<span class="hljs-number"> 48 </span>65 6c 6c 6f<br>0000200<span class="hljs-number"> 57 </span>6f<span class="hljs-number"> 72 </span>6c<span class="hljs-number"> 64 </span>3b<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 04 </span>6d<span class="hljs-number"> 61 </span>69 6e<span class="hljs-number"> 01 </span>00 16<br>0000220<span class="hljs-number"> 28 </span>5b 4c 6a<span class="hljs-number"> 61 </span>76<span class="hljs-number"> 61 </span>2f 6c<span class="hljs-number"> 61 </span>6e<span class="hljs-number"> 67 </span>2f<span class="hljs-number"> 53 </span>74 72<br>0000240<span class="hljs-number"> 69 </span>6e<span class="hljs-number"> 67 </span>3b<span class="hljs-number"> 29 </span>56<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 04 </span>61<span class="hljs-number"> 72 </span>67<span class="hljs-number"> 73 </span>01<span class="hljs-number"> 00 </span>13<br>0000260 5b 4c 6a<span class="hljs-number"> 61 </span>76<span class="hljs-number"> 61 </span>2f 6c<span class="hljs-number"> 61 </span>6e<span class="hljs-number"> 67 </span>2f<span class="hljs-number"> 53 </span>74<span class="hljs-number"> 72 </span>69<br>0000300 6e<span class="hljs-number"> 67 </span>3b<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 10 </span>4d<span class="hljs-number"> 65 </span>74<span class="hljs-number"> 68 </span>6f<span class="hljs-number"> 64 </span>50<span class="hljs-number"> 61 </span>72 61<br>0000320 6d<span class="hljs-number"> 65 </span>74<span class="hljs-number"> 65 </span>72<span class="hljs-number"> 73 </span>01<span class="hljs-number"> 00 </span>0a<span class="hljs-number"> 53 </span>6f<span class="hljs-number"> 75 </span>72<span class="hljs-number"> 63 </span>65 46<br>0000340<span class="hljs-number"> 69 </span>6c<span class="hljs-number"> 65 </span>01<span class="hljs-number"> 00 </span>0f<span class="hljs-number"> 48 </span>65 6c 6c 6f<span class="hljs-number"> 57 </span>6f<span class="hljs-number"> 72 </span>6c 64<br>0000360 2e 6a<span class="hljs-number"> 61 </span>76<span class="hljs-number"> 61 </span>0c<span class="hljs-number"> 00 </span>07<span class="hljs-number"> 00 </span>08<span class="hljs-number"> 07 </span>00 1d 0c<span class="hljs-number"> 00 </span>1e<br>0000400<span class="hljs-number"> 00 </span>1f<span class="hljs-number"> 01 </span>00 0b<span class="hljs-number"> 68 </span>65 6c 6c 6f<span class="hljs-number"> 20 </span>77 6f<span class="hljs-number"> 72 </span>6c 64<br>0000420<span class="hljs-number"> 07 </span>00<span class="hljs-number"> 20 </span>0c<span class="hljs-number"> 00 </span>21<span class="hljs-number"> 00 </span>22<span class="hljs-number"> 01 </span>00 1b<span class="hljs-number"> 63 </span>6e 2f<span class="hljs-number"> 69 </span>74<br>0000440<span class="hljs-number"> 63 </span>61<span class="hljs-number"> 73 </span>74 2f 6a<span class="hljs-number"> 76 </span>6d 2f<span class="hljs-number"> 74 </span>35 2f<span class="hljs-number"> 48 </span>65 6c 6c<br>0000460 6f<span class="hljs-number"> 57 </span>6f<span class="hljs-number"> 72 </span>6c<span class="hljs-number"> 64 </span>01<span class="hljs-number"> 00 </span>10 6a<span class="hljs-number"> 61 </span>76<span class="hljs-number"> 61 </span>2f 6c 61<br>0000500 6e<span class="hljs-number"> 67 </span>2f 4f<span class="hljs-number"> 62 </span>6a<span class="hljs-number"> 65 </span>63<span class="hljs-number"> 74 </span>01<span class="hljs-number"> 00 </span>10 6a<span class="hljs-number"> 61 </span>76 61<br>0000520 2f 6c<span class="hljs-number"> 61 </span>6e<span class="hljs-number"> 67 </span>2f<span class="hljs-number"> 53 </span>79<span class="hljs-number"> 73 </span>74<span class="hljs-number"> 65 </span>6d<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 03 </span>6f<br>0000540<span class="hljs-number"> 75 </span>74<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 15 </span>4c 6a<span class="hljs-number"> 61 </span>76<span class="hljs-number"> 61 </span>2f<span class="hljs-number"> 69 </span>6f 2f<span class="hljs-number"> 50 </span>72<br>0000560<span class="hljs-number"> 69 </span>6e<span class="hljs-number"> 74 </span>53<span class="hljs-number"> 74 </span>72<span class="hljs-number"> 65 </span>61 6d 3b<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 13 </span>6a<span class="hljs-number"> 61 </span>76<br>0000600<span class="hljs-number"> 61 </span>2f<span class="hljs-number"> 69 </span>6f 2f<span class="hljs-number"> 50 </span>72<span class="hljs-number"> 69 </span>6e<span class="hljs-number"> 74 </span>53<span class="hljs-number"> 74 </span>72<span class="hljs-number"> 65 </span>61 6d<br>0000620<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 07 </span>70<span class="hljs-number"> 72 </span>69 6e<span class="hljs-number"> 74 </span>6c 6e<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 15 </span>28 4c 6a<br>0000640<span class="hljs-number"> 61 </span>76<span class="hljs-number"> 61 </span>2f 6c<span class="hljs-number"> 61 </span>6e<span class="hljs-number"> 67 </span>2f<span class="hljs-number"> 53 </span>74<span class="hljs-number"> 72 </span>69 6e<span class="hljs-number"> 67 </span>3b<br>0000660<span class="hljs-number"> 29 </span>56<span class="hljs-number"> 00 </span>21<span class="hljs-number"> 00 </span>05<span class="hljs-number"> 00 </span>06<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>02<span class="hljs-number"> 00 </span>01<br>0000700<span class="hljs-number"> 00 </span>07<span class="hljs-number"> 00 </span>08<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 00 </span>09<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>2f<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 00 </span>01<br>0000720<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>05 2a b7<span class="hljs-number"> 00 </span>01 b1<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>02<span class="hljs-number"> 00 </span>0a 00<br>0000740<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 06 </span>00<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 04 </span>00 0b<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>0c 00<br>0000760<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 05 </span>00 0c<span class="hljs-number"> 00 </span>0d<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>09<span class="hljs-number"> 00 </span>0e 00<br>0001000 0f<span class="hljs-number"> 00 </span>02<span class="hljs-number"> 00 </span>09<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>37<span class="hljs-number"> 00 </span>02<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 00 </span>00 00<br>0001020<span class="hljs-number"> 09 </span>b2<span class="hljs-number"> 00 </span>02<span class="hljs-number"> 12 </span>03 b6<span class="hljs-number"> 00 </span>04 b1<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>02<span class="hljs-number"> 00 </span>0a<br>0001040<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>0a<span class="hljs-number"> 00 </span>02<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>06<span class="hljs-number"> 00 </span>08<span class="hljs-number"> 00 </span>07<span class="hljs-number"> 00 </span>0b<br>0001060<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>0c<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>09<span class="hljs-number"> 00 </span>10<span class="hljs-number"> 00 </span>11<span class="hljs-number"> 00 </span>00<br>0001100<span class="hljs-number"> 00 </span>12<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>05<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 10 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 13 </span>00<br>0001120<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 02 </span>00 14<br></code></pre></td></tr></table></figure>

<p>根据JVM规范，类文件结构如下:</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ClassFile &#123;<br>	u4 magic<span class="hljs-comment">;</span><br>	u2 minor_version<span class="hljs-comment">;</span><br>	u2 major_version<span class="hljs-comment">;</span><br>	u2 constant_pool_count<span class="hljs-comment">;</span><br>	cp_info constant_pool[constant_pool_count-<span class="hljs-number">1</span>]<span class="hljs-comment">;</span><br>	u2 access_flags<span class="hljs-comment">;</span><br>	u2 this_class<span class="hljs-comment">;</span><br>	u2 super_class<span class="hljs-comment">;</span><br>	u2 interfaces_count<span class="hljs-comment">;</span><br>	u2 interfaces[interfaces_count]<span class="hljs-comment">;</span><br>	u2 fields_count<span class="hljs-comment">;</span><br>	field_info fields[fields_count]<span class="hljs-comment">;</span><br>	u2 methods_count<span class="hljs-comment">;</span><br>	method_info methods[methods_count]<span class="hljs-comment">;</span><br>	u2 attributes_count<span class="hljs-comment">;</span><br>	attribute_info attributes[attributes_count]<span class="hljs-comment">;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-1-1、魔术-magic"><a href="#3-1-1、魔术-magic" class="headerlink" title="3.1.1、魔术(magic)"></a>3.1.1、魔术(magic)</h3><p>0~3 字节，表示它是否是【class】类型的文件 </p>
<p>0000000 <em><strong>ca fe ba be</strong></em> 00 00 00 34 00 23 0a 00 06 00 15 09</p>
<h3 id="3-1-2、版本"><a href="#3-1-2、版本" class="headerlink" title="3.1.2、版本"></a>3.1.2、版本</h3><p>4~7 字节，表示类的版本 00 34（52） 表示是 Java 8</p>
<p>0000000 ca fe ba be <em><strong>00 00 00 34</strong></em> 00 23 0a 00 06 00 15 09</p>
<h3 id="3-1-3、常量池"><a href="#3-1-3、常量池" class="headerlink" title="3.1.3、常量池"></a>3.1.3、常量池</h3><table>
<thead>
<tr>
<th>ConstantType</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>CONSTANT_Class</td>
<td>7</td>
</tr>
<tr>
<td>CONSTANT_Fieldref</td>
<td>9</td>
</tr>
<tr>
<td>CONSTANT_Methodref</td>
<td>10</td>
</tr>
<tr>
<td>CONSTANT_InterfaceMethodref</td>
<td>11</td>
</tr>
<tr>
<td>CONSTANT_String</td>
<td>8</td>
</tr>
<tr>
<td>CONSTANT_Integer</td>
<td>3</td>
</tr>
<tr>
<td>CONSTANT_Float</td>
<td>4</td>
</tr>
<tr>
<td>CONSTANT_Long</td>
<td>5</td>
</tr>
<tr>
<td>CONSTANT_Double</td>
<td>6</td>
</tr>
<tr>
<td>CONSTANT_NameAndType</td>
<td>12</td>
</tr>
<tr>
<td>CONSTANT_Uft8</td>
<td>1</td>
</tr>
<tr>
<td>CONSTANT_MethodHandle</td>
<td>15</td>
</tr>
<tr>
<td>CONSTANT_MethodType</td>
<td>16</td>
</tr>
<tr>
<td>CONSTANT_InvokeDynamic</td>
<td>18</td>
</tr>
</tbody></table>
<p>8<del>9 字节，表示常量池长度，00 23 （35） 表示常量池有 #1</del>#34项，注意 #0 项不计入，也没有值 </p>
<p>0000000 ca fe ba be 00 00 00 34 00 <em><strong>23 0a</strong></em> 00 06 00 15 09</p>
<p>第#1项 0a 表示一个 Method 信息，00 06 和 00 15（21） 表示它引用了常量池中 #6 和 #21 项来获得 这个方法的【所属类】和【方法名】 </p>
<p>0000000 ca fe ba be 00 00 00 34 00 23 <em><strong>0a 00 06 00 15</strong></em> 09</p>
<p>第#2项 09 表示一个 Field 信息，00 16（22）和 00 17（23） 表示它引用了常量池中 #22 和 # 23 项 来获得这个成员变量的【所属类】和【成员变量名】 </p>
<p>0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 <em><strong>09</strong></em> </p>
<p>0000020 <em><strong>00 16 00 17</strong></em> 08 00 18 0a 00 19 00 1a 07 00 1b 07</p>
<p>第#3项 08 表示一个字符串常量名称，00 18（24）表示它引用了常量池中 #24 项 </p>
<p>0000020 00 16 00 17 <em><strong>08 00 18</strong></em> 0a 00 19 00 1a 07 00 1b 07</p>
<p>第#4项 0a 表示一个 Method 信息，00 19（25） 和 00 1a（26） 表示它引用了常量池中 #25 和 #26 项来获得这个方法的【所属类】和【方法名】 </p>
<p>0000020 00 16 00 17 08 00 18 <em><strong>0a 00 19 00 1a</strong></em> 07 00 1b 07</p>
<p>第#5项 07 表示一个 Class 信息，00 1b（27） 表示它引用了常量池中 #27 项</p>
<p>0000020 00 16 00 17 08 00 18 0a 00 19 00 1a <em><strong>07 00 1b</strong></em> 07</p>
<p>第#6项 07 表示一个 Class 信息，00 1c（28） 表示它引用了常量池中 #28 项 </p>
<p>0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b <em><strong>07</strong></em> </p>
<p>0000040 <em><strong>00 1c</strong></em> 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29</p>
<p>第#7项 01 表示一个 utf8 串，00 06 表示长度，3c 69 6e 69 74 3e 是【<init>】 </p>
<p>0000040 00 1c <em><strong>01 00 06 3c 69 6e 69 74 3e</strong></em> 01 00 03 28 29</p>
<p>第#8项 01 表示一个 utf8 串，00 03 表示长度，28 29 56 是【()V】其实就是表示无参、无返回值 </p>
<p>0000040 00 1c 01 00 06 3c 69 6e 69 74 3e <em><strong>01 00 03 28 29</strong></em> </p>
<p>0000060 <em><strong>56</strong></em> 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e</p>
<p>第#9项 01 表示一个 utf8 串，00 04 表示长度，43 6f 64 65 是【Code】 </p>
<p>0000060 56 <em><strong>01 00 04 43 6f 64 65</strong></em> 01 00 0f 4c 69 6e 65 4e</p>
<p>第#10项 01 表示一个 utf8 串，00 0f（15） 表示长度，4c 69 6e 65 4e 75 6d 62 65 72 54 61 62 6c 65 是【LineNumberTable】 </p>
<p>0000060 56 01 00 04 43 6f 64 65 <em><strong>01 00 0f 4c 69 6e 65 4e</strong></em></p>
<p>0000100 <em><strong>75 6d 62 65 72 54 61 62 6c 65</strong></em> 01 00 12 4c 6f 63</p>
<p>第#11项 01 表示一个 utf8 串，00 12（18） 表示长度，4c 6f 63 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65是【LocalVariableTable】 </p>
<p>0000100 75 6d 62 65 72 54 61 62 6c 65 <em><strong>01 00 12 4c 6f 63</strong></em></p>
<p>0000120 <em><strong>61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65</strong></em> 01</p>
<p>第#12项 01 表示一个 utf8 串，00 04 表示长度，74 68 69 73 是【this】 </p>
<p>0000120 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 <em><strong>01</strong></em> </p>
<p>0000140 <em><strong>00 04 74 68 69 73</strong></em> 01 00 1d 4c 63 6e 2f 69 74 63</p>
<p>第#13项 01 表示一个 utf8 串，00 1d（29） 表示长度，是【Lcn&#x2F;itcast&#x2F;t5&#x2F;HelloWorld;】 </p>
<p>0000140 00 04 74 68 69 73 <em><strong>01 00 1d 4c 63 6e 2f 69 74 63</strong></em> </p>
<p>0000160 <em><strong>61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c 6f</strong></em> </p>
<p>0000200 <em><strong>57 6f 72 6c 64 3b</strong></em> 01 00 04 6d 61 69 6e 01 00 16</p>
<p>第#14项 01 表示一个 utf8 串，00 04 表示长度，74 68 69 73 是【main】 </p>
<p>0000200 57 6f 72 6c 64 3b <em><strong>01 00 04 6d 61 69 6e</strong></em> 01 00 16</p>
<p>第#15项 01 表示一个 utf8 串，00 16（22） 表示长度，是【([Ljava&#x2F;lang&#x2F;String;)V】其实就是参数为 字符串数组，无返回值 </p>
<p>0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e <em><strong>01 00 16</strong></em> </p>
<p>0000220 <em><strong>28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72</strong></em> </p>
<p>0000240 <em><strong>69 6e 67 3b 29 56</strong></em> 01 00 04 61 72 67 73 01 00 13</p>
<p>第#16项 01 表示一个 utf8 串，00 04 表示长度，是【args】 </p>
<p>0000240 69 6e 67 3b 29 56 <em><strong>01 00 04 61 72 67 73</strong></em> 01 00 13</p>
<p>第#17项 01 表示一个 utf8 串，00 13（19） 表示长度，是【[Ljava&#x2F;lang&#x2F;String;】 </p>
<p>0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 <em><strong>01 00 13</strong></em> </p>
<p>0000260 <em><strong>5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69</strong></em> </p>
<p>0000300 <em><strong>6e 67 3b</strong></em> 01 00 10 4d 65 74 68 6f 64 50 61 72 61</p>
<p>第#18项 01 表示一个 utf8 串，00 10（16） 表示长度，是【MethodParameters】 </p>
<p>0000300 6e 67 3b <em><strong>01 00 10 4d 65 74 68 6f 64 50 61 72 61</strong></em> </p>
<p>0000320 <em><strong>6d 65 74 65</strong></em> 72 73 01 00 0a 53 6f 75 72 63 65 46</p>
<p>第#19项 01 表示一个 utf8 串，00 0a（10） 表示长度，是【SourceFile】 </p>
<p>0000320 6d 65 74 65 72 73 <em><strong>01 00 0a 53 6f 75 72 63 65 46</strong></em> </p>
<p>0000340 <em><strong>69 6c 65</strong></em> 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64</p>
<p>第#20项 01 表示一个 utf8 串，00 0f（15） 表示长度，是【HelloWorld.java】 </p>
<p>0000340 69 6c 65 <em><strong>01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64</strong></em> </p>
<p>0000360 <em><strong>2e 6a 61 76 61</strong></em> 0c 00 07 00 08 07 00 1d 0c 00 1e</p>
<p>第#21项 0c 表示一个 【名+类型】，00 07 00 08 引用了常量池中 #7 #8 两项 </p>
<p>0000360 2e 6a 61 76 61 <em><strong>0c 00 07 00 08</strong></em> 07 00 1d 0c 00 1e</p>
<p>第#22项 07 表示一个 Class 信息，00 1d（29） 引用了常量池中 #29 项 </p>
<p>0000360 2e 6a 61 76 61 0c 00 07 00 08 <em><strong>07 00 1d</strong></em> 0c 00 1e</p>
<p>第#23项 0c 表示一个 【名+类型】，00 1e（30） 00 1f （31）引用了常量池中 #30 #31 两项 </p>
<p>0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d <em><strong>0c 00 1e</strong></em> </p>
<p>0000400 <em><strong>00 1f</strong></em> 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64</p>
<p>第#24项 01 表示一个 utf8 串，00 0f（15） 表示长度，是【hello world】 </p>
<p>0000400 00 1f <em><strong>01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64</strong></em></p>
<p>第#25项 07 表示一个 Class 信息，00 20（32） 引用了常量池中 #32 项 </p>
<p>0000420 <em><strong>07 00 20</strong></em> 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74</p>
<p>第#26项 0c 表示一个 【名+类型】，00 21（33） 00 22（34）引用了常量池中 #33 #34 两项 </p>
<p>0000420 07 00 20 <em><strong>0c 00 21 00 22</strong></em> 01 00 1b 63 6e 2f 69 74</p>
<p>第#27项 01 表示一个 utf8 串，00 1b（27） 表示长度，是【cn&#x2F;itcast&#x2F;t5&#x2F;HelloWorld】 </p>
<p>0000420 07 00 20 0c 00 21 00 22 <em><strong>01 00 1b 63 6e 2f 69 74</strong></em> </p>
<p>0000440 <em><strong>63 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c</strong></em> </p>
<p>0000460 <em><strong>6f 57 6f 72 6c 64</strong></em> 01 00 10 6a 61 76 61 2f 6c 61</p>
<p>第#28项 01 表示一个 utf8 串，00 10（16） 表示长度，是【java&#x2F;lang&#x2F;Object】 </p>
<p>0000460 6f 57 6f 72 6c 64 <em><strong>01 00 10 6a 61 76 61 2f 6c 61</strong></em> </p>
<p>0000500 <em><strong>6e 67 2f 4f 62 6a 65 63 74</strong></em> 01 00 10 6a 61 76 61</p>
<p>第#29项 01 表示一个 utf8 串，00 10（16） 表示长度，是【java&#x2F;lang&#x2F;System】 </p>
<p>0000500 6e 67 2f 4f 62 6a 65 63 74 <em><strong>01 00 10 6a 61 76 61</strong></em> </p>
<p>0000520 <em><strong>2f 6c 61 6e 67 2f 53 79 73 74 65 6d</strong></em> 01 00 03 6f</p>
<p>第#30项 01 表示一个 utf8 串，00 03 表示长度，是【out】 </p>
<p>0000520 2f 6c 61 6e 67 2f 53 79 73 74 65 6d <em><strong>01 00 03 6f</strong></em> </p>
<p>0000540 <em><strong>75 74</strong></em> 01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72</p>
<p>第#31项 01 表示一个 utf8 串，00 15（21） 表示长度，是【Ljava&#x2F;io&#x2F;PrintStream;】 </p>
<p>0000540 75 74 <em><strong>01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72</strong></em> </p>
<p>0000560 <em><strong>69 6e 74 53 74 72 65 61 6d 3b</strong></em> 01 00 13 6a 61 76</p>
<p>第#32项 01 表示一个 utf8 串，00 13（19） 表示长度，是【java&#x2F;io&#x2F;PrintStream】 </p>
<p>0000560 69 6e 74 53 74 72 65 61 6d 3b <em><strong>01 00 13 6a 61 76</strong></em></p>
<p>0000600 <em><strong>61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d</strong></em></p>
<p>第#33项 01 表示一个 utf8 串，00 07 表示长度，是【println】 </p>
<p>0000620 <em><strong>01 00 07 70 72 69 6e 74 6c 6e</strong></em> 01 00 15 28 4c 6a</p>
<p>第#34项 01 表示一个 utf8 串，00 15（21） 表示长度，是【(Ljava&#x2F;lang&#x2F;String;)V】 </p>
<p>0000620 01 00 07 70 72 69 6e 74 6c 6e <em><strong>01 00 15 28 4c 6a</strong></em> </p>
<p>0000640 <em><strong>61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b</strong></em> </p>
<p>0000660 <em><strong>29 56</strong></em> 00 21 00 05 00 06 00 00 00 00 00 02 00 01</p>
<h3 id="3-1-4、访问标识与继承信息"><a href="#3-1-4、访问标识与继承信息" class="headerlink" title="3.1.4、访问标识与继承信息"></a>3.1.4、访问标识与继承信息</h3><p>21 表示该 class 是一个类，公共的 </p>
<p>0000660 29 56 <em><strong>00 21</strong></em> 00 05 00 06 00 00 00 00 00 02 00 01 </p>
<p>05 表示根据常量池中 #5 找到本类全限定名 </p>
<p>0000660 29 56 00 21 <em><strong>00 05</strong></em> 00 06 00 00 00 00 00 02 00 01 </p>
<p>06 表示根据常量池中 #6 找到父类全限定名 </p>
<p>0000660 29 56 00 21 00 05 <em><strong>00 06</strong></em> 00 00 00 00 00 02 00 01 </p>
<p>表示接口的数量，本类为 0 </p>
<p>0000660 29 56 00 21 00 05 00 06 <em><strong>00 00</strong></em> 00 00 00 02 00 0</p>
<table>
<thead>
<tr>
<th>Flag Name</th>
<th>Value</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody><tr>
<td>ACC_PUBLIC</td>
<td>0x0001</td>
<td>Declared public ; may be accessed from outside its  package.</td>
</tr>
<tr>
<td>ACC_FINAL</td>
<td>0x0010</td>
<td>Declared final ; no subclasses allowed.</td>
</tr>
<tr>
<td>ACC_SUPER</td>
<td>0x0020</td>
<td>Treat superclass methods specially when invoked by the invokespecial instruction.</td>
</tr>
<tr>
<td>ACC_INTERFACE</td>
<td>0x0200</td>
<td>Is an interface, not a class.</td>
</tr>
<tr>
<td>ACC_ABSTRACT</td>
<td>0x0400</td>
<td>Declared abstract ; must not be instantiated.</td>
</tr>
<tr>
<td>ACC_SYNTHETIC</td>
<td>0x1000</td>
<td>Declared synthetic; not present in the source code.</td>
</tr>
<tr>
<td>ACC_ANNOTATION</td>
<td>0x2000</td>
<td>Declared as an annotation type.</td>
</tr>
<tr>
<td>ACC_ENUM</td>
<td>0x4000</td>
<td>Declared as an enum type.</td>
</tr>
</tbody></table>
<h3 id="3-1-5、Field信息"><a href="#3-1-5、Field信息" class="headerlink" title="3.1.5、Field信息"></a>3.1.5、Field信息</h3><p>表示成员变量数量，本类为 0 </p>
<p>0000660 29 56 00 21 00 05 00 06 00 00 <em><strong>00 00</strong></em> 00 02 00 01</p>
<table>
<thead>
<tr>
<th>FieldType</th>
<th>Type</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody><tr>
<td>B</td>
<td>byte</td>
<td>signed byte</td>
</tr>
<tr>
<td>C</td>
<td>char</td>
<td>Unicode character code point in the Basic Multilingual Plane, encoded with UTF-16</td>
</tr>
<tr>
<td>D</td>
<td>double</td>
<td>double-precision floating-point value</td>
</tr>
<tr>
<td>F</td>
<td>float</td>
<td>single-precision floating-point value</td>
</tr>
<tr>
<td>I</td>
<td>int</td>
<td>integer</td>
</tr>
<tr>
<td>J</td>
<td>long</td>
<td>long integer</td>
</tr>
<tr>
<td>L <br />ClassName <br />;</td>
<td>reference</td>
<td>an instance of class ClassName</td>
</tr>
<tr>
<td>S</td>
<td>short</td>
<td>signed short</td>
</tr>
<tr>
<td>Z</td>
<td>boolean</td>
<td>true or false</td>
</tr>
<tr>
<td>[</td>
<td>reference</td>
<td>one array dimension</td>
</tr>
</tbody></table>
<h3 id="3-1-6、Method信息"><a href="#3-1-6、Method信息" class="headerlink" title="3.1.6、Method信息"></a>3.1.6、Method信息</h3><p><img src="/JVM/image-20221031140109206.png" srcset="/img/loading.gif" lazyload alt="image-20221031140109206"></p>
<p><img src="/JVM/image-20221031140141999.png" srcset="/img/loading.gif" lazyload alt="image-20221031140141999"></p>
<p><img src="/JVM/image-20221031140206312.png" srcset="/img/loading.gif" lazyload alt="image-20221031140206312"><img src="/JVM/image-20221031140257982.png" srcset="/img/loading.gif" lazyload alt="image-20221031140257982"></p>
<p><img src="/JVM/image-20221031140316845.png" srcset="/img/loading.gif" lazyload alt="image-20221031140316845"></p>
<h3 id="3-1-7、附加属性"><a href="#3-1-7、附加属性" class="headerlink" title="3.1.7、附加属性"></a>3.1.7、附加属性</h3><ul>
<li>00 01 表示附加属性数量</li>
<li>00 13 表示引用了常量池 #19 项，即【SourceFile】</li>
<li>00 00 00 02 表示此属性的长度</li>
<li>00 14 表示引用了常量池 #20 项，即【HelloWorld.java】</li>
</ul>
<p>0001100 00 12 00 00 00 05 01 00 10 00 00 00 01 00 13 00</p>
<p>0001120 00 00 02 00 14</p>
<p>参考：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html</a></p>
<h2 id="3-2、字节码指令"><a href="#3-2、字节码指令" class="headerlink" title="3.2、字节码指令"></a>3.2、字节码指令</h2><h3 id="3-2-1、入门"><a href="#3-2-1、入门" class="headerlink" title="3.2.1、入门"></a>3.2.1、入门</h3><p>接着上一节，研究一下两组字节码指令，一个是</p>
<p><code>public cn.itcast.jvm.t5.HelloWorld();</code>  构造方法的字节码指令</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">2a</span> b7 <span class="hljs-number">00</span> <span class="hljs-number">01</span> b1<br></code></pre></td></tr></table></figure>

<ol>
<li>2a &#x3D;&gt; aload_0 加载 slot 0 的局部变量，即 this，做为下面的 invokespecial 构造方法调用的参数 </li>
<li>b7 &#x3D;&gt; invokespecial 预备调用构造方法，哪个方法呢？ </li>
<li>00 01 引用常量池中 #1 项，即【 Method java&#x2F;lang&#x2F;Object.””:()V 】</li>
<li>b1 表示返回</li>
</ol>
<p>另一个是 public static void main(java.lang.String[]); 主方法的字节码指令</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">b2</span> <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">12</span> <span class="hljs-number">03</span> b6 <span class="hljs-number">00</span> <span class="hljs-number">04</span> b1<br></code></pre></td></tr></table></figure>

<ol>
<li>b2 &#x3D;&gt; getstatic 用来加载静态变量，哪个静态变量呢？ </li>
<li>00 02 引用常量池中 #2 项，即【Field java&#x2F;lang&#x2F;System.out:Ljava&#x2F;io&#x2F;PrintStream;】</li>
<li>12 &#x3D;&gt; ldc 加载参数，哪个参数呢？ </li>
<li>03 引用常量池中 #3 项，即 【String hello world】 </li>
<li>b6 &#x3D;&gt; invokevirtual 预备调用成员方法，哪个方法呢？ </li>
<li>00 04 引用常量池中 #4 项，即【Method java&#x2F;io&#x2F;PrintStream.println:(Ljava&#x2F;lang&#x2F;String;)V】 </li>
<li>b1 表示返回</li>
</ol>
<p>请参考：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5</a></p>
<h3 id="3-2-2、javap工具"><a href="#3-2-2、javap工具" class="headerlink" title="3.2.2、javap工具"></a>3.2.2、javap工具</h3><p>自己分析类文件结构太麻烦了，Oracle 提供了 javap 工具来反编译 class 文件</p>
<p><img src="/JVM/image-20221102103445192.png" srcset="/img/loading.gif" lazyload alt="image-20221102103445192"></p>
<p><img src="/JVM/image-20221102103427032.png" srcset="/img/loading.gif" lazyload alt="image-20221102103427032"></p>
<p><img src="/JVM/image-20221102103518271.png" srcset="/img/loading.gif" lazyload alt="image-20221102103518271"></p>
<h3 id="3-2-3、图解方法执行流程"><a href="#3-2-3、图解方法执行流程" class="headerlink" title="3.2.3、图解方法执行流程"></a>3.2.3、图解方法执行流程</h3><p>1）原始 java 代码</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">package</span> cn.itcast.jvm.t3.bytecode;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">	* 演示 字节码指令 和 操作数栈、常量池的关系</span><br><span class="hljs-comment">	*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> Demo3_1 &#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(String[] args) &#123;<br>		<span class="hljs-keyword">int</span> a = <span class="hljs-number">10</span>;<br>		<span class="hljs-keyword">int</span> b = <span class="hljs-keyword">Short</span>.MAX_VALUE + <span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">int</span> c = a + b;<br>		System.out.<span class="hljs-keyword">println</span>(c);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>2）编译后的字节码文件</p>
<p><img src="/JVM/image-20221102103601651.png" srcset="/img/loading.gif" lazyload alt="image-20221102103601651"></p>
<p><img src="/JVM/image-20221102103614954.png" srcset="/img/loading.gif" lazyload alt="image-20221102103614954"></p>
<p><img src="/JVM/image-20221102103632461.png" srcset="/img/loading.gif" lazyload alt="image-20221102103632461"></p>
<p><img src="/JVM/image-20221102103643166.png" srcset="/img/loading.gif" lazyload alt="image-20221102103643166"></p>
<p>3）常量池载入运行时常量池</p>
<p><img src="/JVM/image-20221102103656297.png" srcset="/img/loading.gif" lazyload alt="image-20221102103656297"></p>
<p>4）方法字节码载入方法区</p>
<p><img src="/JVM/image-20221102103705315.png" srcset="/img/loading.gif" lazyload alt="image-20221102103705315"></p>
<p>5）main 线程开始运行，分配栈帧内存</p>
<p>（stack&#x3D;2，locals&#x3D;4）</p>
<p><img src="/JVM/image-20221102103722807.png" srcset="/img/loading.gif" lazyload alt="image-20221102103722807"></p>
<p>6）执行引擎开始执行字节码</p>
<p>bipush 10</p>
<ul>
<li>将一个 byte 压入操作数栈（其长度会补齐 4 个字节），类似的指令还有</li>
<li>sipush 将一个 short 压入操作数栈（其长度会补齐 4 个字节） </li>
<li>ldc 将一个 int 压入操作数栈 </li>
<li>ldc2_w 将一个 long 压入操作数栈（分两次压入，因为 long 是 8 个字节） </li>
<li>这里小的数字都是和字节码指令存在一起，超过 short 范围的数字存入了常量池</li>
</ul>
<p><img src="/JVM/image-20221102103815252.png" srcset="/img/loading.gif" lazyload alt="image-20221102103815252"></p>
<p>istore_1</p>
<ul>
<li>将操作数栈顶数据弹出，存入局部变量表的 slot 1</li>
</ul>
<p><img src="/JVM/image-20221102103929219.png" srcset="/img/loading.gif" lazyload alt="image-20221102103929219"></p>
<p><img src="/JVM/image-20221102103934229.png" srcset="/img/loading.gif" lazyload alt="image-20221102103934229"></p>
<p>ldc #3</p>
<ul>
<li>从常量池加载 #3 数据到操作数栈 </li>
<li>注意 Short.MAX_VALUE 是 32767，所以 32768 &#x3D; Short.MAX_VALUE + 1 实际是在编译期间计算好的</li>
</ul>
<p><img src="/JVM/image-20221102104009697.png" srcset="/img/loading.gif" lazyload alt="image-20221102104009697"></p>
<p>istore_2</p>
<p><img src="/JVM/image-20221102104021847.png" srcset="/img/loading.gif" lazyload alt="image-20221102104021847"></p>
<p><img src="/JVM/image-20221102104029382.png" srcset="/img/loading.gif" lazyload alt="image-20221102104029382"></p>
<p>iload_1</p>
<p><img src="/JVM/image-20221102104045057.png" srcset="/img/loading.gif" lazyload alt="image-20221102104045057"></p>
<p>iload_2</p>
<p><img src="/JVM/image-20221102104057398.png" srcset="/img/loading.gif" lazyload alt="image-20221102104057398"></p>
<p>iadd</p>
<p><img src="/JVM/image-20221102104108668.png" srcset="/img/loading.gif" lazyload alt="image-20221102104108668"></p>
<p><img src="/JVM/image-20221102104115884.png" srcset="/img/loading.gif" lazyload alt="image-20221102104115884"></p>
<p>istore_3</p>
<p><img src="/JVM/image-20221102104129152.png" srcset="/img/loading.gif" lazyload alt="image-20221102104129152"></p>
<p><img src="/JVM/image-20221102104135622.png" srcset="/img/loading.gif" lazyload alt="image-20221102104135622"></p>
<p>getstatic #4</p>
<p><img src="/JVM/image-20221102104145763.png" srcset="/img/loading.gif" lazyload alt="image-20221102104145763"></p>
<p><img src="/JVM/image-20221102104153687.png" srcset="/img/loading.gif" lazyload alt="image-20221102104153687"></p>
<p>iload_3</p>
<p><img src="/JVM/image-20221102104205754.png" srcset="/img/loading.gif" lazyload alt="image-20221102104205754"></p>
<p><img src="/JVM/image-20221102104212672.png" srcset="/img/loading.gif" lazyload alt="image-20221102104212672"></p>
<p>invokevirtual #5</p>
<ul>
<li>找到常量池 #5 项 </li>
<li>定位到方法区 java&#x2F;io&#x2F;PrintStream.println:(I)V 方法 </li>
<li>生成新的栈帧（分配 locals、stack等） </li>
<li>传递参数，执行新栈帧中的字节码</li>
</ul>
<p><img src="/JVM/image-20221102104241504.png" srcset="/img/loading.gif" lazyload alt="image-20221102104241504"></p>
<ul>
<li>执行完毕，弹出栈帧 </li>
<li>清除 main 操作数栈内容</li>
</ul>
<p><img src="/JVM/image-20221102104325220.png" srcset="/img/loading.gif" lazyload alt="image-20221102104325220"></p>
<p>return</p>
<ul>
<li>完成 main 方法调用，弹出 main 栈帧 </li>
<li>程序结束</li>
</ul>
<h3 id="3-2-4、练习-分析i"><a href="#3-2-4、练习-分析i" class="headerlink" title="3.2.4、练习 - 分析i++"></a>3.2.4、练习 - 分析i++</h3><p>目的：从字节码角度分析 a++ 相关题目</p>
<p>源码：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">package cn.itcast.jvm.t3.bytecode;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">	* 从字节码角度分析 a++ 相关题目</span><br><span class="hljs-comment">	*/</span><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> Demo3_2 &#123;<br>	<span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) &#123;<br>		<span class="hljs-type">int</span> a = <span class="hljs-number">10</span>;<br>		<span class="hljs-type">int</span> b = a++ + ++a + a<span class="hljs-comment">--;</span><br>		<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(a);<br>		<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(b);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>字节码：</p>
<p><img src="/JVM/image-20221102104450398.png" srcset="/img/loading.gif" lazyload alt="image-20221102104450398"></p>
<p><img src="/JVM/image-20221102104455844.png" srcset="/img/loading.gif" lazyload alt="image-20221102104455844"></p>
<p>分析：</p>
<ul>
<li>注意 iinc 指令是直接在局部变量 slot 上进行运算 </li>
<li>a++ 和 ++a 的区别是先执行 iload 还是 先执行 iinc</li>
</ul>
<p><img src="/JVM/image-20221102104520641.png" srcset="/img/loading.gif" lazyload alt="image-20221102104520641"></p>
<p><img src="/JVM/image-20221102104530903.png" srcset="/img/loading.gif" lazyload alt="image-20221102104530903"></p>
<p><img src="/JVM/image-20221102104537395.png" srcset="/img/loading.gif" lazyload alt="image-20221102104537395"></p>
<p><img src="/JVM/image-20221102104544336.png" srcset="/img/loading.gif" lazyload alt="image-20221102104544336"></p>
<p><img src="/JVM/image-20221102104556881.png" srcset="/img/loading.gif" lazyload alt="image-20221102104556881"></p>
<p><img src="/JVM/image-20221102104603865.png" srcset="/img/loading.gif" lazyload alt="image-20221102104603865"></p>
<p><img src="/JVM/image-20221102104617984.png" srcset="/img/loading.gif" lazyload alt="image-20221102104617984"></p>
<p><img src="/JVM/image-20221102104624772.png" srcset="/img/loading.gif" lazyload alt="image-20221102104624772"></p>
<p><img src="/JVM/image-20221102104630356.png" srcset="/img/loading.gif" lazyload alt="image-20221102104630356"></p>
<p><img src="/JVM/image-20221102104636559.png" srcset="/img/loading.gif" lazyload alt="image-20221102104636559"></p>
<p><img src="/JVM/image-20221102104641852.png" srcset="/img/loading.gif" lazyload alt="image-20221102104641852"></p>
<h3 id="3-2-5、条件判断指令"><a href="#3-2-5、条件判断指令" class="headerlink" title="3.2.5、条件判断指令"></a>3.2.5、条件判断指令</h3><table>
<thead>
<tr>
<th>指令</th>
<th>助记符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>0x99</td>
<td>ifeq</td>
<td>判断是否 &#x3D;&#x3D; 0</td>
</tr>
<tr>
<td>0x9a</td>
<td>ifne</td>
<td>判断是否 !&#x3D; 0</td>
</tr>
<tr>
<td>0x9b</td>
<td>iflt</td>
<td>判断是否 &lt; 0</td>
</tr>
<tr>
<td>0x9c</td>
<td>ifge</td>
<td>判断是否 &gt;&#x3D; 0</td>
</tr>
<tr>
<td>0x9d</td>
<td>ifgt</td>
<td>判断是否 &gt; 0</td>
</tr>
<tr>
<td>0x9e</td>
<td>ifle</td>
<td>判断是否 &lt;&#x3D; 0</td>
</tr>
<tr>
<td>0x9f</td>
<td>if_icmpeq</td>
<td>两个int是否 &#x3D;&#x3D;</td>
</tr>
<tr>
<td>0xa0</td>
<td>if_icmpne</td>
<td>两个int是否 !&#x3D;</td>
</tr>
<tr>
<td>0xa1</td>
<td>if_icmplt</td>
<td>两个int是否 &lt;</td>
</tr>
<tr>
<td>0xa2</td>
<td>if_icmpge</td>
<td>两个int是否 &gt;&#x3D;</td>
</tr>
<tr>
<td>0xa3</td>
<td>if_icmpgt</td>
<td>两个int是否 &gt;</td>
</tr>
<tr>
<td>0xa4</td>
<td>if_icmple</td>
<td>两个int是否 &lt;&#x3D;</td>
</tr>
<tr>
<td>0xa5</td>
<td>if_acmpeq</td>
<td>两个引用是否 &#x3D;&#x3D;</td>
</tr>
<tr>
<td>0xa6</td>
<td>if_acmpne</td>
<td>两个引用是否 !&#x3D;</td>
</tr>
<tr>
<td>0xc6</td>
<td>ifnull</td>
<td>判断是否 &#x3D;&#x3D; null</td>
</tr>
<tr>
<td>0xc7</td>
<td>ifnonnull</td>
<td>判断是否 !&#x3D; null</td>
</tr>
</tbody></table>
<p>几点说明：</p>
<ul>
<li>byte，short，char 都会按 int 比较，因为操作数栈都是 4 字节 </li>
<li>goto 用来进行跳转到指定行号的字节码</li>
</ul>
<p>源码：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo3_3</span> &#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>&#123;<br>		<span class="hljs-type">int</span> a = <span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">if</span>(a == <span class="hljs-number">0</span>) &#123;<br>			a = <span class="hljs-number">10</span>;<br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			a = <span class="hljs-number">20</span>;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>字节码：</p>
<p><img src="/JVM/image-20221102105020761.png" srcset="/img/loading.gif" lazyload alt="image-20221102105020761"></p>
<p>思考：以上比较指令中没有 long，float，double 的比较，那么它们要比较怎么办？</p>
<p>参考：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html#jvms-6.5.lcmp">https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html#jvms-6.5.lcmp</a></p>
<h3 id="3-2-6、循环控制指令"><a href="#3-2-6、循环控制指令" class="headerlink" title="3.2.6、循环控制指令"></a>3.2.6、循环控制指令</h3><p>其实循环控制还是前面介绍的那些指令，例如 while 循环：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo3_4</span> &#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>&#123;<br>		<span class="hljs-type">int</span> a = <span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">while</span> (a &lt; <span class="hljs-number">10</span>) &#123;<br>			a++;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>字节码是：</p>
<p><img src="/JVM/image-20221102105228962.png" srcset="/img/loading.gif" lazyload alt="image-20221102105228962"></p>
<p>再比如 do while 循环：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo3_5</span> &#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>&#123;<br>		<span class="hljs-type">int</span> a = <span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">do</span> &#123;<br>			a++;<br>		&#125; <span class="hljs-keyword">while</span> (a &lt; <span class="hljs-number">10</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>字节码是：</p>
<p>0: iconst_0 </p>
<p>1: istore_1 </p>
<p>2: iinc 1, 1 </p>
<p>5: iload_1 </p>
<p>6: bipush 10 </p>
<p>8: if_icmplt 2 </p>
<p>11: return</p>
<p>最后再看看 for 循环：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo3_6</span> &#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>&#123;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>		<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>字节码是：</p>
<p><img src="/JVM/image-20221102105408966.png" srcset="/img/loading.gif" lazyload alt="image-20221102105408966"></p>
<p>注意：比较 while 和 for 的字节码，你发现它们是一模一样的，殊途也能同归</p>
<h3 id="3-2-7、练习-判断结果"><a href="#3-2-7、练习-判断结果" class="headerlink" title="3.2.7、练习 - 判断结果"></a>3.2.7、练习 - 判断结果</h3><p>请从字节码角度分析，下列代码运行的结果：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo3_6_1</span> &#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>&#123;<br>		<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>		<span class="hljs-type">int</span> x = <span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">while</span> (i &lt; <span class="hljs-number">10</span>) &#123;<br>			x = x++;<br>			i++;<br>		&#125;<br>		System.out.<span class="hljs-built_in">println</span>(x); <span class="hljs-comment">// 结果是 0</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="3-2-8、构造方法"><a href="#3-2-8、构造方法" class="headerlink" title="3.2.8、构造方法"></a>3.2.8、构造方法</h3><p>1）<code>&lt;cinit&gt;()V</code></p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo3_8_1</span> &#123;<br>	<span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> i = <span class="hljs-number">10</span>;<br>	<span class="hljs-keyword">static</span> &#123;<br>		i = <span class="hljs-number">20</span>;<br>	&#125;<br>	<span class="hljs-keyword">static</span> &#123;<br>		i = <span class="hljs-number">30</span>;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>编译器会按从上至下的顺序，收集所有 static 静态代码块和静态成员赋值的代码，合并为一个特殊的方法 <code>&lt;cinit&gt;()V</code> ：</p>
<p><img src="/JVM/image-20221102105618094.png" srcset="/img/loading.gif" lazyload alt="image-20221102105618094"></p>
<p>练习：自己调整一下 static 变量和静态代码块的位置，观察字节码的改动</p>
<p>2）<code>&lt;init&gt;()V</code></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo3_8_2</span> &#123;<br>	<span class="hljs-keyword">private</span> <span class="hljs-type">String</span> a = <span class="hljs-string">&quot;s1&quot;</span>;<br>	&#123;<br>		b = <span class="hljs-number">20</span>;<br>	&#125;<br>	<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> b = <span class="hljs-number">10</span>;<br>	&#123;<br>		a = <span class="hljs-string">&quot;s2&quot;</span>;<br>	&#125;<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Demo3_8_2</span><span class="hljs-params">(<span class="hljs-type">String</span> a, <span class="hljs-type">int</span> b)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.a = a;<br>		<span class="hljs-keyword">this</span>.b = b;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>&#123;<br>		Demo3_8_2 d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Demo3_8_2</span>(<span class="hljs-string">&quot;s3&quot;</span>, <span class="hljs-number">30</span>);<br>		System.out.<span class="hljs-built_in">println</span>(d.a);<br>		System.out.<span class="hljs-built_in">println</span>(d.b);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>编译器会按从上至下的顺序，收集所有 {} 代码块和成员变量赋值的代码，形成新的构造方法，但原始构 造方法内的代码总是在最后</p>
<p><img src="/JVM/image-20221102105803812.png" srcset="/img/loading.gif" lazyload alt="image-20221102105803812"></p>
<h3 id="3-2-9、方法调用"><a href="#3-2-9、方法调用" class="headerlink" title="3.2.9、方法调用"></a>3.2.9、方法调用</h3><p>看一下几种不同的方法调用对应的字节码指令</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Demo3_9</span> &#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Demo3_9</span>()</span> &#123; &#125;<br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span>()</span> &#123; &#125;<br>	<span class="hljs-function"><span class="hljs-keyword">private</span> final <span class="hljs-keyword">void</span> <span class="hljs-title">test2</span>()</span> &#123; &#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test3</span>()</span> &#123; &#125;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test4</span>()</span> &#123; &#125;<br>	<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> &#123;<br>		Demo3_9 d = <span class="hljs-keyword">new</span> Demo3_9();<br>		d.test1();<br>		d.test2();<br>		d.test3();<br>		d.test4();<br>		Demo3_9.test4();<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>字节码：</p>
<p><img src="/JVM/image-20221102105843791.png" srcset="/img/loading.gif" lazyload alt="image-20221102105843791"></p>
<ul>
<li>new 是创建【对象】，给对象分配堆内存，执行成功会将【对象引用】压入操作数栈 </li>
<li>dup 是赋值操作数栈栈顶的内容，本例即为【对象引用】，为什么需要两份引用呢，一个是要配合 invokespecial 调用该对象的构造方法 “”:()V （会消耗掉栈顶一个引用），另一个要 配合 astore_1 赋值给局部变量 </li>
<li>最终方法（final），私有方法（private），构造方法都是由 invokespecial 指令来调用，属于静态绑定 </li>
<li>普通成员方法是由 invokevirtual 调用，属于动态绑定，即支持多态 </li>
<li>成员方法与静态方法调用的另一个区别是，执行方法前是否需要【对象引用】 </li>
<li>比较有意思的是 d.test4(); 是通过【对象引用】调用一个静态方法，可以看到在调用 invokestatic 之前执行了 pop 指令，把【对象引用】从操作数栈弹掉了😂 </li>
<li>还有一个执行 invokespecial 的情况是通过 super 调用父类方法</li>
</ul>
<h3 id="3-2-10、多态的原理"><a href="#3-2-10、多态的原理" class="headerlink" title="3.2.10、多态的原理"></a>3.2.10、多态的原理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.jvm.t3.bytecode;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* 演示多态原理，注意加上下面的 JVM 参数，禁用指针压缩</span><br><span class="hljs-comment">* -XX:-UseCompressedOops -XX:-UseCompressedClassPointers</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo3_10</span> &#123;<br><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(Animal animal)</span> &#123;<br>		animal.eat();<br>		System.out.println(animal.toString());<br>	&#125;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>		test(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>());<br>		test(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>());<br>		System.in.read();<br>	&#125;<br>&#125;<br><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> &#123;<br><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span>;<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;我是&quot;</span> + <span class="hljs-built_in">this</span>.getClass().getSimpleName();<br>	&#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> &#123;<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span> &#123;<br>		System.out.println(<span class="hljs-string">&quot;啃骨头&quot;</span>);<br>	&#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> &#123;<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span> &#123;<br>		System.out.println(<span class="hljs-string">&quot;吃鱼&quot;</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>1）运行代码</p>
<p>停在 System.in.read() 方法上，这时运行 jps 获取进程 id</p>
<p>2）运行 HSDB 工具</p>
<p>进入 JDK 安装目录，执行<code>java -cp ./lib/sa-jdi.jar sun.jvm.hotspot.HSDB</code></p>
<p>3）查找某个对象</p>
<p>打开 Tools -&gt; Find Object By Query </p>
<p>输入 <code>select d from cn.itcast.jvm.t3.bytecode.Dog d</code> 点击 Execute 执行</p>
<p><img src="/JVM/image-20221102110127313.png" srcset="/img/loading.gif" lazyload alt="image-20221102110127313"></p>
<p>4）查看对象内存结构</p>
<p>点击超链接可以看到对象的内存结构，此对象没有任何属性，因此只有对象头的 16 字节，前 8 字节是 MarkWord，后 8 字节就是对象的 Class 指针</p>
<p>但目前看不到它的实际地址</p>
<p><img src="/JVM/image-20221102110145382.png" srcset="/img/loading.gif" lazyload alt="image-20221102110145382"></p>
<p>5）查看对象 Class 的内存地址</p>
<p>可以通过 Windows -&gt; Console 进入命令行模式，执行<code>mem 0x00000001299b4978 2</code></p>
<p>mem 有两个参数，参数 1 是对象地址，参数 2 是查看 2 行（即 16 字节）</p>
<p>结果中第二行 0x000000001b7d4028 即为 Class 的内存地址</p>
<p><img src="/JVM/image-20221102110235601.png" srcset="/img/loading.gif" lazyload alt="image-20221102110235601"></p>
<p>6）查看类的 vtable</p>
<ul>
<li>方法1：Alt+R 进入 Inspector 工具，输入刚才的 Class 内存地址，看到如下界面</li>
</ul>
<p><img src="/JVM/image-20221102110306376.png" srcset="/img/loading.gif" lazyload alt="image-20221102110306376"></p>
<ul>
<li>方法2：或者 Tools -&gt; Class Browser 输入 Dog 查找，可以得到相同的结果</li>
</ul>
<p><img src="/JVM/image-20221102110319143.png" srcset="/img/loading.gif" lazyload alt="image-20221102110319143"></p>
<p>无论通过哪种方法，都可以找到 Dog Class 的 vtable 长度为 6，意思就是 Dog 类有 6 个虚方法（多态相关的，final，static 不会列入）</p>
<p>那么这 6 个方法都是谁呢？从 Class 的起始地址开始算，偏移 0x1b8 就是 vtable 的起始地址，进行计算得到：</p>
<p><img src="/JVM/image-20221102110340837.png" srcset="/img/loading.gif" lazyload alt="image-20221102110340837"></p>
<p>通过 Windows -&gt; Console 进入命令行模式，执行</p>
<p><img src="/JVM/image-20221102110353791.png" srcset="/img/loading.gif" lazyload alt="image-20221102110353791"></p>
<p>就得到了 6 个虚方法的入口地址</p>
<p>7）验证方法地址</p>
<p>通过 Tools -&gt; Class Browser 查看每个类的方法定义，比较可知</p>
<p><img src="/JVM/image-20221102110413384.png" srcset="/img/loading.gif" lazyload alt="image-20221102110413384"></p>
<p>对号入座，发现</p>
<ul>
<li>eat() 方法是 Dog 类自己的 </li>
<li>toString() 方法是继承 String 类的 </li>
<li>finalize() ，equals()，hashCode()，clone() 都是继承 Object 类的</li>
</ul>
<p>8）小结</p>
<p>当执行 invokevirtual 指令时， </p>
<ol>
<li>先通过栈帧中的对象引用找到对象 </li>
<li>分析对象头，找到对象的实际 Class </li>
<li>Class 结构中有 vtable，它在类加载的链接阶段就已经根据方法的重写规则生成好了 </li>
<li>查表得到方法的具体地址 </li>
<li>执行方法的字节码</li>
</ol>
<h3 id="3-2-11、异常处理"><a href="#3-2-11、异常处理" class="headerlink" title="3.2.11、异常处理"></a>3.2.11、异常处理</h3><p>try-catch</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo3_11_1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            i = <span class="hljs-number">10</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            i = <span class="hljs-number">20</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>注意 </p>
<p>为了抓住重点，下面的字节码省略了不重要的部分</p>
</blockquote>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs makefile">public static void main(java.lang.String[]);<br><span class="hljs-section">descriptor: ([Ljava/lang/String;)V</span><br><span class="hljs-section">flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="hljs-section">Code:</span><br>stack=1, locals=3, args_size=1<br><span class="hljs-section">0: iconst_0</span><br><span class="hljs-section">1: istore_1</span><br><span class="hljs-section">2: bipush 10</span><br><span class="hljs-section">4: istore_1</span><br><span class="hljs-section">5: goto 12</span><br><span class="hljs-section">8: astore_2</span><br><span class="hljs-section">9: bipush 20</span><br><span class="hljs-section">11: istore_1</span><br><span class="hljs-section">12: return</span><br>Exception table:<br>from to target type<br>2 5 8 Class java/lang/Exception<br><span class="hljs-section">LineNumberTable: ...</span><br><span class="hljs-section">LocalVariableTable:</span><br>Start Length Slot Name Signature<br>9 3 2 e Ljava/lang/Exception;<br>0 13 0 args [Ljava/lang/String;<br>2 11 1 i I<br><span class="hljs-section">StackMapTable: ...</span><br><span class="hljs-section">MethodParameters: ...</span><br>&#125;<br><br></code></pre></td></tr></table></figure>



<h3 id="3-2-12、练习-finally"><a href="#3-2-12、练习-finally" class="headerlink" title="3.2.12、练习 - finally"></a>3.2.12、练习 - finally</h3><h3 id="3-2-13、synchronized"><a href="#3-2-13、synchronized" class="headerlink" title="3.2.13、synchronized"></a>3.2.13、synchronized</h3><h2 id="3-3、编译器处理"><a href="#3-3、编译器处理" class="headerlink" title="3.3、编译器处理"></a>3.3、编译器处理</h2><h3 id="3-3-1、默认构造器"><a href="#3-3-1、默认构造器" class="headerlink" title="3.3.1、默认构造器"></a>3.3.1、默认构造器</h3><h3 id="3-3-2、自动拆装箱"><a href="#3-3-2、自动拆装箱" class="headerlink" title="3.3.2、自动拆装箱"></a>3.3.2、自动拆装箱</h3><h3 id="3-3-3、泛型集合取值"><a href="#3-3-3、泛型集合取值" class="headerlink" title="3.3.3、泛型集合取值"></a>3.3.3、泛型集合取值</h3><h3 id="3-3-4、可变参数"><a href="#3-3-4、可变参数" class="headerlink" title="3.3.4、可变参数"></a>3.3.4、可变参数</h3><h3 id="3-3-5、foreach循环"><a href="#3-3-5、foreach循环" class="headerlink" title="3.3.5、foreach循环"></a>3.3.5、foreach循环</h3><h3 id="3-3-6、switch字符串"><a href="#3-3-6、switch字符串" class="headerlink" title="3.3.6、switch字符串"></a>3.3.6、switch字符串</h3><h3 id="3-3-7、switch枚举"><a href="#3-3-7、switch枚举" class="headerlink" title="3.3.7、switch枚举"></a>3.3.7、switch枚举</h3><h3 id="3-3-8、枚举类"><a href="#3-3-8、枚举类" class="headerlink" title="3.3.8、枚举类"></a>3.3.8、枚举类</h3><h3 id="3-3-9、try-with-resources"><a href="#3-3-9、try-with-resources" class="headerlink" title="3.3.9、try-with-resources"></a>3.3.9、try-with-resources</h3><h3 id="3-3-10、方法重写时的桥接方法"><a href="#3-3-10、方法重写时的桥接方法" class="headerlink" title="3.3.10、方法重写时的桥接方法"></a>3.3.10、方法重写时的桥接方法</h3><h3 id="3-3-11、匿名内部类"><a href="#3-3-11、匿名内部类" class="headerlink" title="3.3.11、匿名内部类"></a>3.3.11、匿名内部类</h3><h2 id="3-4、类加载阶段"><a href="#3-4、类加载阶段" class="headerlink" title="3.4、类加载阶段"></a>3.4、类加载阶段</h2><h3 id="3-4-1、加载"><a href="#3-4-1、加载" class="headerlink" title="3.4.1、加载"></a>3.4.1、加载</h3><h3 id="3-4-2、链接"><a href="#3-4-2、链接" class="headerlink" title="3.4.2、链接"></a>3.4.2、链接</h3><h3 id="3-4-3、初始化"><a href="#3-4-3、初始化" class="headerlink" title="3.4.3、初始化"></a>3.4.3、初始化</h3><h3 id="3-4-4、练习"><a href="#3-4-4、练习" class="headerlink" title="3.4.4、练习"></a>3.4.4、练习</h3><h2 id="3-5、类加载器"><a href="#3-5、类加载器" class="headerlink" title="3.5、类加载器"></a>3.5、类加载器</h2><h3 id="3-5-1、启动类加载器"><a href="#3-5-1、启动类加载器" class="headerlink" title="3.5.1、启动类加载器"></a>3.5.1、启动类加载器</h3><h3 id="3-5-2、扩展类加载器"><a href="#3-5-2、扩展类加载器" class="headerlink" title="3.5.2、扩展类加载器"></a>3.5.2、扩展类加载器</h3><h3 id="3-5-3、双亲委派模式"><a href="#3-5-3、双亲委派模式" class="headerlink" title="3.5.3、双亲委派模式"></a>3.5.3、双亲委派模式</h3><h3 id="3-5-4、线程上下文类加载器"><a href="#3-5-4、线程上下文类加载器" class="headerlink" title="3.5.4、线程上下文类加载器"></a>3.5.4、线程上下文类加载器</h3><h3 id="3-5-5、自定义类加载器"><a href="#3-5-5、自定义类加载器" class="headerlink" title="3.5.5、自定义类加载器"></a>3.5.5、自定义类加载器</h3><h2 id="3-6、运行期优化"><a href="#3-6、运行期优化" class="headerlink" title="3.6、运行期优化"></a>3.6、运行期优化</h2><h3 id="3-6-1、即时编译"><a href="#3-6-1、即时编译" class="headerlink" title="3.6.1、即时编译"></a>3.6.1、即时编译</h3><h3 id="3-6-2、反射优化"><a href="#3-6-2、反射优化" class="headerlink" title="3.6.2、反射优化"></a>3.6.2、反射优化</h3><h1 id="4、内存模型"><a href="#4、内存模型" class="headerlink" title="4、内存模型"></a>4、内存模型</h1><h2 id="4-1、java内存模型"><a href="#4-1、java内存模型" class="headerlink" title="4.1、java内存模型"></a>4.1、java内存模型</h2><p>4.1.1、原子性</p>
<p>4.1.2、问题分析</p>
<p>4.1.3、解决方法</p>
<h2 id="4-2、可见性"><a href="#4-2、可见性" class="headerlink" title="4.2、可见性"></a>4.2、可见性</h2><p>4.2.1、退不出的循环</p>
<p>4.2.2、解决方法</p>
<p>4.2.3、可见性</p>
<h2 id="4-3、有序性"><a href="#4-3、有序性" class="headerlink" title="4.3、有序性"></a>4.3、有序性</h2><p>4.3.1、诡异的结果</p>
<p>4.3.2、解决方法</p>
<p>4.3.3、有序性理解</p>
<p>4.3.4、happens-before</p>
<h2 id="4-4、CAS与原子类"><a href="#4-4、CAS与原子类" class="headerlink" title="4.4、CAS与原子类"></a>4.4、CAS与原子类</h2><p>4.4.1、CAS</p>
<p>4.4.2、乐观锁与悲观锁</p>
<p>4.4.3、原子操作类</p>
<h2 id="4-5、synchronized优化"><a href="#4-5、synchronized优化" class="headerlink" title="4.5、synchronized优化"></a>4.5、synchronized优化</h2><p>4.5.1、轻量级锁</p>
<p>4.5.2、锁膨胀</p>
<p>4.5.3、重量锁</p>
<p>4.5.4、偏向锁</p>
<p>4.5.5、其它优化</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>JVM</div>
      <div>https://kblayt.github.io/2022/10/26/Java Virtual Machine/JVM/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Kblayt</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年10月26日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/10/28/Java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B8%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B/" title="并发编程与多线程">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">并发编程与多线程</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/10/22/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/Git%E6%8F%90%E4%BA%A4%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" title="Git提交项目笔记">
                        <span class="hidden-mobile">Git提交项目笔记</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
