

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Kblayt">
  <meta name="keywords" content="">
  
    <meta name="description" content="一、简介1.1 概述XXL-JOB是一个分布式任务调度平台，其核心设计目标是开发迅速、学习简单、轻量级、易扩展。现已开放源代码并介入多家公司上线产品，开箱即用。 1.2 社区交流社区交流 1.3 特性1、简单：支持通过Web页面对任务进行CRUD操作，操作简单，一分钟上手； 2、动态：支持动态修改任务状态、启动&#x2F;停止任务，以及终止运行中任务，即时生效； 3、调度中心HA（中心式）：调度采">
<meta property="og:type" content="article">
<meta property="og:title" content="XXL-JOB">
<meta property="og:url" content="https://kblayt.github.io/2023/03/02/%E4%B8%AD%E9%97%B4%E4%BB%B6/XXL-JOB/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="一、简介1.1 概述XXL-JOB是一个分布式任务调度平台，其核心设计目标是开发迅速、学习简单、轻量级、易扩展。现已开放源代码并介入多家公司上线产品，开箱即用。 1.2 社区交流社区交流 1.3 特性1、简单：支持通过Web页面对任务进行CRUD操作，操作简单，一分钟上手； 2、动态：支持动态修改任务状态、启动&#x2F;停止任务，以及终止运行中任务，即时生效； 3、调度中心HA（中心式）：调度采">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130133254085.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130133224429.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130133234268.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130134312376.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130134320833.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130134415020.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130134439008.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130135053370.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130135153730.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130135210550.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130135226920.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130135243634.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130135353613.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130135422797.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130135815134.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130135838852.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130135852061.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130135909121.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130140003583.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130140114835.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130140216563.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130140227816.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130140239533.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130140252659.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130140304820.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130140454104.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/img_jrdI.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130140720853.png">
<meta property="og:image" content="https://kblayt.github.io/XXL-JOB/image-20221130140730088.png">
<meta property="article:published_time" content="2023-03-02T01:41:03.000Z">
<meta property="article:modified_time" content="2023-05-31T02:48:26.762Z">
<meta property="article:author" content="Kblayt">
<meta property="article:tag" content="定时任务框架">
<meta property="article:tag" content="XXL-JOB">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://kblayt.github.io/XXL-JOB/image-20221130133254085.png">
  
  
  
  <title>XXL-JOB - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"kblayt.github.io","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="XXL-JOB"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-03-02 09:41" pubdate>
          2023年3月2日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          49k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          406 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">XXL-JOB</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h1><h2 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1 概述"></a>1.1 概述</h2><p>XXL-JOB是一个分布式任务调度平台，其核心设计目标是开发迅速、学习简单、轻量级、易扩展。现已开放源代码并介入多家公司上线产品，开箱即用。</p>
<h2 id="1-2-社区交流"><a href="#1-2-社区交流" class="headerlink" title="1.2 社区交流"></a>1.2 社区交流</h2><p><a target="_blank" rel="noopener" href="https://www.xuxueli.com/page/community.html">社区交流</a></p>
<h2 id="1-3-特性"><a href="#1-3-特性" class="headerlink" title="1.3 特性"></a>1.3 特性</h2><p>1、简单：支持通过Web页面对任务进行CRUD操作，操作简单，一分钟上手；</p>
<p>2、动态：支持动态修改任务状态、启动&#x2F;停止任务，以及终止运行中任务，即时生效；</p>
<p>3、调度中心HA（中心式）：调度采用中心式设计，“调度中心”自研调度组件并支持集群部署，可保证调度中心HA；</p>
<p>4、执行器HA（分布式）：任务分布式执行，任务”执行器”支持集群部署，可保证任务执行HA；</p>
<p>5、注册中心: 执行器会周期性自动注册任务, 调度中心将会自动发现注册的任务并触发执行。同时，也支持手动录入执行器地址；</p>
<p>6、弹性扩容缩容：一旦有新执行器机器上线或者下线，下次调度时将会重新分配任务；</p>
<p>7、触发策略：提供丰富的任务触发策略，包括：Cron触发、固定间隔触发、固定延时触发、API（事件）触发、人工触发、父子任务触发；</p>
<p>8、调度过期策略：调度中心错过调度时间的补偿处理策略，包括：忽略、立即补偿触发一次等；</p>
<p>9、阻塞处理策略：调度过于密集执行器来不及处理时的处理策略，策略包括：单机串行（默认）、丢弃后续调度、覆盖之前调度；</p>
<p>10、任务超时控制：支持自定义任务超时时间，任务运行超时将会主动中断任务；</p>
<p>11、任务失败重试：支持自定义任务失败重试次数，当任务失败时将会按照预设的失败重试次数主动进行重试；其中分片任务支持分片粒度的失败重试；</p>
<p>12、任务失败告警；默认提供邮件方式失败告警，同时预留扩展接口，可方便的扩展短信、钉钉等告警方式；</p>
<p>13、路由策略：执行器集群部署时提供丰富的路由策略，包括：第一个、最后一个、轮询、随机、一致性HASH、最不经常使用、最近最久未使用、故障转移、忙碌转移等；</p>
<p>14、分片广播任务：执行器集群部署时，任务路由策略选择”分片广播”情况下，一次任务调度将会广播触发集群中所有执行器执行一次任务，可根据分片参数开发分片任务；</p>
<p>15、动态分片：分片广播任务以执行器为维度进行分片，支持动态扩容执行器集群从而动态增加分片数量，协同进行业务处理；在进行大数据量业务操作时可显著提升任务处理能力和速度。</p>
<p>16、故障转移：任务路由策略选择”故障转移”情况下，如果执行器集群中某一台机器故障，将会自动Failover切换到一台正常的执行器发送调度请求。</p>
<p>17、任务进度监控：支持实时监控任务进度；</p>
<p>18、Rolling实时日志：支持在线查看调度结果，并且支持以Rolling方式实时查看执行器输出的完整的执行日志；</p>
<p>19、GLUE：提供Web IDE，支持在线开发任务逻辑代码，动态发布，实时编译生效，省略部署上线的过程。支持30个版本的历史版本回溯。</p>
<p>20、脚本任务：支持以GLUE模式开发和运行脚本任务，包括Shell、Python、NodeJS、PHP、PowerShell等类型脚本;</p>
<p>21、命令行任务：原生提供通用命令行任务Handler（Bean任务，”CommandJobHandler”）；业务方只需要提供命令行即可；</p>
<p>22、任务依赖：支持配置子任务依赖，当父任务执行结束且执行成功后将会主动触发一次子任务的执行, 多个子任务用逗号分隔；</p>
<p>23、一致性：“调度中心”通过DB锁保证集群分布式调度的一致性, 一次任务调度只会触发一次执行；</p>
<p>24、自定义任务参数：支持在线配置调度任务入参，即时生效；</p>
<p>25、调度线程池：调度系统多线程触发调度运行，确保调度精确执行，不被堵塞；</p>
<p>26、数据加密：调度中心和执行器之间的通讯进行数据加密，提升调度信息安全性；</p>
<p>27、邮件报警：任务失败时支持邮件报警，支持配置多邮件地址群发报警邮件；</p>
<p>28、推送maven中央仓库: 将会把最新稳定版推送到maven中央仓库, 方便用户接入和使用;</p>
<p>29、运行报表：支持实时查看运行数据，如任务数量、调度次数、执行器数量等；以及调度报表，如调度日期分布图，调度成功分布图等；</p>
<p>30、全异步：任务调度流程全异步化设计实现，如异步调度、异步运行、异步回调等，有效对密集调度进行流量削峰，理论上支持任意时长任务的运行；</p>
<p>31、跨语言：调度中心与执行器提供语言无关的 RESTful API 服务，第三方任意语言可据此对接调度中心或者实现执行器。除此之外，还提供了 “多任务模式”和“httpJobHandler”等其他跨语言方案；</p>
<p>32、国际化：调度中心支持国际化设置，提供中文、英文两种可选语言，默认为中文；</p>
<p>33、容器化：提供官方docker镜像，并实时更新推送dockerhub，进一步实现产品开箱即用；</p>
<p>34、线程池隔离：调度线程池进行隔离拆分，慢任务自动降级进入”Slow”线程池，避免耗尽调度线程，提高系统稳定性；</p>
<p>35、用户管理：支持在线管理系统用户，存在管理员、普通用户两种角色；</p>
<p>36、权限控制：执行器维度进行权限控制，管理员拥有全量权限，普通用户需要分配执行器权限后才允许相关操作；</p>
<h2 id="1-4-发展"><a href="#1-4-发展" class="headerlink" title="1.4  发展"></a>1.4  发展</h2><p>略</p>
<h2 id="1-5-下载"><a href="#1-5-下载" class="headerlink" title="1.5 下载"></a>1.5 下载</h2><h4 id="文档地址"><a href="#文档地址" class="headerlink" title="文档地址"></a>文档地址</h4><p>​	<a target="_blank" rel="noopener" href="https://www.xuxueli.com/xxl-job/">中文文档</a></p>
<p>​	<a target="_blank" rel="noopener" href="https://www.xuxueli.com/xxl-job/en/">English Documentation</a></p>
<h4 id="源码仓库地址"><a href="#源码仓库地址" class="headerlink" title="源码仓库地址"></a>源码仓库地址</h4><table>
<thead>
<tr>
<th align="left">源码仓库地址</th>
<th align="left">Release Download</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/xuxueli/xxl-job">https://github.com/xuxueli/xxl-job</a></td>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/xuxueli/xxl-job/releases">Download</a></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="http://gitee.com/xuxueli0323/xxl-job">http://gitee.com/xuxueli0323/xxl-job</a></td>
<td align="left"><a target="_blank" rel="noopener" href="http://gitee.com/xuxueli0323/xxl-job/releases">Download</a></td>
</tr>
</tbody></table>
<h4 id="中央仓库地址"><a href="#中央仓库地址" class="headerlink" title="中央仓库地址"></a>中央仓库地址</h4><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-comment">&lt;!-- http://repo1.maven.org/maven2/com/xuxueli/xxl-job-core/ --&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuxueli<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xxl-job-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;最新稳定版本&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<h3 id="1-6-环境"><a href="#1-6-环境" class="headerlink" title="1.6 环境"></a>1.6 环境</h3><p>​	Maven3+</p>
<p>​	Jdk1.8+</p>
<p>​	Mysql5.7+</p>
<h1 id="二、快速入门"><a href="#二、快速入门" class="headerlink" title="二、快速入门"></a>二、快速入门</h1><h2 id="2-1-初始化“调度数据库”"><a href="#2-1-初始化“调度数据库”" class="headerlink" title="2.1 初始化“调度数据库”"></a>2.1 初始化“调度数据库”</h2><p>请下载项目源码并解压，获取 “调度数据库初始化SQL脚本” 并执行即可。</p>
<p>“调度数据库初始化SQL脚本” 位置为:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/xxl-job/</span>doc<span class="hljs-regexp">/db/</span>tables_xxl_job.sql<br></code></pre></td></tr></table></figure>

<p>调度中心支持集群部署，集群情况下各节点务必连接同一个mysql实例;</p>
<p>如果mysql做主从,调度中心集群节点务必强制走主库;</p>
<h2 id="2-2-编译源码"><a href="#2-2-编译源码" class="headerlink" title="2.2 编译源码"></a>2.2 编译源码</h2><p>解压源码,按照maven格式将源码导入IDE, 使用maven进行编译即可，源码结构如下：</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cos">xxl-<span class="hljs-keyword">job</span>-admin：调度中心<br>xxl-<span class="hljs-keyword">job</span>-core：公共依赖<br>xxl-<span class="hljs-keyword">job</span>-executor-samples：执行器Sample示例（选择合适的版本执行器，可直接使用，也可以参考其并将现有项目改造成执行器）<br>	：xxl-<span class="hljs-keyword">job</span>-executor-sample-springboot：Springboot版本，通过Springboot管理执行器，推荐这种方式；<br>    ：xxl-<span class="hljs-keyword">job</span>-executor-sample-frameless：无框架版本；<br></code></pre></td></tr></table></figure>

<h2 id="2-3-配置部署“调度中心”"><a href="#2-3-配置部署“调度中心”" class="headerlink" title="2.3 配置部署“调度中心”"></a>2.3 配置部署“调度中心”</h2><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cos">调度中心项目：xxl-<span class="hljs-keyword">job</span>-admin<br>作用：统一管理任务调度平台上调度任务，负责触发调度执行，并且提供任务管理平台。<br></code></pre></td></tr></table></figure>

<h3 id="步骤一：调度中心配置："><a href="#步骤一：调度中心配置：" class="headerlink" title="步骤一：调度中心配置："></a>步骤一：调度中心配置：</h3><p>调度中心配置文件地址：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/xxl-job/</span>xxl-job-admin<span class="hljs-regexp">/src/m</span>ain<span class="hljs-regexp">/resources/</span>application.properties<br></code></pre></td></tr></table></figure>

<p>调度中心配置内容说明：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">### 调度中心JDBC链接：链接地址请保持和 2.1章节 所创建的调度数据库的地址一致</span><br>spring.datasource.<span class="hljs-attribute">url</span>=jdbc:mysql://127.0.0.1:3306/xxl_job?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai<br>spring.datasource.<span class="hljs-attribute">username</span>=root<br>spring.datasource.<span class="hljs-attribute">password</span>=root_pwd<br>spring.datasource.<span class="hljs-attribute">driver-class-name</span>=com.mysql.jdbc.Driver<br><br><span class="hljs-comment">### 报警邮箱</span><br>spring.mail.<span class="hljs-attribute">host</span>=smtp.qq.com<br>spring.mail.<span class="hljs-attribute">port</span>=25<br>spring.mail.<span class="hljs-attribute">username</span>=xxx@qq.com<br>spring.mail.<span class="hljs-attribute">password</span>=xxx<br>spring.mail.properties.mail.smtp.<span class="hljs-attribute">auth</span>=<span class="hljs-literal">true</span><br>spring.mail.properties.mail.smtp.starttls.<span class="hljs-attribute">enable</span>=<span class="hljs-literal">true</span><br>spring.mail.properties.mail.smtp.starttls.<span class="hljs-attribute">required</span>=<span class="hljs-literal">true</span><br>spring.mail.properties.mail.smtp.socketFactory.<span class="hljs-attribute">class</span>=javax.net.ssl.SSLSocketFactory<br><br><span class="hljs-comment">### 调度中心通讯TOKEN [选填]：非空时启用；</span><br>xxl.job.accessToken=<br><br><span class="hljs-comment">### 调度中心国际化配置 [必填]： 默认为 &quot;zh_CN&quot;/中文简体, 可选范围为 &quot;zh_CN&quot;/中文简体, &quot;zh_TC&quot;/中文繁体 and &quot;en&quot;/英文；</span><br>xxl.job.<span class="hljs-attribute">i18n</span>=zh_CN<br><br><span class="hljs-comment">## 调度线程池最大线程配置【必填】</span><br>xxl.job.triggerpool.fast.<span class="hljs-attribute">max</span>=200<br>xxl.job.triggerpool.slow.<span class="hljs-attribute">max</span>=100<br><br><span class="hljs-comment">### 调度中心日志表数据保存天数 [必填]：过期日志自动清理；限制大于等于7时生效，否则, 如-1，关闭自动清理功能；</span><br>xxl.job.<span class="hljs-attribute">logretentiondays</span>=30<br></code></pre></td></tr></table></figure>

<h3 id="步骤二：部署项目："><a href="#步骤二：部署项目：" class="headerlink" title="步骤二：部署项目："></a>步骤二：部署项目：</h3><p>如果已经正确进行上述配置，可将项目编译打包部署。</p>
<p>调度中心访问地址：<a target="_blank" rel="noopener" href="http://localhost:8080/xxl-job-admin">http://localhost:8080/xxl-job-admin</a> (该地址执行器将会使用到，作为回调地址)</p>
<p>默认登录账号 “admin&#x2F;123456”, 登录后运行界面如下图所示。</p>
<p><img src="/XXL-JOB/image-20221130133254085.png" srcset="/img/loading.gif" lazyload alt="image-20221130133254085"></p>
<p>至此“调度中心”项目已经部署成功。</p>
<h3 id="步骤三：调度中心集群（可选）："><a href="#步骤三：调度中心集群（可选）：" class="headerlink" title="步骤三：调度中心集群（可选）："></a>步骤三：调度中心集群（可选）：</h3><p>调度中心支持集群部署，提升调度系统容灾和可用性。</p>
<p>调度中心集群部署时，几点要求和建议：</p>
<ul>
<li>DB配置保持一致；</li>
<li>集群机器时钟保持一致（单机集群忽视）；</li>
<li>建议：推荐通过nginx为调度中心集群做负载均衡，分配域名。调度中心访问、执行器回调配置、调用API服务等操作均通过该域名进行。</li>
</ul>
<h4 id="其他：Docker-镜像方式搭建调度中心："><a href="#其他：Docker-镜像方式搭建调度中心：" class="headerlink" title="其他：Docker 镜像方式搭建调度中心："></a>其他：Docker 镜像方式搭建调度中心：</h4><ul>
<li>下载镜像</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> Docker地址：https:<span class="hljs-regexp">//</span>hub.docker.com<span class="hljs-regexp">/r/</span>xuxueli<span class="hljs-regexp">/xxl-job-admin/</span>     (建议指定版本号)<br>docker pull xuxueli/xxl-job-admin<br></code></pre></td></tr></table></figure>

<ul>
<li>创建容器并运行</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker run -p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> -v <span class="hljs-regexp">/tmp:/</span>data<span class="hljs-regexp">/applogs --name xxl-job-admin  -d xuxueli/</span>xxl-job-admin:&#123;指定版本&#125;<br>/**<br>* 如需自定义 mysql 等配置，可通过 <span class="hljs-string">&quot;-e PARAMS&quot;</span> 指定，参数格式 PARAMS=<span class="hljs-string">&quot;--key=value  --key2=value2&quot;</span> ;<br>* 配置项参考文件：<span class="hljs-regexp">/xxl-job/</span>xxl-job-admin<span class="hljs-regexp">/src/m</span>ain<span class="hljs-regexp">/resources/</span>application.properties<br>* 如需自定义 JVM内存参数 等配置，可通过 <span class="hljs-string">&quot;-e JAVA_OPTS&quot;</span> 指定，参数格式 JAVA_OPTS=<span class="hljs-string">&quot;-Xmx512m&quot;</span> ;<br>*/<br>docker run -e PARAMS=<span class="hljs-string">&quot;--spring.datasource.url=jdbc:mysql://127.0.0.1:3306/xxl_job?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai&quot;</span> -p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> -v <span class="hljs-regexp">/tmp:/</span>data<span class="hljs-regexp">/applogs --name xxl-job-admin  -d xuxueli/</span>xxl-job-admin:&#123;指定版本&#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-4-配置部署“执行器项目”"><a href="#2-4-配置部署“执行器项目”" class="headerlink" title="2.4 配置部署“执行器项目”"></a>2.4 配置部署“执行器项目”</h2><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cos">“执行器”项目：xxl-<span class="hljs-keyword">job</span>-executor-sample-springboot (提供多种版本执行器供选择，现以 springboot 版本为例，可直接使用，也可以参考其并将现有项目改造成执行器)<br>作用：负责接收“调度中心”的调度并执行；可直接部署执行器，也可以将执行器集成到现有业务项目中。<br></code></pre></td></tr></table></figure>

<h3 id="步骤一：maven依赖"><a href="#步骤一：maven依赖" class="headerlink" title="步骤一：maven依赖"></a>步骤一：maven依赖</h3><p>确认pom文件中引入了 “xxl-job-core” 的maven依赖；</p>
<h3 id="步骤二：执行器配置"><a href="#步骤二：执行器配置" class="headerlink" title="步骤二：执行器配置"></a>步骤二：执行器配置</h3><p>执行器配置，配置文件地址：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/xxl-job/</span>xxl-job-executor-samples<span class="hljs-regexp">/xxl-job-executor-sample-springboot/</span>src<span class="hljs-regexp">/main/</span>resources/application.properties<br></code></pre></td></tr></table></figure>

<p>执行器配置，配置内容说明：</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs clean">### 调度中心部署根地址 [选填]：如调度中心集群部署存在多个地址则用逗号分隔。执行器将会使用该地址进行<span class="hljs-string">&quot;执行器心跳注册&quot;</span>和<span class="hljs-string">&quot;任务结果回调&quot;</span>；为空则关闭自动注册；xxl.job.admin.addresses=http:<span class="hljs-comment">//127.0.0.1:8080/xxl-job-admin</span><br><br>### 执行器通讯TOKEN [选填]：非空时启用；<br>xxl.job.accessToken=<br><br>### 执行器AppName [选填]：执行器心跳注册分组依据；为空则关闭自动注册<br>xxl.job.executor.appname=xxl-job-executor-sample<br>### 执行器注册 [选填]：优先使用该配置作为注册地址，为空时使用内嵌服务 ”IP:PORT“ 作为注册地址。从而更灵活的支持容器类型执行器动态IP和动态映射端口问题。<br>xxl.job.executor.address=<br>### 执行器IP [选填]：默认为空表示自动获取IP，多网卡时可手动设置指定IP，该IP不会绑定Host仅作为通讯实用；地址信息用于 <span class="hljs-string">&quot;执行器注册&quot;</span> 和 <span class="hljs-string">&quot;调度中心请求并触发任务&quot;</span>；<br>xxl.job.executor.ip=<br>### 执行器端口号 [选填]：小于等于<span class="hljs-number">0</span>则自动获取；默认端口为<span class="hljs-number">9999</span>，单机部署多个执行器时，注意要配置不同执行器端口；xxl.job.executor.port=<span class="hljs-number">9999</span><br>### 执行器运行日志文件存储磁盘路径 [选填] ：需要对该路径拥有读写权限；为空则使用默认路径；xxl.job.executor.logpath=/data/applogs/xxl-job/jobhandler<br>### 执行器日志文件保存天数 [选填] ： 过期日志自动清理, 限制值大于等于<span class="hljs-number">3</span>时生效; 否则, 如<span class="hljs-number">-1</span>, 关闭自动清理功能；<br>xxl.job.executor.logretentiondays=<span class="hljs-number">30</span><br></code></pre></td></tr></table></figure>

<h3 id="步骤三：执行器组件配置"><a href="#步骤三：执行器组件配置" class="headerlink" title="步骤三：执行器组件配置"></a>步骤三：执行器组件配置</h3><p>执行器组件，配置文件地址：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/xxl-job/</span>xxl-job-executor-samples<span class="hljs-regexp">/xxl-job-executor-sample-springboot/</span>src<span class="hljs-regexp">/main/</span>java<span class="hljs-regexp">/com/</span>xxl<span class="hljs-regexp">/job/</span>executor<span class="hljs-regexp">/core/</span>config/XxlJobConfig.java<br></code></pre></td></tr></table></figure>

<p>执行器组件，配置内容说明：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">@Bean<br>public XxlJobSpringExecutor xxl<span class="hljs-constructor">JobExecutor()</span> &#123;<br>	logger.info(<span class="hljs-string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job config init.&quot;</span>);    <br>	XxlJobSpringExecutor xxlJobSpringExecutor = <span class="hljs-keyword">new</span> <span class="hljs-constructor">XxlJobSpringExecutor()</span>; <br>	xxlJobSpringExecutor.set<span class="hljs-constructor">AdminAddresses(<span class="hljs-params">adminAddresses</span>)</span>;    <br>	xxlJobSpringExecutor.set<span class="hljs-constructor">Appname(<span class="hljs-params">appname</span>)</span>;    <br>	xxlJobSpringExecutor.set<span class="hljs-constructor">Ip(<span class="hljs-params">ip</span>)</span>;    <br>	xxlJobSpringExecutor.set<span class="hljs-constructor">Port(<span class="hljs-params">port</span>)</span>;    <br>	xxlJobSpringExecutor.set<span class="hljs-constructor">AccessToken(<span class="hljs-params">accessToken</span>)</span>;    <br>	xxlJobSpringExecutor.set<span class="hljs-constructor">LogPath(<span class="hljs-params">logPath</span>)</span>;    <br>	xxlJobSpringExecutor.set<span class="hljs-constructor">LogRetentionDays(<span class="hljs-params">logRetentionDays</span>)</span>; <br>    <br>	return xxlJobSpringExecutor;<br>	&#125;<br></code></pre></td></tr></table></figure>

<h3 id="步骤四：部署执行器项目："><a href="#步骤四：部署执行器项目：" class="headerlink" title="步骤四：部署执行器项目："></a>步骤四：部署执行器项目：</h3><p>如果已经正确进行上述配置，可将执行器项目编译打部署，系统提供多种执行器Sample示例项目，选择其中一个即可，各自的部署方式如下。</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cos">xxl-<span class="hljs-keyword">job</span>-executor-sample-springboot：项目编译打包成springboot类型的可执行JAR包，命令启动即可；<br>xxl-<span class="hljs-keyword">job</span>-executor-sample-frameless：项目编译打包成JAR包，命令启动即可；<br></code></pre></td></tr></table></figure>

<p>至此“执行器”项目已经部署结束。</p>
<h3 id="步骤五：执行器集群（可选）："><a href="#步骤五：执行器集群（可选）：" class="headerlink" title="步骤五：执行器集群（可选）："></a>步骤五：执行器集群（可选）：</h3><p>执行器支持集群部署，提升调度系统可用性，同时提升任务处理能力。</p>
<p>执行器集群部署时，几点要求和建议：</p>
<ul>
<li>执行器回调地址（xxl.job.admin.addresses）需要保持一致；执行器根据该配置进行执行器自动注册等操作。</li>
<li>同一个执行器集群内AppName（xxl.job.executor.appname）需要保持一致；调度中心根据该配置动态发现不同集群的在线执行器列表。</li>
</ul>
<h2 id="2-5-开发第一个任务“Hello-World”"><a href="#2-5-开发第一个任务“Hello-World”" class="headerlink" title="2.5 开发第一个任务“Hello World”"></a>2.5 开发第一个任务“Hello World”</h2><p>本示例以新建一个 “GLUE模式(Java)” 运行模式的任务为例。更多有关任务的详细配置，请查看“章节三：任务详解”。<br>（ “GLUE模式(Java)”的执行代码托管到调度中心在线维护，相比“Bean模式任务”需要在执行器项目开发部署上线，更加简便轻量）</p>
<blockquote>
<p>前提：请确认“调度中心”和“执行器”项目已经成功部署并启动；</p>
</blockquote>
<h3 id="步骤一：新建任务："><a href="#步骤一：新建任务：" class="headerlink" title="步骤一：新建任务："></a>步骤一：新建任务：</h3><p>登录调度中心，点击下图所示“新建任务”按钮，新建示例任务。然后，参考下面截图中任务的参数配置，点击保存。</p>
<p><img src="/XXL-JOB/image-20221130133224429.png" srcset="/img/loading.gif" lazyload alt="image-20221130133224429"></p>
<p><img src="/XXL-JOB/image-20221130133234268.png" srcset="/img/loading.gif" lazyload alt="image-20221130133234268"></p>
<h3 id="步骤二：“GLUE模式-Java-”-任务开发："><a href="#步骤二：“GLUE模式-Java-”-任务开发：" class="headerlink" title="步骤二：“GLUE模式(Java)” 任务开发："></a>步骤二：“GLUE模式(Java)” 任务开发：</h3><p>请点击任务右侧 “GLUE” 按钮，进入 “GLUE编辑器开发界面” ，见下图。“GLUE模式(Java)” 运行模式的任务默认已经初始化了示例任务代码，即打印Hello World。<br>（ “GLUE模式(Java)” 运行模式的任务实际上是一段继承自IJobHandler的Java类代码，它在执行器项目中运行，可使用<a target="_blank" rel="noopener" href="https://github.com/Resource">@Resource</a>&#x2F;<a target="_blank" rel="noopener" href="https://github.com/Autowire">@Autowire</a>注入执行器里中的其他服务，详细介绍请查看第三章节）</p>
<p><img src="/XXL-JOB/image-20221130134312376.png" srcset="/img/loading.gif" lazyload alt="image-20221130134312376"><img src="/XXL-JOB/image-20221130134320833.png" srcset="/img/loading.gif" lazyload alt="image-20221130134320833"></p>
<h3 id="步骤三：触发执行："><a href="#步骤三：触发执行：" class="headerlink" title="步骤三：触发执行："></a>步骤三：触发执行：</h3><p>请点击任务右侧 “执行” 按钮，可手动触发一次任务执行（通常情况下，通过配置Cron表达式进行任务调度触发）。</p>
<h3 id="步骤四：查看日志："><a href="#步骤四：查看日志：" class="headerlink" title="步骤四：查看日志："></a>步骤四：查看日志：</h3><p>请点击任务右侧 “日志” 按钮，可前往任务日志界面查看任务日志。<br>在任务日志界面中，可查看该任务的历史调度记录以及每一次调度的任务调度信息、执行参数和执行信息。运行中的任务点击右侧的“执行日志”按钮，可进入日志控制台查看实时执行日志。</p>
<p><strong><img src="/XXL-JOB/image-20221130134415020.png" srcset="/img/loading.gif" lazyload alt="image-20221130134415020"></strong></p>
<p>在日志控制台，可以Rolling方式实时查看任务在执行器一侧运行输出的日志信息，实时监控任务进度；</p>
<p><img src="/XXL-JOB/image-20221130134439008.png" srcset="/img/loading.gif" lazyload alt="image-20221130134439008"></p>
<h1 id="三、任务详解"><a href="#三、任务详解" class="headerlink" title="三、任务详解"></a>三、任务详解</h1><h3 id="配置属性详细说明："><a href="#配置属性详细说明：" class="headerlink" title="配置属性详细说明："></a>配置属性详细说明：</h3><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext">基础配置：    <br>	<span class="hljs-bullet">-</span> <span class="hljs-string">执行器：任务的绑定的执行器，任务触发调度时将会自动发现注册成功的执行器, 实现任务自动发现功能; 另一方面也可以方便的进行任务分组。每个任务必须绑定一个执行器, 可在 &quot;执行器管理&quot; 进行设置;    </span><br>	<span class="hljs-bullet">-</span> <span class="hljs-string">任务描述：任务的描述信息，便于任务管理；    </span><br>	<span class="hljs-bullet">-</span> <span class="hljs-string">负责人：任务的负责人；    </span><br>	<span class="hljs-bullet">-</span> <span class="hljs-string">报警邮件：任务调度失败时邮件通知的邮箱地址，支持配置多邮箱地址，配置多个邮箱地址时用逗号分隔；</span><br>	<br>触发配置：    <br>	<span class="hljs-bullet">-</span> <span class="hljs-string">调度类型：        </span><br>		无：该类型不会主动触发调度；        <br>		CRON：该类型将会通过CRON，触发任务调度；        <br>		固定速度：该类型将会以固定速度，触发任务调度；按照固定的间隔时间，周期性触发；        <br>		固定延迟：该类型将会以固定延迟，触发任务调度；按照固定的延迟时间，从上次调度结束后开始计算延迟时间，到达延迟时间后触发下次调度；    <br>	<span class="hljs-bullet">-</span> <span class="hljs-string">CRON：触发任务执行的Cron表达式；    </span><br>	<span class="hljs-bullet">-</span> <span class="hljs-string">固定速度：固定速度的时间间隔，单位为秒；    </span><br>	<span class="hljs-bullet">-</span> <span class="hljs-string">固定延迟：固定延迟的时间间隔，单位为秒；</span><br>	<br>任务配置：    <br>	<span class="hljs-bullet">-</span> <span class="hljs-string">运行模式：        </span><br>		BEAN模式：任务以JobHandler方式维护在执行器端；需要结合 &quot;JobHandler&quot; 属性匹配执行器中任务；        <br>		GLUE模式(Java)：任务以源码方式维护在调度中心；该模式的任务实际上是一段继承自IJobHandler的Java类代码并 &quot;groovy&quot; 源码方式维护，它在执行器项目中运行，可使用@Resource/@Autowire注入执行器里中的其他服务；        <br>		GLUE模式(Shell)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 &quot;shell&quot; 脚本；        <br>		GLUE模式(Python)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 &quot;python&quot; 脚本；        <br>		GLUE模式(PHP)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 &quot;php&quot; 脚本；        <br>		GLUE模式(NodeJS)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 &quot;nodejs&quot; 脚本；        <br>		GLUE模式(PowerShell)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 &quot;PowerShell&quot; 脚本；    <br>	<span class="hljs-bullet">-</span> <span class="hljs-string">JobHandler：运行模式为 &quot;BEAN模式&quot; 时生效，对应执行器中新开发的JobHandler类“@JobHandler”注解自定义的value值；    </span><br>	<span class="hljs-bullet">-</span> <span class="hljs-string">执行参数：任务执行所需的参数；     </span><br>	<br>高级配置：    <br>	<span class="hljs-bullet">-</span> <span class="hljs-string">路由策略：当执行器集群部署时，提供丰富的路由策略，包括；        </span><br>		FIRST（第一个）：固定选择第一个机器；        <br>		LAST（最后一个）：固定选择最后一个机器；        <br>		ROUND（轮询）：；        <br>		RANDOM（随机）：随机选择在线的机器；        <br>		CONSISTENT_HASH（一致性HASH）：每个任务按照Hash算法固定选择某一台机器，且所有任务均匀散列在不同机器上。        <br>		LEAST_FREQUENTLY_USED（最不经常使用）：使用频率最低的机器优先被选举；        <br>		LEAST_RECENTLY_USED（最近最久未使用）：最久未使用的机器优先被选举；        <br>		FAILOVER（故障转移）：按照顺序依次进行心跳检测，第一个心跳检测成功的机器选定为目标执行器并发起调度；        <br>		BUSYOVER（忙碌转移）：按照顺序依次进行空闲检测，第一个空闲检测成功的机器选定为目标执行器并发起调度；        <br>		SHARDING_BROADCAST(分片广播)：广播触发对应集群中所有机器执行一次任务，同时系统自动传递分片参数；可根据分片参数开发分片任务；    <br>	<span class="hljs-bullet">-</span> <span class="hljs-string">子任务：每个任务都拥有一个唯一的任务ID(任务ID可以从任务列表获取)，当本任务执行结束并且执行成功时，将会触发子任务ID所对应的任务的一次主动调度。    </span><br>	<span class="hljs-bullet">-</span> <span class="hljs-string">调度过期策略：        </span><br>		<span class="hljs-bullet">-</span> <span class="hljs-string">忽略：调度过期后，忽略过期的任务，从当前时间开始重新计算下次触发时间；        </span><br>		<span class="hljs-bullet">-</span> <span class="hljs-string">立即执行一次：调度过期后，立即执行一次，并从当前时间开始重新计算下次触发时间；    </span><br>	<span class="hljs-bullet">-</span> <span class="hljs-string">阻塞处理策略：调度过于密集执行器来不及处理时的处理策略；        </span><br>		单机串行（默认）：调度请求进入单机执行器后，调度请求进入FIFO队列并以串行方式运行；        <br>		丢弃后续调度：调度请求进入单机执行器后，发现执行器存在运行的调度任务，本次请求将会被丢弃并标记为失败；        <br>		覆盖之前调度：调度请求进入单机执行器后，发现执行器存在运行的调度任务，将会终止运行中的调度任务并清空队列，然后运行本地调度任务；    <br>	<span class="hljs-bullet">-</span> <span class="hljs-string">任务超时时间：支持自定义任务超时时间，任务运行超时将会主动中断任务；    </span><br>	<span class="hljs-bullet">-</span> <span class="hljs-string">失败重试次数；支持自定义任务失败重试次数，当任务失败时将会按照预设的失败重试次数主动进行重试；</span><br></code></pre></td></tr></table></figure>

<h3 id="3-1-BEAN模式（类形式）"><a href="#3-1-BEAN模式（类形式）" class="headerlink" title="3.1 BEAN模式（类形式）"></a>3.1 BEAN模式（类形式）</h3><p>Bean模式任务，支持基于类的开发方式，每个任务对应一个Java类。</p>
<ul>
<li>优点：不限制项目环境，兼容性好。即使是无框架项目，如main方法直接启动的项目也可以提供支持，可以参考示例项目 “xxl-job-executor-sample-frameless”；</li>
<li>缺点：<ul>
<li>每个任务需要占用一个Java类，造成类的浪费；</li>
<li>不支持自动扫描任务并注入到执行器容器，需要手动注入。</li>
</ul>
</li>
</ul>
<h4 id="步骤一：执行器项目中，开发Job类："><a href="#步骤一：执行器项目中，开发Job类：" class="headerlink" title="步骤一：执行器项目中，开发Job类："></a>步骤一：执行器项目中，开发Job类：</h4><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><span class="hljs-number">1</span>、开发一个继承自<span class="hljs-string">&quot;com.xxl.job.core.handler.IJobHandler&quot;</span>的JobHandler类，实现其中任务方法。<br><span class="hljs-number">2</span>、手动通过如下方式注入到执行器容器。<br>```<br>XxlJobExecutor.registJobHandler(<span class="hljs-string">&quot;demoJobHandler&quot;</span>, <span class="hljs-keyword">new</span> DemoJobHandler())<span class="hljs-comment">;</span><br>```<br></code></pre></td></tr></table></figure>

<h4 id="步骤二：调度中心，新建调度任务"><a href="#步骤二：调度中心，新建调度任务" class="headerlink" title="步骤二：调度中心，新建调度任务"></a>步骤二：调度中心，新建调度任务</h4><p>后续步骤和 “3.2 BEAN模式（方法形式）”一致，可以前往参考。</p>
<h3 id="3-2-BEAN模式（方法形式）"><a href="#3-2-BEAN模式（方法形式）" class="headerlink" title="3.2 BEAN模式（方法形式）"></a>3.2 BEAN模式（方法形式）</h3><p>Bean模式任务，支持基于方法的开发方式，每个任务对应一个方法。</p>
<ul>
<li>优点：<ul>
<li>每个任务只需要开发一个方法，并添加”<a target="_blank" rel="noopener" href="https://github.com/XxlJob">@XxlJob</a>”注解即可，更加方便、快速。</li>
<li>支持自动扫描任务并注入到执行器容器。</li>
</ul>
</li>
<li>缺点：要求Spring容器环境；</li>
</ul>
<blockquote>
<p>基于方法开发的任务，底层会生成JobHandler代理，和基于类的方式一样，任务也会以JobHandler的形式存在于执行器任务容器中。</p>
</blockquote>
<h4 id="步骤一：执行器项目中，开发Job方法："><a href="#步骤一：执行器项目中，开发Job方法：" class="headerlink" title="步骤一：执行器项目中，开发Job方法："></a>步骤一：执行器项目中，开发Job方法：</h4><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cos"><span class="hljs-number">1</span>、任务开发：在Spring Bean实例中，开发<span class="hljs-keyword">Job</span>方法；<br><span class="hljs-number">2</span>、注解配置：为<span class="hljs-keyword">Job</span>方法添加注解 <span class="hljs-string">&quot;@XxlJob(value=&quot;</span>自定义jobhandler名称<span class="hljs-string">&quot;, init = &quot;</span>JobHandler初始化方法<span class="hljs-string">&quot;, destroy = &quot;</span>JobHandler销毁方法<span class="hljs-string">&quot;)&quot;</span>，注解value值对应的是调度中心新建任务的JobHandler属性的值。<br><span class="hljs-number">3</span>、执行日志：需要通过 <span class="hljs-string">&quot;XxlJobHelper.log&quot;</span> 打印执行日志；<br><span class="hljs-number">4</span>、任务结果：默认任务结果为 <span class="hljs-string">&quot;成功&quot;</span> 状态，不需要主动设置；如有诉求，比如设置任务结果为失败，可以通过 <span class="hljs-string">&quot;XxlJobHelper.handleFail/handleSuccess&quot;</span> 自主设置任务结果；<br></code></pre></td></tr></table></figure>

<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">// 可参考Sample示例执行器中的 &quot;com.xxl.job.executor.service.jobhandler.SampleXxlJob&quot; ，如下：@XxlJob(&quot;demoJobHandler&quot;)<br><span class="hljs-built_in">public</span> <span class="hljs-type">void</span> demoJobHandler() throws <span class="hljs-keyword">Exception</span> &#123;    <br>	XxlJobHelper.log(&quot;XXL-JOB, Hello World.&quot;);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="步骤二：调度中心，新建调度任务-1"><a href="#步骤二：调度中心，新建调度任务-1" class="headerlink" title="步骤二：调度中心，新建调度任务"></a>步骤二：调度中心，新建调度任务</h4><p>参考上文“配置属性详细说明”对新建的任务进行参数配置，运行模式选中 “BEAN模式”，JobHandler属性填写任务注解“<a target="_blank" rel="noopener" href="https://github.com/XxlJob">@XxlJob</a>”中定义的值；</p>
<p><img src="/XXL-JOB/image-20221130135053370.png" srcset="/img/loading.gif" lazyload alt="image-20221130135053370"></p>
<h4 id="原生内置Bean模式任务"><a href="#原生内置Bean模式任务" class="headerlink" title="原生内置Bean模式任务"></a>原生内置Bean模式任务</h4><p>为方便用户参考与快速实用，示例执行器内原生提供多个Bean模式任务Handler，可以直接配置实用，如下：</p>
<ul>
<li><p>demoJobHandler：简单示例任务，任务内部模拟耗时任务逻辑，用户可在线体验Rolling Log等功能；</p>
</li>
<li><p>shardingJobHandler：分片示例任务，任务内部模拟处理分片参数，可参考熟悉分片任务；</p>
</li>
<li><p>httpJobHandler：通用HTTP任务Handler；业务方只需要提供HTTP链接等信息即可，不限制语言、平台。示例任务入参如下：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">url: <span class="hljs-keyword">http</span>://www.xxx.com  method: <span class="hljs-built_in">get</span> 或 <span class="hljs-built_in">post</span>  data: <span class="hljs-built_in">post</span>-data<br></code></pre></td></tr></table></figure>
</li>
<li><p>commandJobHandler：通用命令行任务Handler；业务方只需要提供命令行即可；如 “pwd”命令；</p>
</li>
</ul>
<h3 id="3-3-GLUE模式-Java"><a href="#3-3-GLUE模式-Java" class="headerlink" title="3.3 GLUE模式(Java)"></a>3.3 GLUE模式(Java)</h3><p>任务以源码方式维护在调度中心，支持通过Web IDE在线更新，实时编译和生效，因此不需要指定JobHandler。开发流程如下：</p>
<h4 id="步骤一：调度中心，新建调度任务："><a href="#步骤一：调度中心，新建调度任务：" class="headerlink" title="步骤一：调度中心，新建调度任务："></a>步骤一：调度中心，新建调度任务：</h4><p>参考上文“配置属性详细说明”对新建的任务进行参数配置，运行模式选中 “GLUE模式(Java)”；</p>
<p><img src="/XXL-JOB/image-20221130135153730.png" srcset="/img/loading.gif" lazyload alt="image-20221130135153730"></p>
<h4 id="步骤二：开发任务代码："><a href="#步骤二：开发任务代码：" class="headerlink" title="步骤二：开发任务代码："></a>步骤二：开发任务代码：</h4><p>选中指定任务，点击该任务右侧“GLUE”按钮，将会前往GLUE任务的Web IDE界面，在该界面支持对任务代码进行开发（也可以在IDE中开发完成后，复制粘贴到编辑中）。</p>
<p>版本回溯功能（支持30个版本的版本回溯）：在GLUE任务的Web IDE界面，选择右上角下拉框“版本回溯”，会列出该GLUE的更新历史，选择相应版本即可显示该版本代码，保存后GLUE代码即回退到对应的历史版本</p>
<p><img src="/XXL-JOB/image-20221130135210550.png" srcset="/img/loading.gif" lazyload alt="image-20221130135210550"></p>
<h3 id="3-4-GLUE模式-Shell"><a href="#3-4-GLUE模式-Shell" class="headerlink" title="3.4 GLUE模式(Shell)"></a>3.4 GLUE模式(Shell)</h3><h4 id="步骤一：调度中心，新建调度任务"><a href="#步骤一：调度中心，新建调度任务" class="headerlink" title="步骤一：调度中心，新建调度任务"></a>步骤一：调度中心，新建调度任务</h4><p>参考上文“配置属性详细说明”对新建的任务进行参数配置，运行模式选中 “GLUE模式(Shell)”；</p>
<h4 id="步骤二：开发任务代码：-1"><a href="#步骤二：开发任务代码：-1" class="headerlink" title="步骤二：开发任务代码："></a>步骤二：开发任务代码：</h4><p>选中指定任务，点击该任务右侧“GLUE”按钮，将会前往GLUE任务的Web IDE界面，在该界面支持对任务代码进行开发（也可以在IDE中开发完成后，复制粘贴到编辑中）。</p>
<p>该模式的任务实际上是一段 “shell” 脚本；</p>
<p><img src="/XXL-JOB/image-20221130135226920.png" srcset="/img/loading.gif" lazyload alt="image-20221130135226920"></p>
<h3 id="3-4-GLUE模式-Python"><a href="#3-4-GLUE模式-Python" class="headerlink" title="3.4 GLUE模式(Python)"></a>3.4 GLUE模式(Python)</h3><h4 id="步骤一：调度中心，新建调度任务-1"><a href="#步骤一：调度中心，新建调度任务-1" class="headerlink" title="步骤一：调度中心，新建调度任务"></a>步骤一：调度中心，新建调度任务</h4><p>参考上文“配置属性详细说明”对新建的任务进行参数配置，运行模式选中 “GLUE模式(Python)”；</p>
<h4 id="步骤二：开发任务代码：-2"><a href="#步骤二：开发任务代码：-2" class="headerlink" title="步骤二：开发任务代码："></a>步骤二：开发任务代码：</h4><p>选中指定任务，点击该任务右侧“GLUE”按钮，将会前往GLUE任务的Web IDE界面，在该界面支持对任务代码进行开发（也可以在IDE中开发完成后，复制粘贴到编辑中）。</p>
<p>该模式的任务实际上是一段 “python” 脚本；</p>
<p><img src="/XXL-JOB/image-20221130135243634.png" srcset="/img/loading.gif" lazyload alt="image-20221130135243634"></p>
<h3 id="3-5-GLUE模式-NodeJS"><a href="#3-5-GLUE模式-NodeJS" class="headerlink" title="3.5 GLUE模式(NodeJS)"></a>3.5 GLUE模式(NodeJS)</h3><h4 id="步骤一：调度中心，新建调度任务-2"><a href="#步骤一：调度中心，新建调度任务-2" class="headerlink" title="步骤一：调度中心，新建调度任务"></a>步骤一：调度中心，新建调度任务</h4><p>参考上文“配置属性详细说明”对新建的任务进行参数配置，运行模式选中 “GLUE模式(NodeJS)”；</p>
<h4 id="步骤二：开发任务代码：-3"><a href="#步骤二：开发任务代码：-3" class="headerlink" title="步骤二：开发任务代码："></a>步骤二：开发任务代码：</h4><p>选中指定任务，点击该任务右侧“GLUE”按钮，将会前往GLUE任务的Web IDE界面，在该界面支持对任务代码进行开发（也可以在IDE中开发完成后，复制粘贴到编辑中）。</p>
<p>该模式的任务实际上是一段 “nodeJS” 脚本；</p>
<h3 id="3-6-GLUE模式-PHP"><a href="#3-6-GLUE模式-PHP" class="headerlink" title="3.6 GLUE模式(PHP)"></a>3.6 GLUE模式(PHP)</h3><p>同上</p>
<h3 id="3-7-GLUE模式-PowerShell"><a href="#3-7-GLUE模式-PowerShell" class="headerlink" title="3.7 GLUE模式(PowerShell)"></a>3.7 GLUE模式(PowerShell)</h3><p>同上</p>
<h2 id="四、操作指南"><a href="#四、操作指南" class="headerlink" title="四、操作指南"></a>四、操作指南</h2><h3 id="4-1-配置执行器"><a href="#4-1-配置执行器" class="headerlink" title="4.1 配置执行器"></a>4.1 配置执行器</h3><p>点击进入”执行器管理”界面, 如下图:</p>
<p><img src="/XXL-JOB/image-20221130135353613.png" srcset="/img/loading.gif" lazyload alt="image-20221130135353613"></p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-number">1</span>、<span class="hljs-string">&quot;调度中心OnLine:&quot;</span>右侧显示在线的<span class="hljs-string">&quot;调度中心&quot;</span>列表, 任务执行结束后, 将会以failover的模式进行回调调度中心通知执行结果, 避免回调的单点风险;<br><span class="hljs-number">2</span>、<span class="hljs-string">&quot;执行器列表&quot;</span> 中显示在线的执行器列表, 可通过<span class="hljs-string">&quot;OnLine 机器&quot;</span>查看对应执行器的集群机器。<br></code></pre></td></tr></table></figure>

<p>点击按钮 “+新增执行器” 弹框如下图, 可新增执行器配置:</p>
<p><img src="/XXL-JOB/image-20221130135422797.png" srcset="/img/loading.gif" lazyload alt="image-20221130135422797"></p>
<p>执行器属性说明</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">AppName: 是每个执行器集群的唯一标示AppName, 执行器会周期性以AppName为对象进行自动注册。可通过该配置自动发现注册成功的执行器, 供任务调度时使用;</span><br><span class="hljs-section">名称: 执行器的名称, 因为AppName限制字母数字等组成,可读性不强, 名称为了提高执行器的可读性;</span><br><span class="hljs-section">排序: 执行器的排序, 系统中需要执行器的地方,如任务新增, 将会按照该排序读取可用的执行器列表;</span><br>注册方式：调度中心获取执行器地址的方式；<br>	自动注册：执行器自动进行执行器注册，调度中心通过底层注册表可以动态发现执行器机器地址；<br>    手动录入：人工手动录入执行器的地址信息，多地址逗号分隔，供调度中心使用；<br>机器地址：<span class="hljs-string">&quot;注册方式&quot;</span>为<span class="hljs-string">&quot;手动录入&quot;</span>时有效，支持人工维护执行器的地址信息；<br></code></pre></td></tr></table></figure>

<h3 id="4-2-新建任务"><a href="#4-2-新建任务" class="headerlink" title="4.2 新建任务"></a>4.2 新建任务</h3><p>进入任务管理界面，点击“新增任务”按钮，在弹出的“新增任务”界面配置任务属性后保存即可。详情页参考章节 “三、任务详解”。</p>
<h3 id="4-3-编辑任务"><a href="#4-3-编辑任务" class="headerlink" title="4.3 编辑任务"></a>4.3 编辑任务</h3><p>进入任务管理界面，选中指定任务。点击该任务右侧“编辑”按钮，在弹出的“编辑任务”界面更新任务属性后保存即可，可以修改设置的任务属性信息：</p>
<h3 id="4-4-编辑GLUE代码"><a href="#4-4-编辑GLUE代码" class="headerlink" title="4.4 编辑GLUE代码"></a>4.4 编辑GLUE代码</h3><p>该操作仅针对GLUE任务。</p>
<p>选中指定任务，点击该任务右侧“GLUE”按钮，将会前往GLUE任务的Web IDE界面，在该界面支持对任务代码进行开发。可参考章节 “3.3 GLUE模式(Java)”。</p>
<h3 id="4-5-启动-x2F-停止任务"><a href="#4-5-启动-x2F-停止任务" class="headerlink" title="4.5 启动&#x2F;停止任务"></a>4.5 启动&#x2F;停止任务</h3><p>可对任务进行“启动”和“停止”操作。<br>需要注意的是，此处的启动&#x2F;停止仅针对任务的后续调度触发行为，不会影响到已经触发的调度任务，如需终止已经触发的调度任务，可查看“4.9 终止运行中的任务”</p>
<p><img src="/XXL-JOB/image-20221130135815134.png" srcset="/img/loading.gif" lazyload alt="image-20221130135815134"></p>
<h3 id="4-6-手动触发一次调度"><a href="#4-6-手动触发一次调度" class="headerlink" title="4.6 手动触发一次调度"></a>4.6 手动触发一次调度</h3><p>点击“执行”按钮，可手动触发一次任务调度，不影响原有调度规则。</p>
<p><img src="/XXL-JOB/image-20221130135838852.png" srcset="/img/loading.gif" lazyload alt="image-20221130135838852"></p>
<h3 id="4-7-查看调度日志"><a href="#4-7-查看调度日志" class="headerlink" title="4.7 查看调度日志"></a>4.7 查看调度日志</h3><p>点击“日志”按钮，可以查看任务历史调度日志。在历史调入日志界面可查看每次任务调度的调度结果、执行结果等，点击“执行日志”按钮可查看执行器完整日志。</p>
<p><img src="/XXL-JOB/image-20221130135852061.png" srcset="/img/loading.gif" lazyload alt="image-20221130135852061"></p>
<p><img src="/XXL-JOB/image-20221130135909121.png" srcset="/img/loading.gif" lazyload alt="image-20221130135909121"></p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs 1c">调度时间：<span class="hljs-string">&quot;调度中心&quot;</span>触发本次调度并向<span class="hljs-string">&quot;执行器&quot;</span>发送任务执行信号的时间；<br>调度结果：<span class="hljs-string">&quot;调度中心&quot;</span>触发本次调度的结果，<span class="hljs-number">200</span>表示成功，<span class="hljs-number">500</span>或其他表示失败；<br>调度备注：<span class="hljs-string">&quot;调度中心&quot;</span>触发本次调度的日志信息；<br>执行器地址：本次任务执行的机器地址<br>运行模式：触发调度时任务的运行模式，运行模式可参考章节 <span class="hljs-string">&quot;三、任务详解&quot;</span>；<br>任务参数：本地任务执行的入参<br>执行时间：<span class="hljs-string">&quot;执行器&quot;</span>中本次任务执行结束后回调的时间；<br>执行结果：<span class="hljs-string">&quot;执行器&quot;</span>中本次任务执行的结果，<span class="hljs-number">200</span>表示成功，<span class="hljs-number">500</span>或其他表示失败；<br>执行备注：<span class="hljs-string">&quot;执行器&quot;</span>中本次任务执行的日志信息；<br>操作：<br>    <span class="hljs-string">&quot;执行日志&quot;</span>按钮：点击可查看本地任务执行的详细日志信息；详见“<span class="hljs-number">4.8</span> 查看执行日志”；<br>    <span class="hljs-string">&quot;终止任务&quot;</span>按钮：点击可终止本地调度对应执行器上本任务的执行线程，包括未执行的阻塞任务一并被终止；<br></code></pre></td></tr></table></figure>

<h3 id="4-8-查看执行日志"><a href="#4-8-查看执行日志" class="headerlink" title="4.8 查看执行日志"></a>4.8 查看执行日志</h3><p>点击执行日志右侧的 “执行日志” 按钮，可跳转至执行日志界面，可以查看业务代码中打印的完整日志，如下图；</p>
<p><img src="/XXL-JOB/image-20221130140003583.png" srcset="/img/loading.gif" lazyload alt="image-20221130140003583"></p>
<h3 id="4-9-终止运行中的任务"><a href="#4-9-终止运行中的任务" class="headerlink" title="4.9 终止运行中的任务"></a>4.9 终止运行中的任务</h3><p>仅针对执行中的任务。<br>在任务日志界面，点击右侧的“终止任务”按钮，将会向本次任务对应的执行器发送任务终止请求，将会终止掉本次任务，同时会清空掉整个任务执行队列。</p>
<p><img src="/XXL-JOB/image-20221130140114835.png" srcset="/img/loading.gif" lazyload alt="image-20221130140114835"></p>
<p>任务终止时通过 “interrupt” 执行线程的方式实现, 将会触发 “InterruptedException” 异常。因此如果JobHandler内部catch到了该异常并消化掉的话, 任务终止功能将不可用。</p>
<p>因此, 如果遇到上述任务终止不可用的情况, 需要在JobHandler中应该针对 “InterruptedException” 异常进行特殊处理 (向上抛出) , 正确逻辑如下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">try</span>&#123;    <br>	<span class="hljs-comment">// do something</span><br>&#125; <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> e) &#123;    <br>	<span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> InterruptedException) &#123;<br>    	<span class="hljs-keyword">throw</span> e;<br>    &#125;    <br>    logger.<span class="hljs-title function_ invoke__">warn</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, e);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>而且，在JobHandler中开启子线程时，子线程也不可catch处理”InterruptedException”，应该主动向上抛出。</p>
<p>任务终止时会执行对应JobHandler的”destroy()”方法，可以借助该方法处理一些资源回收的逻辑。</p>
<h3 id="4-10-删除执行日志"><a href="#4-10-删除执行日志" class="headerlink" title="4.10 删除执行日志"></a>4.10 删除执行日志</h3><p>在任务日志界面，选中执行器和任务之后，点击右侧的”删除”按钮将会出现”日志清理”弹框，弹框中支持选择不同类型的日志清理策略，选中后点击”确定”按钮即可进行日志清理操作；</p>
<p><img src="/XXL-JOB/image-20221130140216563.png" srcset="/img/loading.gif" lazyload alt="image-20221130140216563"></p>
<p><img src="/XXL-JOB/image-20221130140227816.png" srcset="/img/loading.gif" lazyload alt="image-20221130140227816"></p>
<h3 id="4-11-删除任务"><a href="#4-11-删除任务" class="headerlink" title="4.11 删除任务"></a>4.11 删除任务</h3><p>点击删除按钮，可以删除对应任务。</p>
<p><img src="/XXL-JOB/image-20221130140239533.png" srcset="/img/loading.gif" lazyload alt="image-20221130140239533"></p>
<h3 id="4-12-用户管理"><a href="#4-12-用户管理" class="headerlink" title="4.12 用户管理"></a>4.12 用户管理</h3><p>进入 “用户管理” 界面，可查看和管理用户信息；</p>
<p>目前用户分为两种角色：</p>
<ul>
<li>管理员：拥有全量权限，支持在线管理用户信息，为用户分配权限，权限分配粒度为执行器；</li>
<li>普通用户：仅拥有被分配权限的执行器，及相关任务的操作权限；</li>
</ul>
<p><img src="/XXL-JOB/image-20221130140252659.png" srcset="/img/loading.gif" lazyload alt="image-20221130140252659"></p>
<p><img src="/XXL-JOB/image-20221130140304820.png" srcset="/img/loading.gif" lazyload alt="image-20221130140304820"></p>
<h2 id="五、总体设计"><a href="#五、总体设计" class="headerlink" title="五、总体设计"></a>五、总体设计</h2><h3 id="5-1-源码目录介绍"><a href="#5-1-源码目录介绍" class="headerlink" title="5.1 源码目录介绍"></a>5.1 源码目录介绍</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-bullet">- </span>/doc :文档资料<br><span class="hljs-bullet">- </span>/db :“调度数据库”建表脚本<br><span class="hljs-bullet">- </span>/xxl-job-admin :调度中心，项目源码<br><span class="hljs-bullet">- </span>/xxl-job-core :公共Jar依赖<br><span class="hljs-bullet">- </span>/xxl-job-executor-samples :执行器，Sample示例项目（大家可以在该项目上进行开发，也可以将现有项目改造生成执行器项目）<br></code></pre></td></tr></table></figure>

<h3 id="5-2-“调度数据库”配置"><a href="#5-2-“调度数据库”配置" class="headerlink" title="5.2 “调度数据库”配置"></a>5.2 “调度数据库”配置</h3><p>XXL-JOB调度模块基于自研调度组件并支持集群部署，调度数据库表说明如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">- xxl_job_lock：任务调度锁表；</span><br><span class="hljs-deletion">- xxl_job_group：执行器信息表，维护任务执行器信息；</span><br><span class="hljs-deletion">- xxl_job_info：调度扩展信息表： 用于保存XXL-JOB调度任务的扩展信息，如任务分组、任务名、机器地址、执行器、执行入参和报警邮件等等；</span><br><span class="hljs-deletion">- xxl_job_log：调度日志表： 用于保存XXL-JOB任务调度的历史信息，如调度结果、执行结果、调度入参、调度机器和执行器等等；</span><br><span class="hljs-deletion">- xxl_job_log_report：调度日志报表：用户存储XXL-JOB任务调度日志的报表，调度中心报表功能页面会用到；</span><br><span class="hljs-deletion">- xxl_job_logglue：任务GLUE日志：用于保存GLUE更新历史，用于支持GLUE的版本回溯功能；</span><br><span class="hljs-deletion">- xxl_job_registry：执行器注册表，维护在线的执行器和调度中心机器地址信息；</span><br><span class="hljs-deletion">- xxl_job_user：系统用户表；</span><br></code></pre></td></tr></table></figure>

<h3 id="5-3-架构设计"><a href="#5-3-架构设计" class="headerlink" title="5.3 架构设计"></a>5.3 架构设计</h3><h4 id="5-3-1-设计思想"><a href="#5-3-1-设计思想" class="headerlink" title="5.3.1 设计思想"></a>5.3.1 设计思想</h4><p>将调度行为抽象形成“调度中心”公共平台，而平台自身并不承担业务逻辑，“调度中心”负责发起调度请求。</p>
<p>将任务抽象成分散的JobHandler，交由“执行器”统一管理，“执行器”负责接收调度请求并执行对应的JobHandler中业务逻辑。</p>
<p>因此，“调度”和“任务”两部分可以相互解耦，提高系统整体稳定性和扩展性；</p>
<h4 id="5-3-2-系统组成"><a href="#5-3-2-系统组成" class="headerlink" title="5.3.2 系统组成"></a>5.3.2 系统组成</h4><ul>
<li><strong>调度模块（调度中心）</strong>：<br>负责管理调度信息，按照调度配置发出调度请求，自身不承担业务代码。调度系统与任务解耦，提高了系统可用性和稳定性，同时调度系统性能不再受限于任务模块；<br>支持可视化、简单且动态的管理调度信息，包括任务新建，更新，删除，GLUE开发和任务报警等，所有上述操作都会实时生效，同时支持监控调度结果以及执行日志，支持执行器Failover。</li>
<li><strong>执行模块（执行器）</strong>：<br>负责接收调度请求并执行任务逻辑。任务模块专注于任务的执行等操作，开发和维护更加简单和高效；<br>接收“调度中心”的执行请求、终止请求和日志请求等。</li>
</ul>
<h4 id="5-3-3-架构图"><a href="#5-3-3-架构图" class="headerlink" title="5.3.3 架构图"></a>5.3.3 架构图</h4><p><img src="/XXL-JOB/image-20221130140454104.png" srcset="/img/loading.gif" lazyload alt="XXL-JOB架构图 v2.1.0"></p>
<h3 id="5-4-调度模块剖析"><a href="#5-4-调度模块剖析" class="headerlink" title="5.4 调度模块剖析"></a>5.4 调度模块剖析</h3><h4 id="5-4-1-quartz的不足"><a href="#5-4-1-quartz的不足" class="headerlink" title="5.4.1 quartz的不足"></a>5.4.1 quartz的不足</h4><p>Quartz作为开源作业调度中的佼佼者，是作业调度的首选。但是集群环境中Quartz采用API的方式对任务进行管理，从而可以避免上述问题，但是同样存在以下问题：</p>
<ul>
<li>问题一：调用API的的方式操作任务，不人性化；</li>
<li>问题二：需要持久化业务QuartzJobBean到底层数据表中，系统侵入性相当严重。</li>
<li>问题三：调度逻辑和QuartzJobBean耦合在同一个项目中，这将导致一个问题，在调度任务数量逐渐增多，同时调度任务逻辑逐渐加重的情况下，此时调度系统的性能将大大受限于业务；</li>
<li>问题四：quartz底层以“抢占式”获取DB锁并由抢占成功节点负责运行任务，会导致节点负载悬殊非常大；而XXL-JOB通过执行器实现“协同分配式”运行任务，充分发挥集群优势，负载各节点均衡。</li>
</ul>
<p>XXL-JOB弥补了quartz的上述不足之处。</p>
<h4 id="5-4-2-自研调度模块"><a href="#5-4-2-自研调度模块" class="headerlink" title="5.4.2 自研调度模块"></a>5.4.2 自研调度模块</h4><p>XXL-JOB最终选择自研调度组件（早期调度组件基于Quartz）；一方面是为了精简系统降低冗余依赖，另一方面是为了提供系统的可控度与稳定性；</p>
<p>XXL-JOB中“调度模块”和“任务模块”完全解耦，调度模块进行任务调度时，将会解析不同的任务参数发起远程调用，调用各自的远程执行器服务。这种调用模型类似RPC调用，调度中心提供调用代理的功能，而执行器提供远程服务的功能。</p>
<h4 id="5-4-3-调度中心HA（集群）"><a href="#5-4-3-调度中心HA（集群）" class="headerlink" title="5.4.3 调度中心HA（集群）"></a>5.4.3 调度中心HA（集群）</h4><p>基于数据库的集群方案，数据库选用Mysql；集群分布式并发环境中进行定时任务调度时，会在各个节点会上报任务，存到数据库中，执行时会从数据库中取出触发器来执行，如果触发器的名称和执行时间相同，则只有一个节点去执行此任务。</p>
<h4 id="5-4-4-调度线程池"><a href="#5-4-4-调度线程池" class="headerlink" title="5.4.4 调度线程池"></a>5.4.4 调度线程池</h4><p>调度采用线程池方式实现，避免单线程因阻塞而引起任务调度延迟。</p>
<h4 id="5-4-5-并行调度"><a href="#5-4-5-并行调度" class="headerlink" title="5.4.5 并行调度"></a>5.4.5 并行调度</h4><p>XXL-JOB调度模块默认采用并行机制，在多线程调度的情况下，调度模块被阻塞的几率很低，大大提高了调度系统的承载量。</p>
<p>XXL-JOB的不同任务之间并行调度、并行执行。<br>XXL-JOB的单个任务，针对多个执行器是并行运行的，针对单个执行器是串行执行的。同时支持任务终止。</p>
<h4 id="5-4-6-过期处理策略"><a href="#5-4-6-过期处理策略" class="headerlink" title="5.4.6 过期处理策略"></a>5.4.6 过期处理策略</h4><p>任务调度错过触发时间时的处理策略：</p>
<ul>
<li>可能原因：服务重启；调度线程被阻塞，线程被耗尽；上次调度持续阻塞，下次调度被错过；</li>
<li>处理策略：<ul>
<li>过期超5s：本次忽略，当前时间开始计算下次触发时间</li>
<li>过期5s内：立即触发一次，当前时间开始计算下次触发时间</li>
</ul>
</li>
</ul>
<h4 id="5-4-7-日志回调服务"><a href="#5-4-7-日志回调服务" class="headerlink" title="5.4.7 日志回调服务"></a>5.4.7 日志回调服务</h4><p>调度模块的“调度中心”作为Web服务部署时，一方面承担调度中心功能，另一方面也为执行器提供API服务。</p>
<p>调度中心提供的”日志回调服务API服务”代码位置如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">xxl-job-admin<span class="hljs-selector-id">#com</span><span class="hljs-selector-class">.xxl</span><span class="hljs-selector-class">.job</span><span class="hljs-selector-class">.admin</span><span class="hljs-selector-class">.controller</span><span class="hljs-selector-class">.JobApiController</span>.callback<br></code></pre></td></tr></table></figure>

<p>“执行器”在接收到任务执行请求后，执行任务，在执行结束之后会将执行结果回调通知“调度中心”：</p>
<h4 id="5-4-8-任务HA（Failover）"><a href="#5-4-8-任务HA（Failover）" class="headerlink" title="5.4.8 任务HA（Failover）"></a>5.4.8 任务HA（Failover）</h4><p>执行器如若集群部署，调度中心将会感知到在线的所有执行器，如“127.0.0.1:9997, 127.0.0.1:9998, 127.0.0.1:9999”。</p>
<p>当任务”路由策略”选择”故障转移(FAILOVER)”时，当调度中心每次发起调度请求时，会按照顺序对执行器发出心跳检测请求，第一个检测为存活状态的执行器将会被选定并发送调度请求。</p>
<p>调度成功后，可在日志监控界面查看“调度备注”，如下；</p>
<p><img src="/XXL-JOB/img_jrdI.png" srcset="/img/loading.gif" lazyload alt="输入图片说明"></p>
<p>调度备注”可以看出本地调度运行轨迹，执行器的”注册方式”、”地址列表”和任务的”路由策略”。”故障转移(FAILOVER)”路由策略下，调度中心首先对第一个地址进行心跳检测，心跳失败因此自动跳过，第二个依然心跳检测失败……<br>直至心跳检测第三个地址“127.0.0.1:9999”成功，选定为“目标执行器”；然后对“目标执行器”发送调度请求，调度流程结束，等待执行器回调执行结果。</p>
<h4 id="5-4-9-调度日志"><a href="#5-4-9-调度日志" class="headerlink" title="5.4.9 调度日志"></a>5.4.9 调度日志</h4><p>调度中心每次进行任务调度，都会记录一条任务日志，任务日志主要包括以下三部分内容：</p>
<ul>
<li>任务信息：包括“执行器地址”、“JobHandler”和“执行参数”等属性，点击任务ID按钮可查看，根据这些参数，可以精确的定位任务执行的具体机器和任务代码；</li>
<li>调度信息：包括“调度时间”、“调度结果”和“调度日志”等，根据这些参数，可以了解“调度中心”发起调度请求时具体情况。</li>
<li>执行信息：包括“执行时间”、“执行结果”和“执行日志”等，根据这些参数，可以了解在“执行器”端任务执行的具体情况；</li>
</ul>
<p>调度日志，针对单次调度，属性说明如下：</p>
<ul>
<li>执行器地址：任务执行的机器地址；</li>
<li>JobHandler：Bean模式表示任务执行的JobHandler名称；</li>
<li>任务参数：任务执行的入参；</li>
<li>调度时间：调度中心，发起调度的时间；</li>
<li>调度结果：调度中心，发起调度的结果，SUCCESS或FAIL；</li>
<li>调度备注：调度中心，发起调度的备注信息，如地址心跳检测日志等；</li>
<li>执行时间：执行器，任务执行结束后回调的时间；</li>
<li>执行结果：执行器，任务执行的结果，SUCCESS或FAIL；</li>
<li>执行备注：执行器，任务执行的备注信息，如异常日志等；</li>
<li>执行日志：任务执行过程中，业务代码中打印的完整执行日志，见“4.8 查看执行日志”；</li>
</ul>
<h4 id="5-4-10-任务依赖"><a href="#5-4-10-任务依赖" class="headerlink" title="5.4.10 任务依赖"></a>5.4.10 任务依赖</h4><p>原理：XXL-JOB中每个任务都对应有一个任务ID，同时，每个任务支持设置属性“子任务ID”，因此，通过“任务ID”可以匹配任务依赖关系。</p>
<p>当父任务执行结束并且执行成功时，将会根据“子任务ID”匹配子任务依赖，如果匹配到子任务，将会主动触发一次子任务的执行。</p>
<p>在任务日志界面，点击任务的“执行备注”的“查看”按钮，可以看到匹配子任务以及触发子任务执行的日志信息，如无信息则表示未触发子任务执行，可参考下图。</p>
<p><img src="/XXL-JOB/image-20221130140720853.png" srcset="/img/loading.gif" lazyload alt="image-20221130140720853"></p>
<p><img src="/XXL-JOB/image-20221130140730088.png" srcset="/img/loading.gif" lazyload alt="image-20221130140730088"></p>
<h4 id="5-4-11-全异步化-amp-轻量级"><a href="#5-4-11-全异步化-amp-轻量级" class="headerlink" title="5.4.11 全异步化 &amp; 轻量级"></a>5.4.11 全异步化 &amp; 轻量级</h4><ul>
<li>全异步化设计：XXL-JOB系统中业务逻辑在远程执行器执行，触发流程全异步化设计。相比直接在调度中心内部执行业务逻辑，极大的降低了调度线程占用时间；<ul>
<li>异步调度：调度中心每次任务触发时仅发送一次调度请求，该调度请求首先推送“异步调度队列”，然后异步推送给远程执行器</li>
<li>异步执行：执行器会将请求存入“异步执行队列”并且立即响应调度中心，异步运行。</li>
</ul>
</li>
<li>轻量级设计：XXL-JOB调度中心中每个JOB逻辑非常 “轻”，在全异步化的基础上，单个JOB一次运行平均耗时基本在 “10ms” 之内（基本为一次请求的网络开销）；因此，可以保证使用有限的线程支撑大量的JOB并发运行；</li>
</ul>
<p>得益于上述两点优化，理论上默认配置下的调度中心，单机能够支撑 5000 任务并发运行稳定运行；</p>
<p>实际场景中，由于调度中心与执行器网络ping延迟不同、DB读写耗时不同、任务调度密集程度不同，会导致任务量上限会上下波动。</p>
<p>如若需要支撑更多的任务量，可以通过 “调大调度线程数” 、”降低调度中心与执行器ping延迟” 和 “提升机器配置” 几种方式优化。</p>
<h4 id="5-4-12-均衡调度"><a href="#5-4-12-均衡调度" class="headerlink" title="5.4.12 均衡调度"></a>5.4.12 均衡调度</h4><p>调度中心在集群部署时会自动进行任务平均分配，触发组件每次获取与线程池数量（调度中心支持自定义调度线程池大小）相关数量的任务，避免大量任务集中在单个调度中心集群节点；</p>
<h3 id="5-5-任务-“运行模式”-剖析"><a href="#5-5-任务-“运行模式”-剖析" class="headerlink" title="5.5 任务 “运行模式” 剖析"></a>5.5 任务 “运行模式” 剖析</h3><h4 id="5-5-1-“Bean模式”-任务"><a href="#5-5-1-“Bean模式”-任务" class="headerlink" title="5.5.1 “Bean模式” 任务"></a>5.5.1 “Bean模式” 任务</h4><p>开发步骤：可参考 “章节三” ；<br>原理：每个Bean模式任务都是一个Spring的Bean类实例，它被维护在“执行器”项目的Spring容器中。任务类需要加“<a target="_blank" rel="noopener" href="https://github.com/JobHandler">@JobHandler</a>(value&#x3D;”名称”)”注解，因为“执行器”会根据该注解识别Spring容器中的任务。任务类需要继承统一接口“IJobHandler”，任务逻辑在execute方法中开发，因为“执行器”在接收到调度中心的调度请求时，将会调用“IJobHandler”的execute方法，执行任务逻辑。</p>
<h4 id="5-5-2-“GLUE模式-Java-”-任务"><a href="#5-5-2-“GLUE模式-Java-”-任务" class="headerlink" title="5.5.2 “GLUE模式(Java)” 任务"></a>5.5.2 “GLUE模式(Java)” 任务</h4><p>开发步骤：可参考 “章节三” ；<br>原理：每个 “GLUE模式(Java)” 任务的代码，实际上是“一个继承自“IJobHandler”的实现类的类代码”，“执行器”接收到“调度中心”的调度请求时，会通过Groovy类加载器加载此代码，实例化成Java对象，同时注入此代码中声明的Spring服务（请确保Glue代码中的服务和类引用在“执行器”项目中存在），然后调用该对象的execute方法，执行任务逻辑。</p>
<h4 id="5-5-3-GLUE模式-Shell-GLUE模式-Python-GLUE模式-PHP-GLUE模式-NodeJS-GLUE模式-Powershell"><a href="#5-5-3-GLUE模式-Shell-GLUE模式-Python-GLUE模式-PHP-GLUE模式-NodeJS-GLUE模式-Powershell" class="headerlink" title="5.5.3 GLUE模式(Shell) + GLUE模式(Python) + GLUE模式(PHP) + GLUE模式(NodeJS) + GLUE模式(Powershell)"></a>5.5.3 GLUE模式(Shell) + GLUE模式(Python) + GLUE模式(PHP) + GLUE模式(NodeJS) + GLUE模式(Powershell)</h4><p>开发步骤：可参考 “章节三” ；<br>原理：脚本任务的源码托管在调度中心，脚本逻辑在执行器运行。当触发脚本任务时，执行器会加载脚本源码在执行器机器上生成一份脚本文件，然后通过Java代码调用该脚本；并且实时将脚本输出日志写到任务日志文件中，从而在调度中心可以实时监控脚本运行情况；</p>
<p>目前支持的脚本类型如下：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim">- <span class="hljs-keyword">shell</span>脚本：任务运行模式选择为 <span class="hljs-string">&quot;GLUE模式(Shell)&quot;</span>时支持 <span class="hljs-string">&quot;Shell&quot;</span> 脚本任务；<br>- <span class="hljs-keyword">python</span>脚本：任务运行模式选择为 <span class="hljs-string">&quot;GLUE模式(Python)&quot;</span>时支持 <span class="hljs-string">&quot;Python&quot;</span> 脚本任务；<br>- php脚本：任务运行模式选择为 <span class="hljs-string">&quot;GLUE模式(PHP)&quot;</span>时支持 <span class="hljs-string">&quot;PHP&quot;</span> 脚本任务；<br>- nodejs脚本：任务运行模式选择为 <span class="hljs-string">&quot;GLUE模式(NodeJS)&quot;</span>时支持 <span class="hljs-string">&quot;NodeJS&quot;</span> 脚本任务；<br>- powershell：任务运行模式选择为 <span class="hljs-string">&quot;GLUE模式(PowerShell)&quot;</span>时支持 <span class="hljs-string">&quot;PowerShell&quot;</span> 脚本任务；<br></code></pre></td></tr></table></figure>

<p>脚本任务通过 Exit Code 判断任务执行结果，状态码可参考章节 “5.15 任务执行结果说明”；</p>
<h4 id="5-5-4-执行器"><a href="#5-5-4-执行器" class="headerlink" title="5.5.4 执行器"></a>5.5.4 执行器</h4><p>执行器实际上是一个内嵌的Server，默认端口9999（配置项：xxl.job.executor.port）。</p>
<p>在项目启动时，执行器会通过“<a target="_blank" rel="noopener" href="https://github.com/JobHandler">@JobHandler</a>”识别Spring容器中“Bean模式任务”，以注解的value属性为key管理起来。</p>
<p>“执行器”接收到“调度中心”的调度请求时，如果任务类型为“Bean模式”，将会匹配Spring容器中的“Bean模式任务”，然后调用其execute方法，执行任务逻辑。如果任务类型为“GLUE模式”，将会加载GLue代码，实例化Java对象，注入依赖的Spring服务（注意：Glue代码中注入的Spring服务，必须存在与该“执行器”项目的Spring容器中），然后调用execute方法，执行任务逻辑。</p>
<h4 id="5-5-5-任务日志"><a href="#5-5-5-任务日志" class="headerlink" title="5.5.5 任务日志"></a>5.5.5 任务日志</h4><p>XXL-JOB会为每次调度请求生成一个单独的日志文件，需要通过 “XxlJobHelper.log” 打印执行日志，“调度中心”查看执行日志时将会加载对应的日志文件。</p>
<p>(历史版本通过重写LOG4J的Appender实现，存在依赖限制，该方式在新版本已经被抛弃)</p>
<p>日志文件存放的位置可在“执行器”配置文件进行自定义，默认目录格式为：&#x2F;data&#x2F;applogs&#x2F;xxl-job&#x2F;jobhandler&#x2F;“格式化日期”&#x2F;“数据库调度日志记录的主键ID.log”。</p>
<p>在JobHandler中开启子线程时，子线程将会把日志打印在父线程即JobHandler的执行日志中，方便日志追踪。</p>
<h3 id="5-6-通讯模块剖析"><a href="#5-6-通讯模块剖析" class="headerlink" title="5.6 通讯模块剖析"></a>5.6 通讯模块剖析</h3><h4 id="5-6-1-一次完整的任务调度通讯流程"><a href="#5-6-1-一次完整的任务调度通讯流程" class="headerlink" title="5.6.1 一次完整的任务调度通讯流程"></a>5.6.1 一次完整的任务调度通讯流程</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-bullet">- </span>1、“调度中心”向“执行器”发送http调度请求: “执行器”中接收请求的服务，实际上是一台内嵌Server，默认端口9999;<br><span class="hljs-bullet">- </span>2、“执行器”执行任务逻辑；<br><span class="hljs-bullet">- </span>3、“执行器”http回调“调度中心”调度结果: “调度中心”中接收回调的服务，是针对执行器开放一套API服务;<br></code></pre></td></tr></table></figure>

<h4 id="5-6-2-通讯数据加密"><a href="#5-6-2-通讯数据加密" class="headerlink" title="5.6.2 通讯数据加密"></a>5.6.2 通讯数据加密</h4><p>调度中心向执行器发送的调度请求时使用RequestModel和ResponseModel两个对象封装调度请求参数和响应数据, 在进行通讯之前底层会将上述两个对象对象序列化，并进行数据协议以及时间戳检验,从而达到数据加密的功能;</p>
<h3 id="5-7-任务注册-任务自动发现"><a href="#5-7-任务注册-任务自动发现" class="headerlink" title="5.7 任务注册, 任务自动发现"></a>5.7 任务注册, 任务自动发现</h3><p>自v1.5版本之后, 任务取消了”任务执行机器”属性, 改为通过任务注册和自动发现的方式, 动态获取远程执行器地址并执行。</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-symbol">AppName:</span> 每个执行器机器集群的唯一标示, 任务注册以 <span class="hljs-string">&quot;执行器&quot;</span> 为最小粒度进行注册<span class="hljs-comment">; 每个任务通过其绑定的执行器可感知对应的执行器机器列表;</span><br>注册表: 见<span class="hljs-string">&quot;xxl_job_registry&quot;</span>表, <span class="hljs-string">&quot;执行器&quot;</span> 在进行任务注册时将会周期性维护一条注册记录，即机器地址和AppName的绑定关系<span class="hljs-comment">;&quot;调度中心&quot; 从而可以动态感知每个AppName在线的机器列表;</span><br>执行器注册: 任务注册<span class="hljs-keyword">Beat周期默认30s; </span>执行器以一倍<span class="hljs-keyword">Beat进行执行器注册, </span>调度中心以一倍<span class="hljs-keyword">Beat进行动态任务发现; </span>注册信息的失效时间为三倍<span class="hljs-keyword">Beat; </span><br>执行器注册摘除：执行器销毁时，将会主动上报调度中心并摘除对应的执行器机器信息，提高心跳注册的实时性；<br></code></pre></td></tr></table></figure>

<p>为保证系统”轻量级”并且降低学习部署成本，没有采用Zookeeper作为注册中心，采用DB方式进行任务注册发现；</p>
<h3 id="5-8-任务执行结果"><a href="#5-8-任务执行结果" class="headerlink" title="5.8 任务执行结果"></a>5.8 任务执行结果</h3><p>自v1.6.2之后，任务执行结果通过 “IJobHandler” 的返回值 “ReturnT” 进行判断；<br>当返回值符合 “ReturnT.code &#x3D;&#x3D; ReturnT.SUCCESS_CODE” 时表示任务执行成功，否则表示任务执行失败，而且可以通过 “ReturnT.msg” 回调错误信息给调度中心；<br>从而，在任务逻辑中可以方便的控制任务执行结果；</p>
<h3 id="5-9-分片广播-amp-动态分片"><a href="#5-9-分片广播-amp-动态分片" class="headerlink" title="5.9 分片广播 &amp; 动态分片"></a>5.9 分片广播 &amp; 动态分片</h3><p>执行器集群部署时，任务路由策略选择”分片广播”情况下，一次任务调度将会广播触发对应集群中所有执行器执行一次任务，同时系统自动传递分片参数；可根据分片参数开发分片任务；</p>
<p>“分片广播” 以执行器为维度进行分片，支持动态扩容执行器集群从而动态增加分片数量，协同进行业务处理；在进行大数据量业务操作时可显著提升任务处理能力和速度。</p>
<p>“分片广播” 和普通任务开发流程一致，不同之处在于可以获取分片参数，获取分片参数进行分片业务处理。</p>
<ul>
<li><p>Java语言任务获取分片参数方式：BEAN、GLUE模式(Java)</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">// 可参考Sample示例执行器中的示例任务&quot;ShardingJobHandler&quot;了解试用 </span><br><span class="hljs-built_in">int</span> shardIndex = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">XxlJobHelper</span>.</span></span>get<span class="hljs-constructor">ShardIndex()</span>;<br><span class="hljs-built_in">int</span> shardTotal = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">XxlJobHelper</span>.</span></span>get<span class="hljs-constructor">ShardTotal()</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>脚本语言任务获取分片参数方式：GLUE模式(Shell)、GLUE模式(Python)、GLUE模式(Nodejs)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 脚本任务入参固定为三个，依次为：任务传参、分片序号、分片总数。以Shell模式任务为例，获取分片参数代码如下</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;分片序号 index = <span class="hljs-subst">$2</span>&quot;</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;分片总数 total = <span class="hljs-subst">$3</span>&quot;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<p>分片参数属性说明：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">index</span>：当前分片序号(从<span class="hljs-number">0</span>开始)，执行器集群列表中当前执行器的序号；<br><span class="hljs-attribute">total</span>：总分片数，执行器集群的总机器数量；<br></code></pre></td></tr></table></figure>

<p>该特性适用场景如：</p>
<p>1、分片任务场景：10个执行器的集群来处理10w条数据，每台机器只需要处理1w条数据，耗时降低10倍；</p>
<p>2、广播任务场景：广播执行器机器运行shell脚本、广播集群节点进行缓存更新等</p>
<h3 id="5-10-访问令牌（AccessToken）"><a href="#5-10-访问令牌（AccessToken）" class="headerlink" title="5.10 访问令牌（AccessToken）"></a>5.10 访问令牌（AccessToken）</h3><p>为提升系统安全性，调度中心和执行器进行安全性校验，双方AccessToken匹配才允许通讯；</p>
<p>调度中心和执行器，可通过配置项 “xxl.job.accessToken” 进行AccessToken的设置。</p>
<p>调度中心和执行器，如果需要正常通讯，只有两种设置；</p>
<ul>
<li>设置一：调度中心和执行器，均不设置AccessToken；关闭安全性校验；</li>
<li>设置二：调度中心和执行器，设置了相同的AccessToken；</li>
</ul>
<h3 id="5-11-故障转移-amp-失败重试"><a href="#5-11-故障转移-amp-失败重试" class="headerlink" title="5.11 故障转移 &amp; 失败重试"></a>5.11 故障转移 &amp; 失败重试</h3><p>一次完整任务流程包括”调度（调度中心） + 执行（执行器）”两个阶段。</p>
<ul>
<li>“故障转移”发生在调度阶段，在执行器集群部署时，如果某一台执行器发生故障，该策略支持自动进行Failover切换到一台正常的执行器机器并且完成调度请求流程。</li>
<li>“失败重试”发生在”调度 + 执行”两个阶段，支持通过自定义任务失败重试次数，当任务失败时将会按照预设的失败重试次数主动进行重试；</li>
</ul>
<h3 id="5-12-执行器灰度上线"><a href="#5-12-执行器灰度上线" class="headerlink" title="5.12 执行器灰度上线"></a>5.12 执行器灰度上线</h3><p>调度中心与业务解耦，只需部署一次后常年不需要维护。但是，执行器中托管运行着业务作业，作业上线和变更需要重启执行器，尤其是Bean模式任务。<br>执行器重启可能会中断运行中的任务。但是，XXL-JOB得益于自建执行器与自建注册中心，可以通过灰度上线的方式，避免因重启导致的任务中断的问题。</p>
<p>步骤如下：</p>
<p>1、执行器改为手动注册，下线一半机器列表（A组），线上运行另一半机器列表（B组）；</p>
<p>2、等待A组机器任务运行结束并编译上线；执行器注册地址替换为A组；</p>
<p>3、等待B组机器任务运行结束并编译上线；执行器注册地址替换为A组+B组；<br>操作结束；</p>
<h3 id="5-13-任务执行结果说明"><a href="#5-13-任务执行结果说明" class="headerlink" title="5.13 任务执行结果说明"></a>5.13 任务执行结果说明</h3><p>系统根据以下标准判断任务执行结果，可参考之。</p>
<table>
<thead>
<tr>
<th align="left">—</th>
<th align="left">Bean&#x2F;Glue(Java)</th>
<th align="left">Glue(Shell) 等脚本任务</th>
</tr>
</thead>
<tbody><tr>
<td align="left">成功</td>
<td align="left">IJobHandler.SUCCESS</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">失败</td>
<td align="left">IJobHandler.FAIL</td>
<td align="left">-1（非0状态码）</td>
</tr>
</tbody></table>
<h3 id="5-14-任务超时控制"><a href="#5-14-任务超时控制" class="headerlink" title="5.14 任务超时控制"></a>5.14 任务超时控制</h3><p>支持设置任务超时时间，任务运行超时的情况下，将会主动中断任务；</p>
<p>需要注意的是，任务超时中断时与任务终止机制（可查看“4.9 终止运行中的任务”）类似，也是通过 “interrupt” 中断任务，因此业务代码需要将 “InterruptedException” 外抛，否则功能不可用。</p>
<h3 id="5-15-跨语言"><a href="#5-15-跨语言" class="headerlink" title="5.15 跨语言"></a>5.15 跨语言</h3><p>XXL-JOB是一个跨语言的任务调度平台，主要体现在如下几个方面：</p>
<p>1、RESTful API：调度中心与执行器提供语言无关的 RESTful API 服务，第三方任意语言可据此对接调度中心或者实现执行器。（可参考章节 “调度中心&#x2F;执行器 RESTful API” ）</p>
<p>2、多任务模式：提供Java、Python、PHP……等十来种任务模式，可参考章节 “5.5 任务 “运行模式” ”；理论上可扩展任意语言任务模式；</p>
<p>2、提供基于HTTP的任务Handler（Bean任务，JobHandler&#x3D;”httpJobHandler”）；业务方只需要提供HTTP链接等相关信息即可，不限制语言、平台；（可参考章节 “原生内置Bean模式任务” ）</p>
<h3 id="5-16-任务失败告警"><a href="#5-16-任务失败告警" class="headerlink" title="5.16 任务失败告警"></a>5.16 任务失败告警</h3><p>默认提供邮件失败告警，可扩展短信、钉钉等方式。如果需要新增一种告警方式，只需要新增一个实现 “com.xxl.job.admin.core.alarm.JobAlarm” 接口的告警实现即可。可以参考默认提供邮箱告警实现 “EmailJobAlarm”。</p>
<h3 id="5-17-调度中心Docker镜像构建"><a href="#5-17-调度中心Docker镜像构建" class="headerlink" title="5.17 调度中心Docker镜像构建"></a>5.17 调度中心Docker镜像构建</h3><p>可以通过以下命令快速构建调度中心，并启动运行；</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sqf">mvn clean packagedocker <br>build -t xuxueli/xxl-job-<span class="hljs-built_in">admin</span> ./xxl-job-<span class="hljs-built_in">admin</span><br>docker run --<span class="hljs-built_in">name</span> xxl-job-<span class="hljs-built_in">admin</span> -p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> -d xuxueli/xxl-job-<span class="hljs-built_in">admin</span><br></code></pre></td></tr></table></figure>

<h3 id="5-20-避免任务重复执行"><a href="#5-20-避免任务重复执行" class="headerlink" title="5.20 避免任务重复执行"></a>5.20 避免任务重复执行</h3><p>调度密集或者耗时任务可能会导致任务阻塞，集群情况下调度组件小概率情况下会重复触发；<br>针对上述情况，可以通过结合 “单机路由策略（如：第一台、一致性哈希）” + “阻塞策略（如：单机串行、丢弃后续调度）” 来规避，最终避免任务重复执行。</p>
<h3 id="5-21-命令行任务"><a href="#5-21-命令行任务" class="headerlink" title="5.21 命令行任务"></a>5.21 命令行任务</h3><p>原生提供通用命令行任务Handler（Bean任务，”CommandJobHandler”）；业务方只需要提供命令行即可；<br>如任务参数 “pwd” 将会执行命令并输出数据；</p>
<h3 id="5-22-日志自动清理"><a href="#5-22-日志自动清理" class="headerlink" title="5.22 日志自动清理"></a>5.22 日志自动清理</h3><p>XXL-JOB日志主要包含如下两部分，均支持日志自动清理，说明如下：</p>
<ul>
<li>调度中心日志表数据：可借助配置项 “xxl.job.logretentiondays” 设置日志表数据保存天数，过期日志自动清理；详情可查看上文配置说明；</li>
<li>执行器日志文件数据：可借助配置项 “xxl.job.executor.logretentiondays” 设置日志文件数据保存天数，过期日志自动清理；详情可查看上文配置说明；</li>
</ul>
<h3 id="5-23-调度结果丢失处理"><a href="#5-23-调度结果丢失处理" class="headerlink" title="5.23 调度结果丢失处理"></a>5.23 调度结果丢失处理</h3><p>执行器因网络抖动回调失败或宕机等异常情况，会导致任务调度结果丢失。由于调度中心依赖执行器回调来感知调度结果，因此会导致调度日志永远处于 “运行中” 状态。</p>
<p>针对该问题，调度中心提供内置组件进行处理，逻辑为：调度记录停留在 “运行中” 状态超过10min，且对应执行器心跳注册失败不在线，则将本地调度主动标记失败；</p>
<h2 id="六、调度中心-x2F-执行器-RESTful-API"><a href="#六、调度中心-x2F-执行器-RESTful-API" class="headerlink" title="六、调度中心&#x2F;执行器 RESTful API"></a>六、调度中心&#x2F;执行器 RESTful API</h2><p>XXL-JOB 目标是一种跨平台、跨语言的任务调度规范和协议。</p>
<p>针对Java应用，可以直接通过官方提供的调度中心与执行器，方便快速的接入和使用调度中心，可以参考上文 “快速入门” 章节。</p>
<p>针对非Java应用，可借助 XXL-JOB 的标准 RESTful API 方便的实现多语言支持。</p>
<ul>
<li>调度中心 RESTful API：<ul>
<li>说明：调度中心提供给执行器使用的API；不局限于官方执行器使用，第三方可使用该API来实现执行器；</li>
<li>API列表：执行器注册、任务结果回调等；</li>
</ul>
</li>
<li>执行器 RESTful API ：<ul>
<li>说明：执行器提供给调度中心使用的API；官方执行器默认已实现，第三方执行器需要实现并对接提供给调度中心；</li>
<li>API列表：任务触发、任务终止、任务日志查询……等；</li>
</ul>
</li>
</ul>
<p>此处 RESTful API 主要用于非Java语言定制个性化执行器使用，实现跨语言。除此之外，如果有需要通过API操作调度中心，可以个性化扩展 “调度中心 RESTful API” 并使用。</p>
<h3 id="6-1-调度中心-RESTful-API"><a href="#6-1-调度中心-RESTful-API" class="headerlink" title="6.1 调度中心 RESTful API"></a>6.1 调度中心 RESTful API</h3><p>API服务位置：com.xxl.job.core.biz.AdminBiz （ com.xxl.job.admin.controller.JobApiController ）<br>API服务请求参考代码：com.xxl.job.adminbiz.AdminBizTest</p>
<h4 id="a、任务回调"><a href="#a、任务回调" class="headerlink" title="a、任务回调"></a>a、任务回调</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs awk">说明：执行器执行完任务后，回调任务结果时使用<br><br>------<br><br>地址格式：&#123;调度中心根地址&#125;<span class="hljs-regexp">/api/</span>callback<br><br>Header：<br>	XXL-JOB-ACCESS-TOKEN : &#123;请求令牌&#125;<br><br>请求数据格式如下，放置在 RequestBody 中，JSON格式：    <br>	[&#123;        <br>		<span class="hljs-string">&quot;logId&quot;</span>:<span class="hljs-number">1</span>,              <span class="hljs-regexp">//</span> 本次调度日志ID        <br>		<span class="hljs-string">&quot;logDateTim&quot;</span>:<span class="hljs-number">0</span>,         <span class="hljs-regexp">//</span> 本次调度日志时间        <br>		<span class="hljs-string">&quot;handleCode&quot;</span>:<span class="hljs-number">200</span>,       <span class="hljs-regexp">//</span> <span class="hljs-number">200</span> 表示任务执行正常，<span class="hljs-number">500</span>表示失败        <br>		<span class="hljs-string">&quot;handleMsg&quot;</span>: null        <br>		&#125;    <br>	&#125;]<br>	<br>响应数据格式：    <br>	&#123;      <br>		<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">200</span>,      <span class="hljs-regexp">//</span> <span class="hljs-number">200</span> 表示正常、其他失败      <br>		<span class="hljs-string">&quot;msg&quot;</span>: null      <span class="hljs-regexp">//</span> 错误提示消息    <br>	&#125;<br></code></pre></td></tr></table></figure>

<h4 id="b、执行器注册"><a href="#b、执行器注册" class="headerlink" title="b、执行器注册"></a>b、执行器注册</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs awk">说明：执行器注册时使用，调度中心会实时感知注册成功的执行器并发起任务调度<br><br>------<br><br>地址格式：&#123;调度中心根地址&#125;<span class="hljs-regexp">/api/</span>registry<br><br>Header：   <br>	XXL-JOB-ACCESS-TOKEN : &#123;请求令牌&#125;<br><br>请求数据格式如下，放置在 RequestBody 中，JSON格式：<br>	&#123;        <br>		<span class="hljs-string">&quot;registryGroup&quot;</span>:<span class="hljs-string">&quot;EXECUTOR&quot;</span>,                     <span class="hljs-regexp">//</span> 固定值        <br>		<span class="hljs-string">&quot;registryKey&quot;</span>:<span class="hljs-string">&quot;xxl-job-executor-example&quot;</span>,       <span class="hljs-regexp">//</span> 执行器AppName        <br>		<span class="hljs-string">&quot;registryValue&quot;</span>:<span class="hljs-string">&quot;http://127.0.0.1:9999/&quot;</span>        <span class="hljs-regexp">//</span> 执行器地址，内置服务跟地址    <br>	&#125;<br>	<br>响应数据格式：    <br>	&#123;      <br>		<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">200</span>,      <span class="hljs-regexp">//</span> <span class="hljs-number">200</span> 表示正常、其他失败      <br>		<span class="hljs-string">&quot;msg&quot;</span>: null      <span class="hljs-regexp">//</span> 错误提示消息    <br>	&#125;<br></code></pre></td></tr></table></figure>

<h4 id="c、执行器注册摘除"><a href="#c、执行器注册摘除" class="headerlink" title="c、执行器注册摘除"></a>c、执行器注册摘除</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">说明：执行器注册摘除时使用，注册摘除后的执行器不参与任务调度与执行------地址格式：&#123;调度中心根地址&#125;<span class="hljs-regexp">/api/</span>registryRemoveHeader：    XXL-JOB-ACCESS-TOKEN : &#123;请求令牌&#125;请求数据格式如下，放置在 RequestBody 中，JSON格式：    &#123;        <span class="hljs-string">&quot;registryGroup&quot;</span>:<span class="hljs-string">&quot;EXECUTOR&quot;</span>,                     <span class="hljs-regexp">//</span> 固定值        <span class="hljs-string">&quot;registryKey&quot;</span>:<span class="hljs-string">&quot;xxl-job-executor-example&quot;</span>,       <span class="hljs-regexp">//</span> 执行器AppName        <span class="hljs-string">&quot;registryValue&quot;</span>:<span class="hljs-string">&quot;http://127.0.0.1:9999/&quot;</span>        <span class="hljs-regexp">//</span> 执行器地址，内置服务跟地址    &#125;响应数据格式：    &#123;      <span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">200</span>,      <span class="hljs-regexp">//</span> <span class="hljs-number">200</span> 表示正常、其他失败      <span class="hljs-string">&quot;msg&quot;</span>: null      <span class="hljs-regexp">//</span> 错误提示消息    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="6-2-执行器-RESTful-API"><a href="#6-2-执行器-RESTful-API" class="headerlink" title="6.2 执行器 RESTful API"></a>6.2 执行器 RESTful API</h3><p>API服务位置：com.xxl.job.core.biz.ExecutorBiz<br>API服务请求参考代码：com.xxl.job.executorbiz.ExecutorBizTest</p>
<h4 id="a、心跳检测"><a href="#a、心跳检测" class="headerlink" title="a、心跳检测"></a>a、心跳检测</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">说明：调度中心检测执行器是否在线时使用<br><br><span class="hljs-comment">------</span><br><br>地址格式：&#123;执行器内嵌服务根地址&#125;/beat<br><br><span class="hljs-keyword">Header</span>：    <br>	XXL-JOB-<span class="hljs-keyword">ACCESS</span>-TOKEN : &#123;请求令牌&#125;<br>	<br>请求数据格式如下，放置在 RequestBody 中，<span class="hljs-type">JSON</span>格式：<br><br>响应数据格式：    <br>	&#123;      <br>		&quot;code&quot;: <span class="hljs-number">200</span>,      // <span class="hljs-number">200</span> 表示正常、其他失败      <br>		&quot;msg&quot;: <span class="hljs-keyword">null</span>       // 错误提示消息    <br>	&#125;<br></code></pre></td></tr></table></figure>

<h4 id="b、忙碌检测"><a href="#b、忙碌检测" class="headerlink" title="b、忙碌检测"></a>b、忙碌检测</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs awk">说明：调度中心检测指定执行器上指定任务是否忙碌（运行中）时使用<br><br>------<br><br>地址格式：&#123;执行器内嵌服务根地址&#125;/idleBeat<br><br>Header：    <br>	XXL-JOB-ACCESS-TOKEN : &#123;请求令牌&#125;<br>	<br>请求数据格式如下，放置在 RequestBody 中，JSON格式：    <br>	&#123;        <br>		<span class="hljs-string">&quot;jobId&quot;</span>:<span class="hljs-number">1</span>       <span class="hljs-regexp">//</span> 任务ID    <br>	&#125;<br>	<br>响应数据格式：    <br>	&#123;      <br>		<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">200</span>,      <span class="hljs-regexp">//</span> <span class="hljs-number">200</span> 表示正常、其他失败      <br>		<span class="hljs-string">&quot;msg&quot;</span>: null       <span class="hljs-regexp">//</span> 错误提示消息    <br>	&#125;<br></code></pre></td></tr></table></figure>

<h4 id="c、触发任务"><a href="#c、触发任务" class="headerlink" title="c、触发任务"></a>c、触发任务</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs awk">说明：触发任务执行<br><br>------<br><br>地址格式：&#123;执行器内嵌服务根地址&#125;/run<br><br>Header：    <br>	XXL-JOB-ACCESS-TOKEN : &#123;请求令牌&#125;<br>	<br>请求数据格式如下，放置在 RequestBody 中，JSON格式：    <br>	&#123;        <br>		<span class="hljs-string">&quot;jobId&quot;</span>:<span class="hljs-number">1</span>,                                  <span class="hljs-regexp">//</span> 任务ID        <br>		<span class="hljs-string">&quot;executorHandler&quot;</span>:<span class="hljs-string">&quot;demoJobHandler&quot;</span>,         <span class="hljs-regexp">//</span> 任务标识        <br>		<span class="hljs-string">&quot;executorParams&quot;</span>:<span class="hljs-string">&quot;demoJobHandler&quot;</span>,          <span class="hljs-regexp">//</span> 任务参数        <br>		<span class="hljs-string">&quot;executorBlockStrategy&quot;</span>:<span class="hljs-string">&quot;COVER_EARLY&quot;</span>,      <span class="hljs-regexp">//</span> 任务阻塞策略，可选值参考 com.xxl.job.core.enums.ExecutorBlockStrategyEnum        <br>		<span class="hljs-string">&quot;executorTimeout&quot;</span>:<span class="hljs-number">0</span>,                        <span class="hljs-regexp">//</span> 任务超时时间，单位秒，大于零时生效        <br>		<span class="hljs-string">&quot;logId&quot;</span>:<span class="hljs-number">1</span>,                                  <span class="hljs-regexp">//</span> 本次调度日志ID        <br>		<span class="hljs-string">&quot;logDateTime&quot;</span>:<span class="hljs-number">1586629003729</span>,                <span class="hljs-regexp">//</span> 本次调度日志时间        <br>		<span class="hljs-string">&quot;glueType&quot;</span>:<span class="hljs-string">&quot;BEAN&quot;</span>,                          <span class="hljs-regexp">//</span> 任务模式，可选值参考 com.xxl.job.core.glue.GlueTypeEnum         <span class="hljs-string">&quot;glueSource&quot;</span>:<span class="hljs-string">&quot;xxx&quot;</span>,                         <span class="hljs-regexp">//</span> GLUE脚本代码        <br>		<span class="hljs-string">&quot;glueUpdatetime&quot;</span>:<span class="hljs-number">1586629003727</span>,             <span class="hljs-regexp">//</span> GLUE脚本更新时间，用于判定脚本是否变更以及是否需要刷新        <br>		<span class="hljs-string">&quot;broadcastIndex&quot;</span>:<span class="hljs-number">0</span>,                         <span class="hljs-regexp">//</span> 分片参数：当前分片        <span class="hljs-string">&quot;broadcastTotal&quot;</span>:<span class="hljs-number">0</span>                          <span class="hljs-regexp">//</span> 分片参数：总分片    <br>	&#125;<br>	<br>响应数据格式：    <br>	&#123;      <br>		<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">200</span>,      <span class="hljs-regexp">//</span> <span class="hljs-number">200</span> 表示正常、其他失败      <br>		<span class="hljs-string">&quot;msg&quot;</span>: null       <span class="hljs-regexp">//</span> 错误提示消息    <br>	&#125;<br></code></pre></td></tr></table></figure>

<h4 id="f、终止任务"><a href="#f、终止任务" class="headerlink" title="f、终止任务"></a>f、终止任务</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs awk">说明：终止任务<br><br>------<br><br>地址格式：&#123;执行器内嵌服务根地址&#125;/kill<br><br>Header：    <br>	XXL-JOB-ACCESS-TOKEN : &#123;请求令牌&#125;<br>	<br>请求数据格式如下，放置在 RequestBody 中，JSON格式：<br>	&#123;        <br>		<span class="hljs-string">&quot;jobId&quot;</span>:<span class="hljs-number">1</span>       <span class="hljs-regexp">//</span> 任务ID    <br>	&#125;<br><br>响应数据格式：    <br>	&#123;      <br>		<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">200</span>,      <span class="hljs-regexp">//</span> <span class="hljs-number">200</span> 表示正常、其他失败      <br>		<span class="hljs-string">&quot;msg&quot;</span>: null       <span class="hljs-regexp">//</span> 错误提示消息    <br>	&#125;<br></code></pre></td></tr></table></figure>

<h4 id="d、查看执行日志"><a href="#d、查看执行日志" class="headerlink" title="d、查看执行日志"></a>d、查看执行日志</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs awk">说明：终止任务，滚动方式加载<br><br>------<br><br>地址格式：&#123;执行器内嵌服务根地址&#125;/log<br><br>Header：    <br>	XXL-JOB-ACCESS-TOKEN : &#123;请求令牌&#125;<br>	<br>请求数据格式如下，放置在 RequestBody 中，JSON格式：    <br>	&#123;        <br>		<span class="hljs-string">&quot;logDateTim&quot;</span>:<span class="hljs-number">0</span>,     <span class="hljs-regexp">//</span> 本次调度日志时间        <br>		<span class="hljs-string">&quot;logId&quot;</span>:<span class="hljs-number">0</span>,          <span class="hljs-regexp">//</span> 本次调度日志ID        <br>		<span class="hljs-string">&quot;fromLineNum&quot;</span>:<span class="hljs-number">0</span>     <span class="hljs-regexp">//</span> 日志开始行号，滚动加载日志    <br>	&#125;<br>	<br>响应数据格式：    <br>	&#123;        <br>		<span class="hljs-string">&quot;code&quot;</span>:<span class="hljs-number">200</span>,         <span class="hljs-regexp">//</span> <span class="hljs-number">200</span> 表示正常、其他失败        <br>		<span class="hljs-string">&quot;msg&quot;</span>: null         <span class="hljs-regexp">//</span> 错误提示消息        <br>		<span class="hljs-string">&quot;content&quot;</span>:&#123;            <br>			<span class="hljs-string">&quot;fromLineNum&quot;</span>:<span class="hljs-number">0</span>,        <span class="hljs-regexp">//</span> 本次请求，日志开始行数            <br>			<span class="hljs-string">&quot;toLineNum&quot;</span>:<span class="hljs-number">100</span>,        <span class="hljs-regexp">//</span> 本次请求，日志结束行号            <br>			<span class="hljs-string">&quot;logContent&quot;</span>:<span class="hljs-string">&quot;xxx&quot;</span>,     <span class="hljs-regexp">//</span> 本次请求日志内容            <br>			<span class="hljs-string">&quot;isEnd&quot;</span>:true            <span class="hljs-regexp">//</span> 日志是否全部加载完        <br>		&#125;    <br>	&#125;<br></code></pre></td></tr></table></figure>

<h2 id="七、版本更新日志"><a href="#七、版本更新日志" class="headerlink" title="七、版本更新日志"></a>七、版本更新日志</h2><h3 id="7-1-版本-V1-1-x，新特性-2015-12-05"><a href="#7-1-版本-V1-1-x，新特性-2015-12-05" class="headerlink" title="7.1 版本 V1.1.x，新特性[2015-12-05]"></a>7.1 版本 V1.1.x，新特性[2015-12-05]</h3><p><strong>【于V1.1.x版本，XXL-JOB正式应用于我司，内部定制别名为 “Ferrari”，新接入应用推荐使用最新版本】</strong></p>
<p>1、简单：支持通过Web页面对任务进行CRUD操作，操作简单，一分钟上手；</p>
<p>2、动态：支持动态修改任务状态，动态暂停&#x2F;恢复任务，即时生效；</p>
<p>3、服务HA：任务信息持久化到mysql中，Job服务天然支持集群，保证服务HA；</p>
<p>4、任务HA：某台Job服务挂掉，任务会平滑分配给其他的某一台存活服务，即使所有服务挂掉，重启时或补偿执行丢失任务；</p>
<p>5、一个任务只会在其中一台服务器上执行；</p>
<p>6、任务串行执行；</p>
<p>7、支持自定义参数；</p>
<p>8、支持远程任务执行终止；</p>
<h3 id="7-2-版本-V1-2-x，新特性-2016-01-17"><a href="#7-2-版本-V1-2-x，新特性-2016-01-17" class="headerlink" title="7.2 版本 V1.2.x，新特性[2016-01-17]"></a>7.2 版本 V1.2.x，新特性[2016-01-17]</h3><p>1、支持任务分组；</p>
<p>2、支持“本地任务”、“远程任务”；</p>
<p>3、底层通讯支持两种方式，Servlet方式 + JETTY方式；</p>
<p>4、支持“任务日志”；</p>
<p>5、支持“串行执行”，并行执行；</p>
<p>说明：V1.2版本将系统架构按功能拆分为：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-bullet">- </span>调度模块（调度中心）：负责管理调度信息，按照调度配置发出调度请求；- 执行模块（执行器）：负责接收调度请求并执行任务逻辑；- 通讯模块：负责调度模块和任务模块之间的信息通讯；<br></code></pre></td></tr></table></figure>

<p>优点：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-bullet">- </span>解耦：任务模块提供任务接口，调度模块维护调度信息，业务相互独立；- 高扩展性；- 稳定性；<br></code></pre></td></tr></table></figure>

<h3 id="7-3-版本-V1-3-0，新特性-2016-05-19"><a href="#7-3-版本-V1-3-0，新特性-2016-05-19" class="headerlink" title="7.3 版本 V1.3.0，新特性[2016-05-19]"></a>7.3 版本 V1.3.0，新特性[2016-05-19]</h3><p>1、遗弃“本地任务”模式，推荐使用“远程任务”，易于系统解耦，任务对应的JobHandler统称为“执行器”；</p>
<p>2、遗弃“servlet”方式底层系统通讯，推荐使用JETTY方式，调度+回调双向通讯，重构通讯逻辑；</p>
<p>3、UI交互优化：左侧菜单展开状态优化，菜单项选中状态优化，任务列表打开表格有压缩优化；</p>
<p>4、【重要】“执行器”细分为：BEAN、GLUE两种开发模式，简介见下文：</p>
<p>“执行器” 模式简介：</p>
<ul>
<li>BEAN模式执行器：每个执行器都是Spring的一个Bean实例，XXL-JOB通过注解<a target="_blank" rel="noopener" href="https://github.com/JobHandler">@JobHandler</a>识别和调度执行器；<br>-GLUE模式执行器：每个执行器对应一段代码，在线Web编辑和维护，动态编译生效，执行器负责加载GLUE代码和执行；</li>
</ul>
<h3 id="7-4-版本-V1-3-1，新特性-2016-05-23"><a href="#7-4-版本-V1-3-1，新特性-2016-05-23" class="headerlink" title="7.4 版本 V1.3.1，新特性[2016-05-23]"></a>7.4 版本 V1.3.1，新特性[2016-05-23]</h3><p>1、更新项目目录结构：</p>
<ul>
<li>&#x2F;xxl-job-admin —————————— 【调度中心】：负责管理调度信息，按照调度配置发出调度请求；</li>
<li>&#x2F;xxl-job-core ———————————- 公共依赖</li>
<li>&#x2F;xxl-job-executor-example ——— 【执行器】：负责接收调度请求并执行任务逻辑；</li>
<li>&#x2F;db ————————————————— 建表脚本</li>
<li>&#x2F;doc ————————————————- 用户手册</li>
</ul>
<p>2、在新的目录结构上，升级了用户手册；</p>
<p>3、优化了一些交互和UI；</p>
<h3 id="7-5-版本-V1-3-2，新特性-2016-05-28"><a href="#7-5-版本-V1-3-2，新特性-2016-05-28" class="headerlink" title="7.5 版本 V1.3.2，新特性[2016-05-28]"></a>7.5 版本 V1.3.2，新特性[2016-05-28]</h3><p>1、调度逻辑进行事务包裹；</p>
<p>2、执行器异步回调执行日志；</p>
<p>3、【重要】在 “调度中心” 支持HA的基础上，扩展执行器的Failover支持，支持配置多执行期地址；</p>
<h3 id="7-6-版本-V1-4-0-新特性-2016-07-24"><a href="#7-6-版本-V1-4-0-新特性-2016-07-24" class="headerlink" title="7.6 版本 V1.4.0 新特性[2016-07-24]"></a>7.6 版本 V1.4.0 新特性[2016-07-24]</h3><p>1、任务依赖: 通过事件触发方式实现, 任务执行成功并回调时会主动触发一次子任务的调度, 多个子任务用逗号分隔;</p>
<p>2、执行器底层实现代码进行重度重构, 优化底层建表脚本;</p>
<p>3、执行器中任务线程分组逻辑优化: 之前根据执行器JobHandler进行线程分组,当多个任务复用Jobhanlder会导致相互阻塞。现改为根据调度中心任务进行任务线程分组,任务与任务执行相互隔离;</p>
<p>4、执行器调度通讯方案优化, 通过Hex + HC实现建议RPC通讯协议, 优化了通讯参数的维护和解析流程;</p>
<p>5、调度中心, 新建&#x2F;编辑任务, 界面属性调整:</p>
<ul>
<li>5.1、任务新增&#x2F;编辑界面中去除 “任务名JobName”属性 ,该属性改为系统自动生成: 该字段之前主要用于在 “调度中心” 唯一标示一个任务, 现实意义不大, 因此计划淡化掉该字段,改为系统生成UUID,从而简化任务新建的操作;</li>
<li>5.2、任务新增&#x2F;编辑界面中去除 “GLUE模式” 复选框位置调整, 改为贴近”JobHandler”输入框右侧;</li>
<li>5.3、任务新增&#x2F;编辑界面中去除 “报警阈值” 属性;</li>
<li>5.4、任务新增&#x2F;编辑界面中去除 “子任务Key” 属性, 每个任务全局任务Key可以从任务列表获取, 当本任务执行结束且成功后, 将会根据子任务Key匹配子任务并主动触发一次子任务执行;</li>
</ul>
<p>6、问题修复:</p>
<p>6.1、执行器jetty关闭优化,解决一处可能导致jetty无法关闭的问题;</p>
<p>6.2、执行器任务终止时,执行队列回调优化,解决一处导致任务无法回调的问题；</p>
<p>6.3、调度中心中列表分页参数优化,解决一处因服务器限制post长度而引起的问题;</p>
<p>6.4、执行器Jobhandler注解优化,解决一处因事务代理导致的容器无法加载JobHandler的问题;</p>
<p>6.5、远程调度优化,禁用retry策略,解决一处可能导致重复调用的问题;</p>
<p>Tips: 历史版本(V1.3.x)目前已经Release至稳定版本, 进入维护阶段, 地址见分支 <a target="_blank" rel="noopener" href="https://github.com/xuxueli/xxl-job/tree/v1.3">V1.3</a> 。新特性将会在master分支持续更新。</p>
<h3 id="7-7-版本-V1-4-1-新特性-2016-09-06"><a href="#7-7-版本-V1-4-1-新特性-2016-09-06" class="headerlink" title="7.7 版本 V1.4.1 新特性[2016-09-06]"></a>7.7 版本 V1.4.1 新特性[2016-09-06]</h3><p>1、项目成功推送maven中央仓库, 中央仓库地址以及依赖如下:</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-comment">&lt;!-- http://repo1.maven.org/maven2/com/xuxueli/xxl-job-core/ --&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>      </span><br><span class="language-xml"> 	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuxueli<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>      </span><br><span class="language-xml"> 	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xxl-job-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>      </span><br><span class="language-xml"> 	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;最新稳定版&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>2、为适配中央仓库规则, 项目groupId从com.xxl改为com.xuxueli。</p>
<p>3、系统版本不在维护在项目跟pom中,各个子模块单独配置版本配置,解决子模块无法单独编译的问题;</p>
<p>4、底层RPC通讯,传输数据的字节长度统计规则优化,可节省50%数据传输量;</p>
<p>5、IJobHandler取消任务返回值,原通过返回值判断执行状态,逻辑改为:默认任务执行成功,仅在捕获异常时认定任务执行失败。</p>
<p>6、系统公共弹框功能,插件化;</p>
<p>7、底层表结构,表明统一大写;</p>
<p>8、调度中心,异常处理器JSON响应的ContentType修改,修复浏览器不识别的问题;</p>
<h3 id="7-8-版本-V1-4-2-新特性-2016-09-29"><a href="#7-8-版本-V1-4-2-新特性-2016-09-29" class="headerlink" title="7.8 版本 V1.4.2 新特性[2016-09-29]"></a>7.8 版本 V1.4.2 新特性[2016-09-29]</h3><p>1、推送新版本 V1.4.2 至中央仓库, 大版本 V1.4 进入维护阶段;</p>
<p>2、任务新增时,任务列表偏移问题修复;</p>
<p>3、修复一处因bootstrap不支持模态框重叠而导致的样式错乱的问题, 在任务编辑时会出现该问题;</p>
<p>4、调度超时和Handler匹配不到时,调度状态优化;</p>
<p>5、因catch异常,导致任务不可终止的问题,给出解决方案, 见文档;</p>
<h3 id="7-9-版本-V1-5-0-特性-2016-11-13"><a href="#7-9-版本-V1-5-0-特性-2016-11-13" class="headerlink" title="7.9 版本 V1.5.0 特性[2016-11-13]"></a>7.9 版本 V1.5.0 特性[2016-11-13]</h3><p>1、任务注册: 执行器会周期性自动注册任务, 调度中心将会自动发现注册的任务并触发执行。</p>
<p>2、”执行器” 新增参数 “AppName” : 是每个执行器集群的唯一标示AppName, 并周期性以AppName为对象进行自动注册。</p>
<p>3、调度中心新增栏目 “执行器管理” : 管理在线的执行器, 通过属性AppName自动发现注册的执行器。只有被管理的执行器才允许被使用;</p>
<p>4、”任务组”属性改为”执行器”: 每个任务需要绑定指定的执行器, 调度地址通过绑定的执行器获取;</p>
<p>5、抛弃”任务机器”属性: 通过任务绑定的执行器, 自动发现注册的远程执行器地址并触发调度请求。</p>
<p>6、”公共依赖”中新增DBGlueLoader,基于原生jdbc实现GLUE源码的加载器,减少第三方依赖(mybatis,spring-orm等);精简和优化执行器测配置(针对GLUE任务),降低上手难度;</p>
<p>7、表结构调整,底层重构优化;</p>
<p>8、”调度中心”自动注册和发现,failover: 调度中心周期性自动注册, 任务回调时可以感知在线的所有调度中心地址, 通过failover的方式进行任务回调,避免回调单点风险。</p>
<h3 id="7-10-版本-V1-5-1-特性-2016-11-13"><a href="#7-10-版本-V1-5-1-特性-2016-11-13" class="headerlink" title="7.10 版本 V1.5.1 特性[2016-11-13]"></a>7.10 版本 V1.5.1 特性[2016-11-13]</h3><p>1、底层代码重构和逻辑优化，POM清理以及CleanCode；</p>
<p>2、Servlet&#x2F;JSP Spec设定为3.0&#x2F;2.2</p>
<p>3、Spring升级至3.2.17.RELEASE版本；</p>
<p>4、Jetty升级版本至8.2.0.v20160908；</p>
<p>5、已推送V1.5.0和V1.5.1至Maven中央仓库；</p>
<h3 id="7-11-版本-V1-5-2-特性-2017-02-28"><a href="#7-11-版本-V1-5-2-特性-2017-02-28" class="headerlink" title="7.11 版本 V1.5.2 特性[2017-02-28]"></a>7.11 版本 V1.5.2 特性[2017-02-28]</h3><p>1、IP工具类获取IP逻辑优化，IP静态缓存；</p>
<p>2、执行器、调度中心，均支持自定义注册IP地址；解决机器多网卡时错误网卡注册的情况；</p>
<p>3、任务跨天执行时生成多份日志文件的问题修复；</p>
<p>4、底层日志底层日志调整，非敏感日志level调整为debug；</p>
<p>5、升级数据库连接池c3p0版本；</p>
<p>6、执行器log4j配置优化，去除无效属性；</p>
<p>7、底层代码重构和逻辑优化以及CleanCode；</p>
<p>8、GLUE依赖注入逻辑优化，支持别名注入；</p>
<h3 id="7-12-版本-V1-6-0-特性-2017-03-13"><a href="#7-12-版本-V1-6-0-特性-2017-03-13" class="headerlink" title="7.12 版本 V1.6.0 特性[2017-03-13]"></a>7.12 版本 V1.6.0 特性[2017-03-13]</h3><p>1、通讯方案升级，原基于HEX的通讯模型调整为基于HTTP的B-RPC的通讯模型；</p>
<p>2、执行器支持手动设置执行地址列表，提供开关切换使用注册地址还是手动设置的地址；</p>
<p>3、执行器路由规则：第一个、最后一个、轮询、随机、一致性HASH、最不经常使用、最近最久未使用、故障转移；</p>
<p>4、规范线程模型统一，统一线程销毁方案(通过listener或stop方法，容器销毁时销毁线程；Daemon方式有时不太理想)；</p>
<p>5、规范系统配置数据，通过配置文件统一管理；</p>
<p>6、CleanCode，清理无效的历史参数；</p>
<p>7、底层扩展数据结构以及相关表结构调整；</p>
<p>8、新建任务默认为非运行状态；</p>
<p>9、GLUE模式任务实例更新逻辑优化，原根据超时时间更新改为根据版本号更新，源码变动版本号加一；</p>
<h3 id="7-13-版本-V1-6-1-特性-2017-03-25"><a href="#7-13-版本-V1-6-1-特性-2017-03-25" class="headerlink" title="7.13 版本 V1.6.1 特性[2017-03-25]"></a>7.13 版本 V1.6.1 特性[2017-03-25]</h3><p>1、Rolling日志；</p>
<p>2、WebIDE交互重构；</p>
<p>3、通讯增强校验，有效过滤非正常请求；</p>
<p>4、权限增强校验，采用动态登录TOKEN（推荐接入内部SSO）；</p>
<p>5、数据库配置优化，解决乱码问题；</p>
<h3 id="7-14-版本-V1-6-2-特性-2017-04-25"><a href="#7-14-版本-V1-6-2-特性-2017-04-25" class="headerlink" title="7.14 版本 V1.6.2 特性[2017-04-25]"></a>7.14 版本 V1.6.2 特性[2017-04-25]</h3><p>1、运行报表：支持实时查看运行数据，如任务数量、调度次数、执行器数量等；以及调度报表，如调度日期分布图，调度成功分布图等；</p>
<p>2、JobHandler支持设置任务返回值，在任务逻辑中可以方便的控制任务执行结果；</p>
<p>3、资源路径包含空格或中文时资源文件无法加载时，无法准确查看异常信息的问题处理。</p>
<p>4、路由策越优化：循环和LFU路由策略计数器自增无上限问题和首次路由压力集中在首台机器的问题修复；</p>
<h3 id="7-15-版本-V1-7-0-特性-2017-05-02"><a href="#7-15-版本-V1-7-0-特性-2017-05-02" class="headerlink" title="7.15 版本 V1.7.0 特性[2017-05-02]"></a>7.15 版本 V1.7.0 特性[2017-05-02]</h3><p>1、脚本任务：支持以GLUE模式开发和运行脚本任务，包括Shell、Python和Groovy等类型脚本;</p>
<p>2、新增spring-boot类型执行器example项目；</p>
<p>3、升级jetty版本至9.2；</p>
<p>4、任务运行日志移除log4j组件依赖，改为底层自主实现，从而取消了对日志组件的依赖限制；</p>
<p>5、执行器移除GlueLoader依赖，改为推送方式实现，从而GLUE源码加载不再依赖JDBC；</p>
<p>6、登录拦截Redirect时获取项目名，解决非根据目录发布时跳转404问题；</p>
<h3 id="7-16-版本-V1-7-1-特性-2017-05-08"><a href="#7-16-版本-V1-7-1-特性-2017-05-08" class="headerlink" title="7.16 版本 V1.7.1 特性[2017-05-08]"></a>7.16 版本 V1.7.1 特性[2017-05-08]</h3><p>1、运行日志读写编码统一为UTF-8，解决windows环境下日志乱码问题；</p>
<p>2、通讯超时时间限定为10s，避免异常情况下调度线程占用；</p>
<p>3、执行器，server启动、销毁和注册逻辑调整；</p>
<p>4、JettyServer关闭逻辑优化，修复执行器无法正常关闭导致端口占用和频繁打印c3p0日志的问题；</p>
<p>5、JobHandler中开启子线程时，支持子线程输出执行日志并通过Rolling查看。</p>
<p>6、任务日志清理功能；</p>
<p>7、弹框组件统一替换为layer；</p>
<p>8、升级quartz版本至2.3.0；</p>
<h3 id="7-17-版本-V1-7-2-特性-2017-05-17"><a href="#7-17-版本-V1-7-2-特性-2017-05-17" class="headerlink" title="7.17 版本 V1.7.2 特性[2017-05-17]"></a>7.17 版本 V1.7.2 特性[2017-05-17]</h3><p>1、阻塞处理策略：调度过于密集执行器来不及处理时的处理策略，策略包括：单机串行（默认）、丢弃后续调度、覆盖之前调度；</p>
<p>2、失败处理策略；调度失败时的处理策略，策略包括：失败告警（默认）、失败重试；</p>
<p>3、通讯时间戳超时时间调整为180s；</p>
<p>4、执行器与数据库彻底解耦，但是执行器需要配置调度中心集群地址。调度中心提供API供执行器回调和心跳注册服务，取消调度中心内部jetty，心跳周期调整为30s，心跳失效为三倍心跳；</p>
<p>5、执行参数编辑时丢失问题修复；</p>
<p>6、新增任务测试Demo，方便在开发时进行任务逻辑测试；</p>
<h3 id="7-18-版本-V1-8-0-特性-2017-07-17"><a href="#7-18-版本-V1-8-0-特性-2017-07-17" class="headerlink" title="7.18 版本 V1.8.0 特性[2017-07-17]"></a>7.18 版本 V1.8.0 特性[2017-07-17]</h3><p>1、任务Cron更新逻辑优化，改为rescheduleJob，同时防止cron重复设置；</p>
<p>2、API回调服务失败状态码优化，方便问题排查；</p>
<p>3、XxlJobLogger的日志多参数支持；</p>
<p>4、路由策略新增 “忙碌转移” 模式：按照顺序依次进行空闲检测，第一个空闲检测成功的机器选定为目标执行器并发起调度；</p>
<p>5、路由策略代码重构；</p>
<p>6、执行器重复注册问题修复；</p>
<p>7、任务线程轮空30次后自动销毁，降低低频任务的无效线程消耗。</p>
<p>8、执行器任务执行结果批量回调，降低回调频率提升执行器性能；</p>
<p>9、springboot版本执行器，取消XML配置，改为类配置方式；</p>
<p>10、执行日志，支持根据运行 “状态” 筛选日志；</p>
<p>11、调度中心任务注册检测逻辑优化；</p>
<h3 id="7-19-版本-V1-8-1-特性-2017-07-30"><a href="#7-19-版本-V1-8-1-特性-2017-07-30" class="headerlink" title="7.19 版本 V1.8.1 特性[2017-07-30]"></a>7.19 版本 V1.8.1 特性[2017-07-30]</h3><p>1、分片广播任务：执行器集群部署时，任务路由策略选择”分片广播”情况下，一次任务调度将会广播触发集群中所有执行器执行一次任务，可根据分片参数处理分片任务；</p>
<p>2、动态分片：分片广播任务以执行器为维度进行分片，支持动态扩容执行器集群从而动态增加分片数量，协同进行业务处理；在进行大数据量业务操作时可显著提升任务处理能力和速度。</p>
<p>3、执行器JobHandler禁止命名冲突；</p>
<p>4、执行器集群地址列表进行自然排序；</p>
<p>5、调度中心，DAO层代码精简优化并且新增测试用例覆盖；</p>
<p>6、调度中心API服务改为自研RPC形式，统一底层通讯模型；</p>
<p>7、新增调度中心API服务测试Demo，方便在调度中心API扩展和测试；</p>
<p>8、任务列表页交互优化，更换执行器分组时自动刷新任务列表，新建任务时默认定位在当前执行器位置；</p>
<p>9、访问令牌（accessToken）：为提升系统安全性，调度中心和执行器进行安全性校验，双方AccessToken匹配才允许通讯；</p>
<p>10、springboot版本执行器，升级至1.5.6.RELEASE版本；</p>
<p>11、统一maven依赖版本管理；</p>
<h3 id="7-20-版本-V1-8-2-特性-2017-09-04"><a href="#7-20-版本-V1-8-2-特性-2017-09-04" class="headerlink" title="7.20 版本 V1.8.2 特性[2017-09-04]"></a>7.20 版本 V1.8.2 特性[2017-09-04]</h3><p>1、项目主页搭建：提供中英文文档：<a target="_blank" rel="noopener" href="https://www.xuxueli.com/xxl-job">https://www.xuxueli.com/xxl-job</a></p>
<p>2、JFinal执行器Sample示例项目；</p>
<p>3、事件触发：除了”Cron方式”和”任务依赖方式”触发任务执行之外，支持基于事件的触发任务方式。调度中心提供触发任务单次执行的API服务，可根据业务事件灵活触发。</p>
<p>4、执行器摘除：执行器销毁时，主动通知调度中心并摘除对应执行器节点，提高执行器状态感知的时效性。</p>
<p>5、执行器手动设置IP时将会绑定Host；</p>
<p>6、规范项目目录，方便扩展多执行器；</p>
<p>7、解决执行器回调URL不支持配置HTTPS时问题；</p>
<p>8、执行器回调线程销毁前, 批量回调队列中数据，防止任务结果丢失；</p>
<p>9、调度中心任务监控线程销毁时，批量对失败任务告警，防止告警信息丢失；</p>
<p>10、任务日志文件路径时间戳格式化时SimpleDateFormat并发问题解决；</p>
<h3 id="7-21-版本-V1-9-0-特性-2017-12-29"><a href="#7-21-版本-V1-9-0-特性-2017-12-29" class="headerlink" title="7.21 版本 V1.9.0 特性[2017-12-29]"></a>7.21 版本 V1.9.0 特性[2017-12-29]</h3><p>1、新增Nutz执行器Sample示例项目；</p>
<p>2、新增任务运行模式 “GLUE模式(NodeJS) “，支持NodeJS脚本任务；</p>
<p>3、脚本任务Shell、Python和Nodejs等支持获取分片参数；</p>
<p>4、失败重试，完整支持：调度中心调度失败且启用”失败重试”策略时，将会自动重试一次；执行器执行失败且回调失败重试状态（新增失败重试状态返回值）时，也将会自动重试一次；</p>
<p>5、失败告警策略扩展：默认提供邮件失败告警，可扩展短信等，扩展代码位置为 “JobFailMonitorHelper.failAlarm”；</p>
<p>6、执行器端口支持自动生成(小于等于0时)，避免端口定义冲突；</p>
<p>7、调度报表优化，支持时间区间筛选；</p>
<p>8、Log组件支持输出异常栈信息，底层实现优化；</p>
<p>9、告警邮件样式优化，调整为表格形式，邮件组件调整为commons-email简化邮件操作；</p>
<p>10、项目依赖全量升级至较新稳定版本，如spring、jackson等等；</p>
<p>11、任务日志，记录发起调度的机器信息；</p>
<p>12、交互优化，如登录注销；</p>
<p>13、任务Cron长度扩展支持至128位，支持负责类型Cron设置；</p>
<p>14、执行器地址录入交互优化，地址长度扩展支持至512位，支持大规模执行器集群配置；</p>
<p>15、任务参数“IJobHandler.execute”入参改为“String params”，增强入参通用性。</p>
<p>16、IJobHandler提供init&#x2F;destroy方法，支持在相应任务线程初始化和销毁时进行附加操作；</p>
<p>17、任务注解调整为 “<a target="_blank" rel="noopener" href="https://github.com/JobHandler">@JobHandler</a>”，与任务抽象接口统一；</p>
<p>18、修复任务监控线程被耗时任务阻塞的问题；</p>
<p>19、修复任务监控线程无法监控任务触发和执行状态均未0的问题；</p>
<p>20、执行器动态代理对象，拦截非业务方法的执行；</p>
<p>21、修复JobThread捕获Error错误不更新JobLog的问题；</p>
<p>22、修复任务列表界面左侧菜单合并时样式错乱问题；</p>
<p>23、调度中心项目日志配置改为xml文件格式；</p>
<p>24、Log地址格式兼容，支持非”&#x2F;“结尾路径配置；</p>
<p>25、底层系统日志级别规范调整，清理遗留代码；</p>
<p>26、建表SQL优化，支持同步创建制定编码的库和表；</p>
<p>27、系统安全性优化，登录Token写Cookie时进行MD5加密，同时Cookie启用HttpOnly；</p>
<p>28、新增”任务ID”属性，移除”JobKey”属性，前者承担所有功能，方便后续增强任务依赖功能。</p>
<p>29、任务循环依赖问题修复，避免子任务与父任务重复导致的调度死循环；</p>
<p>30、任务列表新增筛选条件 “任务描述”，快速检索任务；</p>
<p>31、执行器Log文件定期清理功能：执行器新增配置项（”xxl.job.executor.logretentiondays”）日志保存天数，日志文件过期自动删除。</p>
<h3 id="7-22-版本-V1-9-1-特性-2018-02-22"><a href="#7-22-版本-V1-9-1-特性-2018-02-22" class="headerlink" title="7.22 版本 V1.9.1 特性[2018-02-22]"></a>7.22 版本 V1.9.1 特性[2018-02-22]</h3><p>1、国际化：调度中心实现国际化，支持中文、英文两种语言，默认为中文。</p>
<p>2、调度报表新增”运行中”中状态项；</p>
<p>3、调度报表优化，报表SQL调优并且新增LocalCache缓存（缓存时间60s），提高大数据量下报表加载速度；</p>
<p>4、修复打包部署时资源文件乱码问题；</p>
<p>5、修复新版本chrome滚动到顶部失效问题；</p>
<p>6、调度中心配置加载优化，取消对配置文件名的强依赖，支持加载磁盘配置；</p>
<p>7、修复脚本任务Log文件未正常close的问题；</p>
<p>8、项目依赖全量升级至较新稳定版本，如spring、jackson等等；</p>
<h3 id="7-23-版本-V1-9-2-特性-2018-10-05"><a href="#7-23-版本-V1-9-2-特性-2018-10-05" class="headerlink" title="7.23 版本 V1.9.2 特性[2018-10-05]"></a>7.23 版本 V1.9.2 特性[2018-10-05]</h3><p>1、任务超时控制：新增任务属性 “任务超时时间”，并支持自定义，任务运行超时将会主动中断任务；</p>
<p>2、任务失败重试次数：新增任务属性 “失败重试次数”，并支持自定义，当任务失败时将会按照预设的失败重试次数主动进行重试；同时收敛废弃其他失败重试策略，如调度失败、执行失败、状态码失败等；</p>
<p>3、新增任务运行模式 “GLUE模式(PHP) “，支持php脚本任务；</p>
<p>4、新增任务运行模式 “GLUE模式(PowerShell) “，支持PowerShell脚本任务；</p>
<p>5、调度全异步处理：任务触发之后，推送到调度队列，多线程并发处理调度请求，提高任务调度速率的同时，避免因网络问题导致quartz调度线程阻塞的问题；</p>
<p>6、执行器任务结果落盘优化：执行器回调失败时将任务结果写磁盘，待重启或网络恢复时重试回调任务结果，防止任务执行结果丢失；</p>
<p>7、任务日志查询速度大幅提升：百万级别数据量搜索速度提升1000倍；</p>
<p>8、调度中心提供API服务，支持通过API服务对任务进行查询、新增、更新、启停等操作；</p>
<p>9、底层自研Log组件参数占位符改为”{}”，并修复打印有参日志时参数不匹配导致报错的问题；</p>
<p>10、任务回调结果优化，支持展示在Rolling log中，方便问题排查；</p>
<p>11、底层LocalCache组件兼容性优化，支持jdk9、jdk10及以上版本编译部署；</p>
<p>12、告警邮件固定使用 UTF-8 编码格式，修复由机器编码导致的邮件乱码问题；</p>
<p>13、告警邮件中展示失败告警信息；</p>
<p>14、告警邮箱支持SSL配置；</p>
<p>15、Window机器下File.separator不兼容问题修复；</p>
<p>16、脚本任务异常Log输出优化；</p>
<p>17、任务线程停止变量修饰符优化；</p>
<p>18、脚本任务Log文件流关闭优化；</p>
<p>19、任务报表成功、失败和进行中统计问题修复；</p>
<p>20、核心依赖Core内部国际化处理；</p>
<p>21、默认Quartz线程数调整为50；</p>
<p>22、新增左侧菜单”运行报表”；</p>
<p>23、执行器手动设置IP时取消绑定Host的操作，该IP仅供执行器注册使用；修复指定外网IP时无法绑定执行器Host的问题；</p>
<p>24、取消父子任务不可重复的限制，支持循环任务触发等特殊场景；</p>
<p>25、任务调度备注中标注任务触发类型，如Cron触发、父任务触发、API触发等等，方便排查调度日志；</p>
<p>26、底层日志组件SimpleDateFormat线程安全问题修复；</p>
<p>27、执行器通讯线程优化，corePoolSize从256降低至32；</p>
<p>28、任务日志表状态字段类型优化；</p>
<p>29、GLUE脚本文件自动清理功能，及时清理过期脚本文件；</p>
<p>30、执行器注册方式切换优化，切换自动注册时主动同步在线机器，避免执行器为空的问题；</p>
<p>31、跨平台：除了提供Java、Python、PHP等十来种任务模式之外，新增提供基于HTTP的任务模式；</p>
<p>32、底层RPC序列化协议调整为hessian2；</p>
<p>33、修复表字段 “t.order”与数据库关键字冲突查询失败的问题，</p>
<p>34、任务属性枚举 “任务模式、阻塞策略” 国际化优化；</p>
<p>35、分片任务失败重试优化，仅重试当前失败的分片；</p>
<p>36、任务触发时支持动态传参，调度中心与API服务均提供提供动态参数功能；</p>
<p>37、任务执行日志、调度日志字段类型调整，改为text类型并取消字数限制；</p>
<p>38、GLUE任务脚本字段类型调整，改为mediumtext类型，提高GLUE长度上限；</p>
<p>39、任务监控线程Log输出优化，运行中任务的监控Log改为debug级别，减少非核心日志量；</p>
<p>40、项目依赖全量升级至较新稳定版本，如spring、Jackson、groovy等等；</p>
<p>41、docker支持：调度中心提供 Dockerfile 方便快速构建docker镜像；</p>
<h3 id="7-24-版本-V2-0-0-Release-Notes-2018-11-04"><a href="#7-24-版本-V2-0-0-Release-Notes-2018-11-04" class="headerlink" title="7.24 版本 V2.0.0 Release Notes[2018-11-04]"></a>7.24 版本 V2.0.0 Release Notes[2018-11-04]</h3><p>1、调度中心迁移到 springboot；</p>
<p>2、底层通讯组件迁移至 xxl-rpc；</p>
<p>3、容器化：提供官方docker镜像，并实时更新推送dockerhub（docker pull xuxueli&#x2F;xxl-job-admin），进一步实现产品开箱即用；</p>
<p>4、新增无框架执行器Sample示例项目 “xxl-job-executor-sample-frameless”。不依赖第三方框架，只需main方法即可启动运行执行器；</p>
<p>5、命令行任务：原生提供通用命令行任务Handler（Bean任务，”CommandJobHandler”）；业务方只需要提供命令行即可；</p>
<p>6、任务状态优化，仅运行状态”NORMAL”任务关联至quartz，降低quartz底层数据存储与调度压力；</p>
<p>7、任务状态规范：新增任务默认停止状态，任务更新时保持任务状态不变；</p>
<p>8、IP获取逻辑优化，优先遍历网卡来获取可用IP；</p>
<p>9、任务新增的API服务接口返回任务ID，方便调用方实用；</p>
<p>10、组件化优化，移除对 spring 的依赖：非spring应用选用 “XxlJobExecutor” 、spring应用选用 “XxlJobSpringExecutor” 作为执行器组件；</p>
<p>11、任务RollingLog展示逻辑优化，修复超时任务无法查看的问题；</p>
<p>12、多项UI组件升级到最新版本，如：CodeMirror、Echarts、Jquery 等；</p>
<p>13、项目依赖升级 groovy 至较新稳定版本；pom清理；</p>
<p>14、子任务失败重试重试逻辑优化，子任务失败时将会按照其预设的失败重试次数主动进行重试</p>
<h3 id="7-25-版本-v2-0-1-Release-Notes-2018-11-09"><a href="#7-25-版本-v2-0-1-Release-Notes-2018-11-09" class="headerlink" title="7.25 版本 v2.0.1 Release Notes[2018-11-09]"></a>7.25 版本 v2.0.1 Release Notes[2018-11-09]</h3><p>1、左侧菜单折叠动画问题修复；</p>
<p>2、调度报表日期分布图默认值统一；</p>
<p>3、freemarker对数字默认加千分位问题修复，解决日志ID被分隔导致查看日志失败问题；</p>
<p>4、底层通讯组件升级，修复通讯异常时无效等待的问题；</p>
<p>5、执行器启动之后jetty停止的问题修复；</p>
<h3 id="7-26-版本-v2-0-2-Release-Notes-2019-04-20"><a href="#7-26-版本-v2-0-2-Release-Notes-2019-04-20" class="headerlink" title="7.26 版本 v2.0.2 Release Notes[2019-04-20]"></a>7.26 版本 v2.0.2 Release Notes[2019-04-20]</h3><p>1、底层通讯方案优化：升级较新版本xxl-rpc，由”JETTY”方案调整为”NETTY_HTTP”方案，执行器内嵌netty-http-server提供服务，调度中心复用容器端口提供服务；</p>
<p>2、任务告警逻辑调整，改为通过扫描失败日志方式触发。一方面精确扫描失败任务，降低扫描范围；另一方面取消内存队列，降低线程内存消耗；</p>
<p>3、Quartz触发线程池废弃并替换为 “XxlJobThreadPool”，降低线程切换、内存占用带来的消耗，提高调度性能；</p>
<p>4、调度线程池隔离，拆分为”Fast”和”Slow”两个线程池，1分钟窗口期内任务耗时达500ms超过10次，该窗口期内判定为慢任务，慢任务自动降级进入”Slow”线程池，避免耗尽调度线程，提高系统稳定性；</p>
<p>5、执行器热部署时JobHandler重新初始化，修复由此导致的 “jobhandler naming conflicts.” 问题；</p>
<p>6、新增Class的加载缓存，解决频繁加载Class会使jvm的方法区空间不足导致OOM的问题；</p>
<p>7、任务支持更换绑定执行器，方便任务分组转移和管理；</p>
<p>8、调度中心告警邮件发送组件改为 “spring-boot-starter-mail”；</p>
<p>9、记住密码功能优化，选中时永久记住；非选中时关闭浏览器即登出；</p>
<p>10、项目依赖升级至较新稳定版本，如quartz、spring、jackson、groovy、xxl-rpc等等；</p>
<p>11、精简项目，取消第三方依赖，如 commons-collections4、commons-lang3 ;</p>
<p>12、执行器回调日志落盘方案复用RPC序列化方案，并移除Jackson依赖；</p>
<p>13、底层Log调优，应用正常终止取消异常栈信息打印；</p>
<p>14、交互优化，尽量避免新开页面窗口；仅WebIDE支持新开页，并提供窗口快速关闭按钮；任务启、停、删除、触发等轻操作提示改为toast方式，</p>
<p>15、任务暂停、删除优化，避免quartz delete不完整导致任务脏数据；</p>
<p>16、任务回调、心跳注册成功日志优化，非核心常规日志调整为debug级别，降低冗余日志输出；</p>
<p>17、调整首页报表默认区间为本周，避免日志量太大查询缓慢；</p>
<p>18、LRU路由更新不及时问题修复；</p>
<p>19、任务失败告警邮件发送逻辑优化；</p>
<p>20、调度日志排序逻辑调整为按照调度时间倒序，兼容TIDB等主键不连续日志存储组件；</p>
<p>21、执行器优雅停机优化；</p>
<p>22、连接池配置优化，增强连接有效性验证；</p>
<p>23、JobHandler#msg长度限制，修复异常情况下日志超长导致内存溢出的问题；</p>
<p>24、升级xxl-rpc至较新版本，修复springboot 2.x版本兼容性问题；</p>
<h3 id="7-27-版本-v2-1-0-Release-Notes-2019-07-07"><a href="#7-27-版本-v2-1-0-Release-Notes-2019-07-07" class="headerlink" title="7.27 版本 v2.1.0 Release Notes[2019-07-07]"></a>7.27 版本 v2.1.0 Release Notes[2019-07-07]</h3><p>1、自研调度组件，移除quartz依赖：一方面是为了精简系统降低冗余依赖，另一方面是为了提供系统的可控度与稳定性；</p>
<ul>
<li>触发：单节点周期性触发，运行事件如delayqueue；</li>
<li>调度：集群竞争，负载方式协同处理，锁竞争-更新触发信息-推送时间轮-锁释放-锁竞争；</li>
</ul>
<p>2、底层表结构重构：移除11张quartz相关表，并对现有表结构优化梳理；</p>
<p>3、任务日志主键调整为long数据类型，防止海量日志情况下数据溢出；</p>
<p>4、底层线程模型重构：移除Quartz线程池，降低系统线程与内存开销；</p>
<p>5、用户管理：支持在线管理系统用户，存在管理员、普通用户两种角色；</p>
<p>6、权限管理：执行器维度进行权限控制，管理员拥有全量权限，普通用户需要分配执行器权限后才允许相关操作；</p>
<p>7、调度线程池参数调优；</p>
<p>8、注册表索引优化，缓解锁表问题；</p>
<p>9、新增Jboot执行器Sample示例项目；</p>
<p>10、任务列表优化，支持根据 “任务状态”、”负责人” 属性筛选任务；</p>
<p>11、任务日志列表交互优化，操作按钮合并为分割按钮；</p>
<p>12、项目依赖升级至较新稳定版本，如spring、springboot、groovy、xxl-rpc等等；并清理冗余POM；</p>
<p>13、升级xxl-rpc至较新版本，修复代理服务初始化时远程服务不可用导致长连冗余创建的问题;</p>
<p>14、首页调度报表的日期排序在TIDB下乱序问题修复；</p>
<p>15、调度中心与执行器双向通讯超时时间调整为3s；</p>
<p>16、调度组件销毁流程优化，先停止调度线程，然后等待时间轮内存量任务处理完成，最终销毁时间轮线程；</p>
<p>17、执行器回调线程优化，回调地址为空时销毁问题修复；</p>
<p>18、HttpJobHandler优化，响应数据指定UTF-8格式，避免中文乱码；</p>
<p>19、代码优化，ConcurrentHashMap变量类型改为ConcurrentMap，避免因不同版本实现不同导致的兼容性问题；</p>
<h3 id="7-28-版本-v2-1-1-Release-Notes-2019-11-24"><a href="#7-28-版本-v2-1-1-Release-Notes-2019-11-24" class="headerlink" title="7.28 版本 v2.1.1 Release Notes[2019-11-24]"></a>7.28 版本 v2.1.1 Release Notes[2019-11-24]</h3><p>1、 调度中心日志自动清理功能（至此，调度中心&#x2F;执行器均支持日志自动清理，过期天数均默认设置为30天）：调度中心新增配置项（”xxl.job.logretentiondays”）日志保存天数，过期日志自动清理；解决海量日志情况下日志表慢SQL问题；限制大于等于7时生效，否则关闭清理功能，默认为30；</p>
<p>2、 调度报表优化：新增日志报表的存储表，三天内的任务日志会以每分钟一次的频率异步同步至报表中；任务报表仅读取报表数据，极大提升加载速度；</p>
<p>3、 Cron在线生成工具：任务新增、编辑框通过组件在线生成Cron表达式；</p>
<p>4、 Cron下次执行时间查询：支持通过界面在线查看后续连续5次执行时间；</p>
<p>5、 调度中心新增应用健康检查功能，借助“spring-boot-starter-actuator”，相对地址 “&#x2F;actuator&#x2F;health”；</p>
<p>6、 DB脚本默认编码改为utf8mb4，修复字符乱码问题(建议Mysql版本5.7+)；</p>
<p>7、 调度中心任务平均分配，触发组件每次获取与线程池数量相关数量的任务，避免大量任务集中在单个调度中心集群节点；</p>
<p>8、 任务触发组件优化，预加载频率正常1s一次，当预加载轮空时主动休眠一个加载周期，动态降低加载频率从而降低DB压力；</p>
<p>9、 调度组件优化：针对永远不会触发的Cron禁止配置和启动；任务Cron最后一次触发后再也不会触发时，比如一次性任务，主动停止相关任务；</p>
<p>10、DB重连优化，修复DB宕机重连后任务调度停止的问题，重连后自动加入调度集群触发任务调度；</p>
<p>11、注册监控线程优化，降低死锁几率；</p>
<p>12、调度中心日志删除优化，改为分页获取ID并根据ID删除的方式，避免批量删除海量日志导致死锁问题；</p>
<p>13、任务重试时参数丢失的问题修复；</p>
<p>14、调度中心移除SQL中的 “now()” 函数；集群部署时不再依赖DB时钟，仅需要保证调度中心应用节点时钟一致即可；</p>
<p>15、任务触发组件加载顺序调整，避免小概率情况下组件随机加载顺序导致的I18N的NPE问题;</p>
<p>16、JobThread自销毁优化，避免并发触发导致triggerQueue中任务丢失问题；</p>
<p>17、调度中心密码限制18位，修复修改密码超过18位无法登录的问题；</p>
<p>18、任务告警组件分页参数无效问题修复；</p>
<p>19、升级xxl-rpc版本：服务端线程优化，降低线程内存开销；IpUtil优化：增加连通性校，过滤明确非法的网卡；</p>
<p>20、调度中心回调API服务改为restful方式；</p>
<p>21、UI优化，任务列表和日志列表数据表格宽度比例调整，避免数据换行提升体验；</p>
<p>22、登录界面取消默认填写的登录账号密码；</p>
<p>23、执行器表属性调整，”顺序” 属性调整为整型，解决执行器数据较多时无法正确排序的问题；</p>
<p>24、任务列表交互优化，支持查看任务所属执行器的注册节点；</p>
<p>25、项目依赖升级至较新稳定版本，如spring、spring-boot、mybatis、slf4j、groovy等等；</p>
<p>26、日志组件优化：调度中心支持控制每次请求最大加载行数，日志量太大时分批请求，避免单次加载日志量太大阻塞页面；</p>
<h3 id="7-29-版本-v2-1-2-Release-Notes-2019-12-12"><a href="#7-29-版本-v2-1-2-Release-Notes-2019-12-12" class="headerlink" title="7.29 版本 v2.1.2 Release Notes[2019-12-12]"></a>7.29 版本 v2.1.2 Release Notes[2019-12-12]</h3><p>1、方法任务支持：由原来基于JobHandler类任务开发方式，优化为支持基于方法的任务开发方式；因此，可以支持单个类中开发多个任务方法，进行类复用</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@XxlJob</span>(<span class="hljs-string">&quot;demoJobHandler&quot;</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-title class_">ReturnT</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">execute</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> param</span>) &#123;  <br>	<span class="hljs-title class_">XxlJobLogger</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;hello world&quot;</span>);  <br>	<span class="hljs-keyword">return</span> <span class="hljs-title class_">ReturnT</span>.<span class="hljs-property">SUCCESS</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>2、移除commons-exec，采用原生方式实现，降低第三方依赖；</p>
<p>3、执行器回调乱码问题修复；</p>
<p>4、调度中心dispatcher servlet加载顺序优化；</p>
<p>5、执行器回调地址https兼容支持；</p>
<p>6、多个项目依赖升级至较新稳定版本；</p>
<p>注意：最新版本 “XxlJobSpringExecutor” 逻辑有调整，历史项目中该组件的配置方式请参考Sample示例项目进行调整，尤其注意需要移除组件的init和destroy方法；</p>
<h3 id="7-30-版本-v2-2-0-Release-Notes-2020-04-14"><a href="#7-30-版本-v2-2-0-Release-Notes-2020-04-14" class="headerlink" title="7.30 版本 v2.2.0 Release Notes[2020-04-14]"></a>7.30 版本 v2.2.0 Release Notes[2020-04-14]</h3><p>1、RESTful API：调度中心与执行器提供语言无关的 RESTful API 服务，第三方任意语言可据此对接调度中心或者实现执行器。</p>
<p>2、任务复制功能：点击复制是弹出新建任务弹框，并初始化被复制任务信息；</p>
<p>3、任务手动执行一次的时候，支持指定本次执行的机器地址，为空则从执行器获取；</p>
<p>4、任务结果丢失处理：调度记录停留在 “运行中” 状态超过10min，且对应执行器心跳注册失败不在线，则将本地调度主动标记失败；</p>
<p>5、调度中心升级springboot2.x；因此，系统要求JDK8+；</p>
<p>6、XxlJob注解扫描方式优化，支持查找父类以及接口和基于类代理等常见情况；修复任务为空时小概率NPE问题；</p>
<p>7、移除旧类注解JobHandler，推荐使用基于方法注解 “<a target="_blank" rel="noopener" href="https://github.com/XxlJob">@XxlJob</a>” 的方式进行任务开发；(如需保留类注解JobHandler使用方式，可以参考旧版逻辑定制开发);</p>
<p>8、任务告警组件模块化：如果需要新增一种告警方式，只需要新增一个实现 “com.xxl.job.admin.core.alarm.JobAlarm” 接口的告警实现即可，更加灵活、方便定制；</p>
<p>9、调度中心国际化完善：新增 “中文繁体” 支持。默认为 “zh_CN”&#x2F;中文简体, 可选范围为 “zh_CN”&#x2F;中文简体, “zh_TC”&#x2F;中文繁体 and “en”&#x2F;英文；</p>
<p>10、执行器注册逻辑优化：新增配置项 ”注册地址 &#x2F; xxl.job.executor.address“，优先使用该配置作为注册地址，为空时使用内嵌服务 ”IP:PORT“ 作为注册地址。从而更灵活的支持容器类型执行器动态IP和动态映射端口问题。</p>
<p>11、默认数据库连接池调整为hikari，移除tomcat-jdbc依赖；</p>
<p>12、多个项目依赖升级至较新稳定版本，如mybatis、groovy和mysql驱动等；</p>
<p>13、执行器优雅停机优化，修复任务线程中断未join导致回调丢失的问题；</p>
<p>14、一致性哈希路由策略优化：默认虚拟节点数量调整为100，提高路由的均衡性；</p>
<p>15、通用HTTP任务Handler（httpJobHandler）优化，扩展自定义参数信息，示例参数如下；</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">url: <span class="hljs-keyword">http</span>://www.xxx.commethod: <span class="hljs-built_in">get</span> 或 postdata: <span class="hljs-built_in">post</span>-data<br></code></pre></td></tr></table></figure>

<p>16、SQL脚本编码默认utf8mb4执行，避免小概率下容器环境中乱码问题；</p>
<p>17、Web IDE交互问题修复：输入源码备注之后按回车跳转error问题处理；</p>
<p>18、执行器初始化逻辑优化：修复懒加载的Bean被提前初始化问题；</p>
<p>19、执行器注册默认值优化；</p>
<p>20、修复bootstrap.min.css.map 404问题；</p>
<p>21、执行器UI交互优化,移除冗余order属性；</p>
<p>22、执行备注消息长度限制，修复数据超长无法存储导致导致回调失败的问题；<br>注意：XxlJobSpringExecutor组件个别字段调整：“appName” 调整为 “appname” ，升级时该组件时需要注意；</p>
<h3 id="7-31-版本-v2-3-0-Release-Notes-2021-02-09"><a href="#7-31-版本-v2-3-0-Release-Notes-2021-02-09" class="headerlink" title="7.31 版本 v2.3.0 Release Notes[2021-02-09]"></a>7.31 版本 v2.3.0 Release Notes[2021-02-09]</h3><p>1、【新增】调度过期策略：调度中心错过调度时间的补偿处理策略，包括：忽略、立即补偿触发一次等；</p>
<p>2、【新增】触发策略：除了常规Cron、API、父子任务触发方式外，新增提供 “固定间隔触发、（固定延时触发，实验中）” 新触发方式；</p>
<p>3、【新增】新增任务辅助工具 “XxlJobHelper”：提供统一任务辅助能力，包括：任务上下文信息维护获取（任务参数、任务ID、分片参数）、日志输出、任务结果设置……等；</p>
<ul>
<li>3.1、”ShardingUtil” 组件废弃：改用 “XxlJobHelper.getShardIndex()&#x2F;getShardTotal();” 获取分片参数；</li>
<li>3.2、”XxlJobLogger” 组件废弃：改用 “XxlJobHelper.log” 进行日志输出；</li>
</ul>
<p>4、【优化】任务核心类 “IJobHandler” 的 “execute” 方法取消出入参设计。改为通过 “XxlJobHelper.getJobParam” 获取任务参数并替代方法入参，通过 “XxlJobHelper.handleSuccess&#x2F;handleFail” 设置任务结果并替代方法出参，示例代码如下；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@XxlJob</span>(<span class="hljs-string">&quot;demoJobHandler&quot;</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params"></span>) &#123;<br>	<span class="hljs-title class_">String</span> param = <span class="hljs-title class_">XxlJobHelper</span>.<span class="hljs-title function_">getJobParam</span>();    <span class="hljs-comment">// 获取参数</span><br>	<span class="hljs-title class_">XxlJobHelper</span>.<span class="hljs-title function_">handleSuccess</span>();                 <span class="hljs-comment">// 设置任务结果</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>5、【优化】Cron编辑器增强：Cron编辑器修改cron时可实时查看最近运行时间;</p>
<p>6、【优化】执行器示例项目规范整理；</p>
<p>7、【优化】任务调度生命周期重构：调度（schedule）、触发(trigger)、执行（handle）、回调(callback)、结束（complete）；</p>
<p>8、【优化】执行器注册组件优化：注册逻辑调整为异步方式，提高注册性能；</p>
<p>9、【优化】执行器鉴权校验：执行器启动时主动校验accessToken，为空则主动Warn告警；（已规划安全强化：AccessToken动态生成、动态启停等）</p>
<p>10、【优化】邮箱告警配置优化：将”spring.mail.from”与”spring.mail.username”属性拆分开，更加灵活的支持一些无密码邮箱服务；</p>
<p>11、【优化】多个项目依赖升级至较新稳定版本，如netty、groovy、spring、springboot、mybatis等；</p>
<p>12、【优化】UI组件常规升级，提升组件稳定性；</p>
<p>13、【优化】调度中心页面交互优化：用户管理模块密码列取消；多处表达autocomplete取消；执行器管理模块XSS拦截校验等；</p>
<p>14、【优化】调度中心任务状态探测慢SQL问题优化；</p>
<p>15、【修复】GLUE-Java模式任务，init&#x2F;destroy无法执行问题修复；</p>
<p>16、【修复】Cron编辑器问题修复：修复小概率情况下cron单个字段修改时导致其他字段被重置问题；</p>
<p>17、【修复】通用HTTP任务Handler（httpJobHandler）优化：修复 “setDoOutput(true)” 导致任务请求GetMethod失效问题；</p>
<p>18、【修复】执行器Commandhandler示例任务优化，修复极端情况下脚本进程挂起问题；</p>
<p>19、【修复】调度通讯组件优化，修复RestFul方式调用 DotNet 版本执行器时心跳检测失败问题；</p>
<p>20、【修复】调度中心远程执行日志查询乱码问题修复；</p>
<p>21、【修复】调度中心组件加载顺序优化，修复极端情况下调度组件初始慢导致的调度失败问题；</p>
<p>22、【修复】执行器注册线程优化，修复极端情况下初始化失败时导致NPE问题；</p>
<p>23、【修复】调度线程连接池优化，修复连接有效性校验超时问题；</p>
<p>24、【修复】执行器注册表字段优化，解决执行器注册节点过多导致注册信息存储和更新失败的问题；</p>
<p>25、【修复】轮训路由策略优化，修复小概率下并发问题；</p>
<p>26、【修复】页面redirect跳转后https变为http问题修复；</p>
<p>27、【修复】执行器日志清理优化，修复小概率下日志文件为空导致清理异常问题；</p>
<h3 id="7-32-版本-v2-3-1-Release-Notes-2022-05-21"><a href="#7-32-版本-v2-3-1-Release-Notes-2022-05-21" class="headerlink" title="7.32 版本 v2.3.1 Release Notes[2022-05-21]"></a>7.32 版本 v2.3.1 Release Notes[2022-05-21]</h3><p>1、【修复】修复风险漏洞，升级问题低版本项目依赖：CVE-2021-2471、CVE-2022-22965等。</p>
<p>2、【修复】修复故障告警逻辑，邮箱校验逻辑下放至EmailJobAlarm中，避免对其他告警方式的干扰。</p>
<p>3、【优化】调度通讯默认启用accessToken，提升系统安全性（建议生产环境自定义accessToken）。</p>
<p>4、【优化】合并多项PR，项目代码结构、健壮性优化：PR-2833、PR-2812、PR-2541、PR-2537、PR-2514、PR-2509、PR-2591。</p>
<p>5、【优化】任务线程名优化，提升可读性与问题定位效率(ISSUE-2527)。</p>
<h3 id="7-33-版本-v2-4-0-Release-Notes-规划中"><a href="#7-33-版本-v2-4-0-Release-Notes-规划中" class="headerlink" title="7.33 版本 v2.4.0 Release Notes[规划中]"></a>7.33 版本 v2.4.0 Release Notes[规划中]</h3><p>1、【优化】执行器任务Bean扫描逻辑优化：解决懒加载注解失效问题。</p>
<p>2、【优化】[规划中]任务日志重构：一次调度只记录一条主任务，维护起止时间和状态。</p>
<ul>
<li>普通任务：只记录一条主任务；</li>
<li>广播任务：记录一条主任务，每个分片任务记录一条次任务，关联在主任务上；</li>
<li>重试任务：失败时，新增主任务。所有调度记录，包括入口调度和重试调度，均挂载主任务上。</li>
</ul>
<p>3、【优化】[规划中]分片任务：全部完成后才会出发后置节点；</p>
<h3 id="7-34-新版本规划-规划中"><a href="#7-34-新版本规划-规划中" class="headerlink" title="7.34 新版本规划 [规划中]"></a>7.34 新版本规划 [规划中]</h3><p>1、[规划中]DAG流程任务</p>
<ul>
<li>DAG任务：支持参数传递，共享数据：DAG任务创建、管理，DAG任务日志查看、操作；</li>
<li>子任务：废弃</li>
</ul>
<p>2、[规划中]多数据库支持，DAO层通过JPA实现，不限制数据库类型；</p>
<p>3、[规划中]告警增强：邮件告警 + webhook告警；</p>
<p>4、[规划中]安全强化：AccessToken动态生成、动态启停；控制调度、回调；</p>
<p>5、[规划中]任务导入导出工具，灵活支持版本升级、迁移等场景。</p>
<h3 id="TODO-LIST"><a href="#TODO-LIST" class="headerlink" title="TODO LIST"></a>TODO LIST</h3><p>1、任务分片路由：分片采用一致性Hash算法计算出尽量稳定的分片顺序，即使注册机器存在波动也不会引起分批分片顺序大的波动；目前采用IP自然排序，可以满足需求，待定；</p>
<p>2、调度隔离：调度中心针对不同执行器，各自维护不同的调度和远程触发组件。</p>
<p>3、调度任务优先级；</p>
<p>4、多数据库支持，DAO层通过JPA实现，不限制数据库类型；</p>
<p>5、执行器Log清理功能：调度中心Log删除时同步删除执行器中的Log文件；</p>
<p>6、延时任务：API触发，支持”动态传参、延时消费”；该功能与 XXL-MQ 冲突，该场景建议用后者；</p>
<p>7、调度线程池改为协程方式实现，大幅降低系统内存消耗；</p>
<p>8、任务、执行器数据全量本地缓存；新增消息表广播通知；</p>
<p>9、忙碌转移优化，全部机器忙碌时不再直接失败；</p>
<p>10、任务触发参数优化：支持选择 “Cron触发”、”固定间隔时间触发”、”指定时间点触发”、”不选择” 等；</p>
<p>11、调度日志列表加上执行时长列，并支持排序；</p>
<p>12、DAG流程任务：</p>
<ul>
<li>替换子任务，支持参数传递，共享数据：</li>
<li>配置并列的”a-b、b-c”路径列表，构成串行、并行、dag任务流程，”dagre-d3”绘图；任务依赖，流程图，子任务+会签任务，各节点日志；支持根据成功、失败选择分支；</li>
<li>分片任务：全部完成后才会出发后置节点；</li>
</ul>
<p>13、日期过滤：支持多个时间段排除；</p>
<p>14、告警增强：</p>
<ul>
<li>邮件告警：支持自定义标题、模板格式；</li>
<li>webhook告警：支持自定义告警URL、请求体格式；</li>
</ul>
<p>15、新增任务运行模式 “GLUE模式(GO) “，支持GO任务；</p>
<p>16、GLUE 模式 Web Ide 版本对比功能；</p>
<p>17、注册中心优化，实时性注册发现：心跳注册间隔10s，refresh失败则首次注册并立即更新注册信息，心跳类似；30s过期销毁；</p>
<p>18、提供执行器Docker镜像；</p>
<p>19、脚本任务，支持数据参数，新版本仅支持单参数不支持需要兼容；</p>
<p>20、批量调度：调度请求入queue，调度线程批量获取调度请求并发起远程调度；提高线程效率；</p>
<p>21、执行器端口复用，复用容器端口提供通讯服务；</p>
<p>22、分片任务全部成功后触发子任务；</p>
<p>23、新增执行器描述属性；任务名称属性；</p>
<p>24、自定义失败重试时间间隔；</p>
<p>25、任务标签：方便搜索；</p>
<p>26、执行器：dag执行器，不需要注册机器；</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.xxl.job.service.handler;<br><br><span class="hljs-keyword">import</span> org.slf4j.<span class="hljs-type">Logger</span>;<br><span class="hljs-keyword">import</span> org.slf4j.<span class="hljs-type">LoggerFactory</span>;<br><br><span class="hljs-keyword">import</span> com.xxl.job.core.biz.model.<span class="hljs-type">ReturnT</span>;<br><span class="hljs-keyword">import</span> com.xxl.job.core.context.<span class="hljs-type">XxlJobHelper</span>;<br><span class="hljs-keyword">import</span> com.xxl.job.core.handler.<span class="hljs-type">IJobHandler</span>;<br><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemoGlueJobHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">IJobHandler</span> </span>&#123;<br>  <br>  	<span class="hljs-keyword">private</span> static transient <span class="hljs-type">Logger</span> logger = <span class="hljs-type">LoggerFactory</span>.getLogger(<span class="hljs-type">DemoGlueJobHandler</span>.<span class="hljs-keyword">class</span>);<br>  	 	<br>  	<span class="hljs-meta">@Override</span><br>	public <span class="hljs-type">ReturnT</span>&lt;<span class="hljs-type">String</span>&gt; execute(<span class="hljs-type">String</span> params) <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> &#123;<br>		<span class="hljs-type">XxlJobHelper</span>.log(<span class="hljs-string">&quot;XXL-JOB, Hello World.&quot;</span>);<br>      	<span class="hljs-keyword">return</span> <span class="hljs-type">ReturnT</span>.<span class="hljs-type">SUCCESS</span>;<br>	&#125;<br> <br>	<span class="hljs-meta">@Override</span><br>	public void execute() <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> &#123;<br>		<span class="hljs-type">XxlJobHelper</span>.log(<span class="hljs-string">&quot;XXL-JOB, Hello World.&quot;</span>);<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="category-chain-item">中间件</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%A1%86%E6%9E%B6/">#定时任务框架</a>
      
        <a href="/tags/XXL-JOB/">#XXL-JOB</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>XXL-JOB</div>
      <div>https://kblayt.github.io/2023/03/02/中间件/XXL-JOB/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Kblayt</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年3月2日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/03/02/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/" title="分布式架构">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">分布式架构</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/03/01/%E5%BE%AE%E6%9C%8D%E5%8A%A1/OpenFeign%E4%B8%8E%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" title="OpenFeign与负载均衡">
                        <span class="hidden-mobile">OpenFeign与负载均衡</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
